<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="generator" content="litedown 0.4.10">
<title>litedown: R Markdown Reimagined</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@xiee/utils@1.13.53/css/prism-xcode.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.15/dist/katex.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@xiee/utils@1.13.53/css/default.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@xiee/utils@1.13.53/css/article.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@xiee/utils@1.13.53/css/book.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@xiee/utils@1.13.53/css/book-litedown.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@xiee/utils@1.13.53/css/copy-button.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@xiee/utils@1.13.53/css/heading-anchor.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@xiee/utils@1.13.53/css/key-buttons.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@xiee/utils@1.13.53/css/callout.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@xiee/utils@1.13.53/css/pages.min.css">
</head>
<body>
<div class="frontmatter">
<div class="title"><h1>litedown: R Markdown Reimagined</h1></div>
<div class="author"><h2>Yihui Xie</h2></div>
<div class="date"><h3>2024-12-13</h3></div>
</div>
<div class="">
<div id="TOC">
<ul class="numbered">
<li><a href="#chp:preface">Preface</a>
<ul>
<li><a href="#sec:the-past-journey">The past journey</a></li>
<li><a href="#sec:a-question">A question</a></li>
<li><a href="#sec:overview">Overview</a></li>
<li><a href="#sec:scope">Scope</a>
<ul>
<li><a href="#sec:features-out-of-scope">Features out of scope</a></li>
</ul>
</li>
<li><a href="#sec:highlights">Highlights</a>
<ul>
<li><a href="#sec:small-footprint">Small footprint</a></li>
<li><a href="#sec:live-preview-everything">Live preview everything</a></li>
<li><a href="#sec:precise-parser">Precise parser</a></li>
<li><a href="#sec:versioned-css-js-assets">Versioned CSS/JS assets</a></li>
<li><a href="#sec:chunk-options-management">Chunk options management</a></li>
<li><a href="#sec:non-linear-order-of-execution">Non-linear order of execution</a></li>
<li><a href="#sec:time-code-chunks">Time code chunks</a></li>
<li><a href="#sec:table-output-for-data-frames-by-default">Table output for data frames by default</a></li>
<li><a href="#sec:relieved-pain-of-paths">Relieved pain of paths</a></li>
<li><a href="#sec:output-in-memory-or-to-disk">Output in memory or to disk</a></li>
<li><a href="#sec:a-new-cache-system">A new cache system</a></li>
<li><a href="#sec:a-book-is-a-single-html-file">A book is a single HTML file</a></li>
<li><a href="#sec:r-scripts-as-first-class-citizens">R scripts as first-class citizens</a></li>
<li><a href="#sec:clean-html-output">Clean HTML output</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#chp:start"><span class="section-number main-number">1</span> Get Started</a>
<ul>
<li><a href="#sec:a-new-road-to-roam"><span class="section-number">1.1</span> A new road to <code>roam()</code></a></li>
<li><a href="#sec:a-minimal-example"><span class="section-number">1.2</span> A minimal example</a></li>
<li><a href="#sec:basic-concepts"><span class="section-number">1.3</span> Basic concepts</a></li>
<li><a href="#sec:a-few-words-on-naming"><span class="section-number">1.4</span> A few words on naming</a></li>
</ul>
</li>
<li><a href="#chp:fuse"><span class="section-number main-number">2</span> Computing</a>
<ul>
<li><a href="#sec:code-chunks"><span class="section-number">2.1</span> Code chunks</a>
<ul>
<li><a href="#sec:option-syntax"><span class="section-number">2.1.1</span> Syntax for chunk options</a></li>
<li><a href="#sec:reactor"><span class="section-number">2.1.2</span> The chunk option manager</a></li>
<li><a href="#sec:skipped-chunks"><span class="section-number">2.1.3</span> Skipped code chunks</a></li>
<li><a href="#sec:show-chunk-fences-in-output"><span class="section-number">2.1.4</span> Show chunk fences in output</a></li>
<li><a href="#sec:chunk-options"><span class="section-number">2.1.5</span> All chunk options</a>
<ul>
<li><a href="#sec:option-attr"><span class="section-number">2.1.5.1</span> <code>attr.*</code>: attributes for output elements</a></li>
<li><a href="#sec:option-cache"><span class="section-number">2.1.5.2</span> <code>cache</code>: speed up the computing</a></li>
<li><a href="#sec:option-cap-pos"><span class="section-number">2.1.5.3</span> <code>cap.pos</code>: caption position</a></li>
<li><a href="#sec:option-child"><span class="section-number">2.1.5.4</span> <code>child</code>: child documents</a></li>
<li><a href="#sec:option-code"><span class="section-number">2.1.5.5</span> <code>code</code> and <code>file</code>: alternative ways to provide code</a></li>
<li><a href="#sec:option-collapse"><span class="section-number">2.1.5.6</span> <code>collapse</code>: collapse source code and text output</a></li>
<li><a href="#sec:option-comment"><span class="section-number">2.1.5.7</span> <code>comment</code>: comment out text output</a></li>
<li><a href="#sec:option-dev"><span class="section-number">2.1.5.8</span> <code>dev</code>: graphics device</a></li>
<li><a href="#sec:option-echo"><span class="section-number">2.1.5.9</span> <code>echo</code>: visibility of source code</a></li>
<li><a href="#sec:option-error"><span class="section-number">2.1.5.10</span> <code>error</code>: error behavior</a></li>
<li><a href="#sec:option-eval"><span class="section-number">2.1.5.11</span> <code>eval</code>: code evaluation</a></li>
<li><a href="#sec:option-fig"><span class="section-number">2.1.5.12</span> <code>fig.*</code>: figure options</a></li>
<li><a href="#sec:option-include"><span class="section-number">2.1.5.13</span> <code>include</code>: visibility of whole code chunk</a></li>
<li><a href="#sec:option-label"><span class="section-number">2.1.5.14</span> <code>label</code>: chunk label</a></li>
<li><a href="#sec:option-message"><span class="section-number">2.1.5.15</span> <code>message</code>: message behavior</a></li>
<li><a href="#sec:option-order"><span class="section-number">2.1.5.16</span> <code>order</code>: order of execution</a></li>
<li><a href="#sec:option-print"><span class="section-number">2.1.5.17</span> <code>print</code>: printing function</a></li>
<li><a href="#sec:option-purl"><span class="section-number">2.1.5.18</span> <code>purl</code>: code extraction</a></li>
<li><a href="#sec:option-ref-label"><span class="section-number">2.1.5.19</span> <code>ref.label</code>: chunk references</a></li>
<li><a href="#sec:option-results"><span class="section-number">2.1.5.20</span> <code>results</code>: text output behavior</a></li>
<li><a href="#sec:option-strip-white"><span class="section-number">2.1.5.21</span> <code>strip.white</code>: leading / trailing blank lines in code</a></li>
<li><a href="#sec:option-tab"><span class="section-number">2.1.5.22</span> <code>tab.*</code>: table options</a></li>
<li><a href="#sec:option-time"><span class="section-number">2.1.5.23</span> <code>time</code>: code timing</a></li>
<li><a href="#sec:option-verbose"><span class="section-number">2.1.5.24</span> <code>verbose</code>: printing verbosity</a></li>
<li><a href="#sec:option-warning"><span class="section-number">2.1.5.25</span> <code>warning</code>: warning behavior</a></li>
<li><a href="#sec:option-wd"><span class="section-number">2.1.5.26</span> <code>wd</code>: working directory</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec:inline-code"><span class="section-number">2.2</span> Inline code</a>
<ul>
<li><a href="#sec:inline-syntax"><span class="section-number">2.2.1</span> The syntax</a></li>
<li><a href="#sec:numeric-output"><span class="section-number">2.2.2</span> Numeric output</a></li>
<li><a href="#sec:compatibility-with-knitr"><span class="section-number">2.2.3</span> Compatibility with knitr</a></li>
</ul>
</li>
<li><a href="#sec:r-scripts"><span class="section-number">2.3</span> R scripts</a></li>
<li><a href="#sec:engines"><span class="section-number">2.4</span> Language engines</a>
<ul>
<li><a href="#sec:the-markdown-engine"><span class="section-number">2.4.1</span> The Markdown engine</a></li>
<li><a href="#sec:the-css-js-engines"><span class="section-number">2.4.2</span> The CSS/JS engines</a></li>
<li><a href="#sec:the-mermaid-engine"><span class="section-number">2.4.3</span> The Mermaid engine</a></li>
<li><a href="#sec:the-embed-engine"><span class="section-number">2.4.4</span> The embed engine</a></li>
</ul>
</li>
<li><a href="#sec:comparison-to-knitr"><span class="section-number">2.5</span> Comparison to <strong>knitr</strong></a></li>
</ul>
</li>
<li><a href="#chp:syntax"><span class="section-number main-number">3</span> Markdown Syntax</a>
<ul>
<li><a href="#sec:yaml-syntax"><span class="section-number">3.1</span> YAML syntax</a></li>
<li><a href="#sec:markdown-basic"><span class="section-number">3.2</span> Basic Markdown</a>
<ul>
<li><a href="#sec:inline-elements"><span class="section-number">3.2.1</span> Inline elements</a></li>
<li><a href="#sec:headings"><span class="section-number">3.2.2</span> Headings</a></li>
<li><a href="#sec:paragraphs"><span class="section-number">3.2.3</span> Paragraphs</a></li>
<li><a href="#sec:code-blocks"><span class="section-number">3.2.4</span> Code blocks</a></li>
<li><a href="#sec:lists"><span class="section-number">3.2.5</span> Lists</a></li>
<li><a href="#sec:block-quotes"><span class="section-number">3.2.6</span> Block quotes</a></li>
<li><a href="#sec:tables"><span class="section-number">3.2.7</span> Tables</a></li>
</ul>
</li>
<li><a href="#sec:markdown-addon"><span class="section-number">3.3</span> Add-on features</a>
<ul>
<li><a href="#sec:raw-latex-html-blocks"><span class="section-number">3.3.1</span> Raw LaTeX/HTML blocks</a></li>
<li><a href="#sec:latex-math_1"><span class="section-number">3.3.2</span> LaTeX math</a></li>
<li><a href="#sec:superscripts-and-subscripts"><span class="section-number">3.3.3</span> Superscripts and subscripts</a></li>
<li><a href="#sec:footnotes_1"><span class="section-number">3.3.4</span> Footnotes</a></li>
<li><a href="#sec:attributes"><span class="section-number">3.3.5</span> Attributes</a></li>
<li><a href="#sec:appendices"><span class="section-number">3.3.6</span> Appendices</a></li>
<li><a href="#sec:fenced-divs"><span class="section-number">3.3.7</span> Fenced <code>Div</code>s</a></li>
<li><a href="#sec:cross-references"><span class="section-number">3.3.8</span> Cross-references</a>
<ul>
<li><a href="#sec:sections-figures-and-tables"><span class="section-number">3.3.8.1</span> Sections, figures, and tables</a></li>
<li><a href="#sec:latex-equations"><span class="section-number">3.3.8.2</span> LaTeX equations</a></li>
<li><a href="#sec:arbitrary-elements"><span class="section-number">3.3.8.3</span> Arbitrary elements</a></li>
</ul>
</li>
<li><a href="#sec:citations"><span class="section-number">3.3.9</span> Citations</a></li>
<li><a href="#sec:smart-html-entities"><span class="section-number">3.3.10</span> Smart HTML entities</a></li>
</ul>
</li>
<li><a href="#sec:comparison-to-pandoc"><span class="section-number">3.4</span> Comparison to Pandoc</a></li>
</ul>
</li>
<li><a href="#chp:mark"><span class="section-number main-number">4</span> Markdown Rendering</a>
<ul>
<li><a href="#sec:markdown-options"><span class="section-number">4.1</span> Markdown options</a>
<ul>
<li><a href="#sec:auto-identifiers"><span class="section-number">4.1.1</span> <code>auto_identifiers</code></a></li>
<li><a href="#sec:cleveref"><span class="section-number">4.1.2</span> <code>cleveref</code></a></li>
<li><a href="#sec:embed-cleanup"><span class="section-number">4.1.3</span> <code>embed_cleanup</code></a></li>
<li><a href="#sec:embed-resources"><span class="section-number">4.1.4</span> <code>embed_resources</code></a></li>
<li><a href="#sec:js-highlight"><span class="section-number">4.1.5</span> <code>js_highlight</code></a></li>
<li><a href="#sec:js-math"><span class="section-number">4.1.6</span> <code>js_math</code></a></li>
<li><a href="#sec:keep-yaml"><span class="section-number">4.1.7</span> <code>keep_yaml</code></a></li>
<li><a href="#sec:latex-math_2"><span class="section-number">4.1.8</span> <code>latex_math</code></a></li>
<li><a href="#sec:number-sections"><span class="section-number">4.1.9</span> <code>number_sections</code></a></li>
<li><a href="#sec:smartypants"><span class="section-number">4.1.10</span> <code>smartypants</code></a></li>
<li><a href="#sec:superscript"><span class="section-number">4.1.11</span> <code>superscript</code></a></li>
<li><a href="#sec:subscript"><span class="section-number">4.1.12</span> <code>subscript</code></a></li>
<li><a href="#sec:toc"><span class="section-number">4.1.13</span> <code>toc</code></a></li>
<li><a href="#sec:top-level"><span class="section-number">4.1.14</span> <code>top_level</code></a></li>
</ul>
</li>
<li><a href="#sec:templates"><span class="section-number">4.2</span> Templates</a></li>
<li><a href="#sec:yaml-metadata"><span class="section-number">4.3</span> YAML metadata</a>
<ul>
<li><a href="#sec:top-level-variables"><span class="section-number">4.3.1</span> Top-level variables</a></li>
<li><a href="#sec:format-specific-variables"><span class="section-number">4.3.2</span> Format-specific variables</a>
<ul>
<li><a href="#sec:the-css-variable"><span class="section-number">4.3.2.1</span> The <code>css</code> variable</a></li>
<li><a href="#sec:the-js-variable"><span class="section-number">4.3.2.2</span> The <code>js</code> variable</a></li>
<li><a href="#sec:the-body-class-variable"><span class="section-number">4.3.2.3</span> The <code>body-class</code> variable</a></li>
<li><a href="#sec:the-classoption-variable"><span class="section-number">4.3.2.4</span> The <code>classoption</code> variable</a></li>
<li><a href="#sec:the-documentclass-variable"><span class="section-number">4.3.2.5</span> The <code>documentclass</code> variable</a></li>
</ul>
</li>
<li><a href="#sec:naming-convention-of-variables"><span class="section-number">4.3.3</span> Naming convention of variables</a></li>
<li><a href="#sec:using-custom-variables"><span class="section-number">4.3.4</span> Using custom variables</a></li>
<li><a href="#sec:setting-options-in-yaml"><span class="section-number">4.3.5</span> Setting options in YAML</a></li>
<li><a href="#sec:other-fields-in-yaml"><span class="section-number">4.3.6</span> Other fields in YAML</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#chp:assets"><span class="section-number main-number">5</span> CSS/JS assets</a>
<ul>
<li><a href="#sec:html-slides"><span class="section-number">5.1</span> HTML slides</a></li>
<li><a href="#sec:html-articles"><span class="section-number">5.2</span> HTML articles</a>
<ul>
<li><a href="#sec:the-overall-style"><span class="section-number">5.2.1</span> The overall style</a></li>
<li><a href="#sec:side-elements"><span class="section-number">5.2.2</span> Side elements</a>
<ul>
<li><a href="#sec:the-toc"><span class="section-number">5.2.2.1</span> The TOC</a></li>
<li><a href="#sec:footnotes_2"><span class="section-number">5.2.2.2</span> Footnotes</a></li>
<li><a href="#sec:arbitrary-sidenotes"><span class="section-number">5.2.2.3</span> Arbitrary sidenotes</a></li>
</ul>
</li>
<li><a href="#sec:body-elements"><span class="section-number">5.2.3</span> Body elements</a>
<ul>
<li><a href="#sec:full-width-elements"><span class="section-number">5.2.3.1</span> Full-width elements</a></li>
<li><a href="#sec:left-right-quotes"><span class="section-number">5.2.3.2</span> Left/right quotes</a></li>
<li><a href="#sec:margin-embedding"><span class="section-number">5.2.3.3</span> Margin embedding</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec:tabbed-sections"><span class="section-number">5.3</span> Tabbed sections</a></li>
<li><a href="#sec:code-folding"><span class="section-number">5.4</span> Code folding</a></li>
<li><a href="#sec:callout-blocks"><span class="section-number">5.5</span> Callout blocks</a>
<ul>
<li><a href="#sec:built-in-callouts"><span class="section-number">5.5.1</span> Built-in callouts</a></li>
<li><a href="#sec:customizing-callouts"><span class="section-number">5.5.2</span> Customizing callouts</a></li>
</ul>
</li>
<li><a href="#sec:right-align-a-quote-footer"><span class="section-number">5.6</span> Right-align a quote footer</a></li>
<li><a href="#sec:add-anchor-links-to-headings"><span class="section-number">5.7</span> Add anchor links to headings</a></li>
<li><a href="#sec:style-keyboard-shortcuts"><span class="section-number">5.8</span> Style keyboard shortcuts</a></li>
<li><a href="#sec:arbitrary-assets"><span class="section-number">5.9</span> Include arbitrary CSS/JS</a></li>
</ul>
</li>
<li><a href="#chp:authoring"><span class="section-number main-number">6</span> Authoring</a>
<ul>
<li><a href="#sec:live-preview"><span class="section-number">6.1</span> Live preview</a>
<ul>
<li><a href="#sec:live-reload"><span class="section-number">6.1.1</span> Live reload</a></li>
<li><a href="#sec:the-file-listing"><span class="section-number">6.1.2</span> The file listing</a></li>
<li><a href="#sec:the-buttons"><span class="section-number">6.1.3</span> The buttons</a></li>
<li><a href="#sec:cleaning-up"><span class="section-number">6.1.4</span> Cleaning up</a></li>
</ul>
</li>
<li><a href="#sec:visual-editor"><span class="section-number">6.2</span> Visual editor</a></li>
<li><a href="#sec:knit-button"><span class="section-number">6.3</span> The <code>Knit</code> button</a></li>
</ul>
</li>
<li><a href="#chp:sites"><span class="section-number main-number">7</span> Books and Websites</a>
<ul>
<li><a href="#sec:books"><span class="section-number">7.1</span> Books</a>
<ul>
<li><a href="#sec:previewing-a-single-chapter"><span class="section-number">7.1.1</span> Previewing a single chapter</a></li>
</ul>
</li>
<li><a href="#sec:websites"><span class="section-number">7.2</span> Websites</a></li>
<li><a href="#sec:pkg-site"><span class="section-number">7.3</span> R package documentation</a>
<ul>
<li><a href="#sec:the-pkg-helper-functions"><span class="section-number">7.3.1</span> The <code>pkg_*()</code> helper functions</a></li>
<li><a href="#sec:package-sites-via-github-action"><span class="section-number">7.3.2</span> Package sites via GitHub Action</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#chp:appendix">Appendix</a></li>
<li><a href="#chp:rmarkdown"><span class="section-number main-number">A</span> For rmarkdown Users</a></li>
<li><a href="#chp:vignettes"><span class="section-number main-number">B</span> Package vignettes</a></li>
<li><a href="#chp:notes"><span class="section-number main-number">C</span> Technical Notes</a>
<ul>
<li><a href="#sec:embedding-resources"><span class="section-number">C.1</span> Embedding resources</a></li>
<li><a href="#sec:css-for-margin-content"><span class="section-number">C.2</span> CSS for margin content</a></li>
</ul>
</li>
</ul>
</div>
<div class="chapter body" data-source="docs/index.Rmd">
<div class="chapter-before side side-right">
<p><a href="https://github.com/yihui/litedown/edit/main/docs/index.Rmd">Edit this chapter</a> on GitHub</p>
</div>
<h1 id="chp:preface" class="unnumbered">Preface</h1>
<div class="callout-important">
<p>The <strong>litedown</strong> package is still new and experimental. The documentation is
only about 50% complete at the moment. Besides, <strong>litedown</strong> was designed for
minimalists with a limited scope. Average users should perhaps consider using
<strong>rmarkdown</strong> or Quarto instead.</p>
<p>If you do wish to try <strong>litedown</strong>, please install from r-universe:</p>
<pre><code class="language-r">install.packages(c('litedown', 'xfun'), repos = 'https://yihui.r-universe.dev')
</code></pre>
</div>
<div class="epigraph">
<blockquote>
<p>You may say I’m a dreamer<br />
But I’m not the only one<br />
I hope someday you’ll join us<br />
And the world will live as one</p>
<p>—John Lennon, <em>Imagine</em></p>
</blockquote>
</div>
<p>Imagine there’s no PDF. It’s easy if you try. No Word below us. Above us, only
HTML.</p>
<p>I do not mean PDF and Word are bad. I only lament the time that human beings
spend on various document formats, given how much a static web page can do.</p>
<h2 id="sec:the-past-journey">The past journey</h2>
<p>Having worked on the development of R Markdown for nearly 12 years, I have to
confess that I have become a little perplexed about my work, although I clearly
remember the exciting moments. For example:</p>
<ul>
<li>
<p>The moment when I added syntax highlighting to R code in <code>.Rnw</code> documents.
Beautiful!</p>
</li>
<li>
<p>The moment when I managed to generate a base R plot and a ggplot in the same
code chunk and place them side by side in LaTeX. Magic! Not to mention that
ggplot does not require an explicit <code>print()</code> call in a code chunk—you
probably do not even know what that means now.</p>
</li>
<li>
<p>The moment when I saw the impossible-to-read diagram that shows all possible
conversions among numerous document formats on the Pandoc homepage.
Incredible!</p>
</li>
<li>
<p>The moment when I discovered DZSlides in Pandoc. Wow! So PowerPoint and
LaTeX beamer were not the only choices for slides.</p>
</li>
<li>
<p>The moment when some rstudio::conf attendees started applauding after I told
them that the PowerPoint support had been added to the development version
of <strong>rmarkdown</strong> when one person asked about it.</p>
</li>
<li>
<p>The moment when I came across remark.js. And tufte.css. And GitBook. And
Hugo. And distill.pub. And <strong>htmlwidgets</strong>, <strong>reticulate</strong>, and so on.</p>
</li>
<li>
<p>…</p>
</li>
</ul>
<p>I think the work was largely meaningful. The only problem is I do not see an
end. The list of exciting things to do goes on and on.</p>
<h2 id="sec:a-question">A question</h2>
<p>“At forty, I had no more doubts.” Confucius said. Apparently, I’m not Confucius.
On the contrary, as I’m turning forty, I’m having more doubts. I have been
reflecting on the things that have kept me busy.</p>
<p>If I were to summarize the 700+ episodes of Naruto in one sentence, I would use
the question that Gaara (the Fifth Kazekage) asked Onoki (the Third Tsuchikage):</p>
<blockquote>
<p>When did you all forsake yourselves?</p>
</blockquote>
<p>In my opinion, this question was the most critical turning point in the 700+
episodes, reminding the 79-year-old Onoki and the rest of people of their
original dreams. The shinobi world existed to put an end to wars, but it turned
out to bring even more and larger-scale wars.</p>
<p>When did we forsake simplicity? We create software to simplify things, but
software often ends up in feature wars.</p>
<p>Markdown was originally invented for simplicity. That is, to make it easier to
write HTML. I used to take out my wallet and tell people that if they are unable
to learn the basics of Markdown in 5 minutes, I’d award them 20 dollars. I also
used to say “In HTML I Trust”, which sounds like a joke, but I really love HTML
and web technologies. Again, I do not mean other document formats are bad at
all. It is just that I feel HTML has the greatest potential, and I hope to take
full advantage of its power.<sup class="footnote-ref"><a href="#fn-1" id="fnref-1" data-footnote-ref>1</a></sup></p>
<p>In other words, I do not expect that “the (software) world will live as one”. I
just want to make the HTML world a little bit better.</p>
<h2 id="sec:overview">Overview</h2>
<p>The <strong>litedown</strong> package is an attempt to reimagine R Markdown with one primary
goal—do HTML, and do it well, with the minimalism principle. Before LaTeX fans
walk away in disappointment, let me quickly clarify that LaTeX output is also
supported, but please do not expect anything fancy before you learn to customize
LaTeX templates. Most other output formats are not supported. No Word, RTF,
PowerPoint, or EPUB.</p>
<p>R Markdown is rendered via <code>litedown::fuse()</code>, which is similar to
<code>rmarkdown::render()</code> and <code>knitr::knit()</code>. Markdown is rendered via
<code>litedown::mark()</code>, which uses <strong>commonmark</strong> instead of Pandoc.</p>
<p>The <strong>commonmark</strong> package follows the GFM (GitHub Flavored Markdown) spec,
which can be seen as a subset of Pandoc’s Markdown. Therefore the <strong>litedown</strong>
package can be viewed as a small subset of the existing R Markdown ecosystem
(the latter is based on Pandoc). It aims at simplicity, lightweight, and speed,
at the cost of giving up some advanced features. This package is intended for
minimalists. Most users may prefer using tools based on Pandoc instead, such as
<strong>rmarkdown</strong> or Quarto, which offer richer features.</p>
<p>Is <strong>litedown</strong> really simple? From the developer’s perspective, yes, it is,
largely due to the limited scope of the package. From the user’s perspective,
some features are definitely not that simple. However, the point is that the
core is simple and small, and you can enable or disable most features. What’s
more, you can implement features by yourself if you know CSS/JS.</p>
<h2 id="sec:scope">Scope</h2>
<p>You can view <strong>litedown</strong> as a minimal re-implementation (<a class="cross-ref-fig" href="#fig:scope-litedown">1</a>)
of some core packages in the existing R Markdown ecosystem
(<a class="cross-ref-fig" href="#fig:scope-rmarkdown">2</a>), such as <strong>rmarkdown</strong> for reports, <strong>xaringan</strong> for
slides, <strong>bookdown</strong> for books, <strong>blogdown</strong> for websites, <strong>pkgdown</strong> for R
package sites, and <strong>pagedown</strong> for paged HTML documents.</p>
<p>$$\mathrm{litedown} = \min{\{R\}} + \{D_i\} - \{D_e\} + \{J\}$$</p>
<ul>
<li>
<p>\(R\) = <strong>knitr</strong> + <strong>evaluate</strong> + <strong>rmarkdown</strong> + <strong>bookdown</strong> +
<strong>blogdown</strong> + <strong>pagedown</strong> + <strong>pkgdown</strong> + <strong>xaringan</strong> + <strong>tufte</strong> +
<strong>distill</strong></p>
</li>
<li>
<p>\(D_i\) = (internal dependencies) <strong>commonmark</strong> + <strong>xfun</strong></p>
</li>
<li>
<p>\(D_e\) = (external dependencies) Pandoc + Bootstrap + jQuery + GitBook +
Hugo + paged.js + remark.js + tufte.css + distill.js/.css + …</p>
</li>
<li>
<p>\(J\) = Lightweight <a href="https://github.com/yihui/lite.js">vanilla JS/CSS</a></p>
</li>
</ul>
<div id="fig:scope-litedown" class="figure box">
<pre class="mermaid">classDiagram
  class litedown {
    +HTML/LaTeX
    +min [ * ]
    R-dep (xfun, commonmark)
    web-dep (lite.js)
  }
  class rmarkdown {
    +[ * ]
  }
  class bookdown {
    +[ * ]
  }
  class blogdown {
    +[ * ]
  }
  class pagedown {
    +[ * ]
  }
  class pkgdown {
    +[ * ]
  }
  class xaringan {
    +[ * ]
  }
  class tufte {
    +[ * ]
  }
  class distill {
    +[ * ]
  }
  litedown *-- rmarkdown
  litedown *-- bookdown
  litedown *-- blogdown
  litedown *-- pagedown
  litedown *-- pkgdown
  litedown *-- xaringan
  litedown *-- tufte
  litedown *-- distill
  classDef default fill:none
  style litedown fill:lightcyan
</pre>
<div class="caption">
<p><span class="ref-number-fig">1</span>
A minimal partial re-implementation of the R Markdown ecosystem as <strong>litedown</strong>.</p>
</div>
</div>
<div id="fig:scope-rmarkdown" class="figure box">
<pre class="mermaid">classDiagram
  direction BT
  class rmarkdown {
    +HTML/LaTeX
    +RTF/Word/PowerPoint/EPub/...
    R-dep (knitr, evaluate, ... 25)
    sys-dep (Pandoc)
    web-dep (Bootstrap/jQuery/...)
  }
  class bookdown {
    +Books
    R-dep (26)
    web-dep (GitBook...)
  }
  bookdown --|&gt; rmarkdown
  class blogdown {
    +Websites
    R-dep (33)
    sys-dep (Hugo)
  }
  blogdown --|&gt; bookdown
  class pagedown {
    +Paged HTML
    R-dep (38)
    web-dep (paged.js)
  }
  pagedown --|&gt; bookdown
  class distill {
    +Grid layout
    R-dep (48)
    web-dep (distill)
  }
  distill --|&gt; bookdown
  class pkgdown {
    +Package sites
    R-dep (52)
    web-dep (Bootstrap...)
  }
  pkgdown --|&gt; rmarkdown
  class xaringan {
    +HTML slides
    R-dep (32)
    web-dep (remark.js)
  }
  xaringan --|&gt; rmarkdown
  class tufte {
    +Two-column layout
    R-dep (26)
    web-dep (tufte.css)
  }
  tufte --|&gt; rmarkdown
  classDef default fill:none
  style rmarkdown fill:lightskyblue
</pre>
<div class="caption">
<p><span class="ref-number-fig">2</span>
A set of core packages in the R Markdown ecosystem. <code>R-dep()</code>
stands for recursive R package dependencies (with their numbers), <code>sys-dep</code>
stands for system dependencies, and <code>web-dep</code> stands for CSS/JS dependencies.</p>
</div>
</div>
<p>It is absolutely not the goal for <strong>litedown</strong> to become a substitute of tools
based on <strong>knitr</strong> and Pandoc, such as <strong>rmarkdown</strong> and Quarto. If you are not
sure if you should choose <strong>litedown</strong> or <strong>rmarkdown</strong>/Quarto, you may want to
choose the latter (especially Quarto).</p>
<h3 id="sec:features-out-of-scope">Features out of scope</h3>
<p>Output formats besides HTML and LaTeX are unlikely to be supported.<sup class="footnote-ref"><a href="#fn-2" id="fnref-2" data-footnote-ref>2</a></sup> If other
output formats are desired, you may use Pandoc to do the conversion.</p>
<p>For tables, only pipe tables are supported. Other table formats are not
recognized.</p>
<p>At the moment, <strong>litedown</strong> mainly supports R as the computing language. Other
languages might be added in the future, but please keep your expectation low,
because the support is unlikely to be as good as R. Back in 2013, I experimented
with a simple idea to run program code in other languages, and the outcome was
the <a href="https://github.com/yihui/runr"><strong>runr</strong></a> package. However, I forsook
simplicity after other sophisticated packages emerged, such as <strong>reticulate</strong>
and <strong>JuliaCall</strong>. I may revisit the idea in the future.</p>
<p>HTML widgets are not supported yet, but may be reimagined in the future with
some minimal support. Meanwhile, you are free to add arbitrary JS libraries to
your documents (<a class="cross-ref-sec" href="#sec:arbitrary-assets">5.9</a>), so it is entirely possible that you can
create HTML widgets on your own.</p>
<h2 id="sec:highlights">Highlights</h2>
<h3 id="sec:small-footprint">Small footprint</h3>
<p>Almost everything in <strong>litedown</strong> was written from scratch. The package is very
lightweight, with only two R package dependencies: <strong>commonmark</strong> and <strong>xfun</strong>.</p>
<p>It is a deliberate design choice to keep this package lightweight, to make it
relatively easy to use and simple to maintain. The functions <code>mark()</code> and
<code>fuse()</code> can be viewed as significantly trimmed-down versions of Pandoc and
<strong>knitr</strong>, respectively.</p>
<p>Just to give you a better idea about the “lightweight” (the numbers below refer
to <em>uncompressed</em> software and source code as of today):</p>
<ul>
<li>
<p>As the Markdown converter, Pandoc 3.5 is about 180Mb, and <strong>commonmark</strong> is
about 1Mb on my macOS.</p>
</li>
<li>
<p>Bootstrap’s CSS is about 12,000 lines (plus 1500 lines of JS), and
<strong>litedown</strong>’s base CSS is about 100 lines (no JS).</p>
</li>
<li>
<p>For paginating HTML documents,
<a href="https://cdn.jsdelivr.net/npm/pagedjs/">paged.js</a> has 33,000+ lines of code,
and my naive implementation,
<a href="https://github.com/yihui/lite.js/blob/main/js/pages.js">pages.js</a>, has
about 400 lines (200 lines of JS and 200 lines of CSS).</p>
</li>
</ul>
<p>Admittedly, pursuing lightweight requires sacrifice in features and quality
(e.g., my pages.js is far less sophisticated than paged.js), but overall I feel
the trade-off should be reasonable to those who prefer minimalism. With a 2Mb
footprint (the total file size of <strong>litedown</strong>, <strong>commonmark</strong>, and <strong>xfun</strong>),
you can:</p>
<ul>
<li>
<p>Write basic components of Pandoc’s Markdown (<a class="cross-ref-chp" href="#chp:syntax">3</a>), including
headings, table of contents (TOC), lists, tables, pipe figures, code blocks,
quotes, fenced Divs, LaTeX math, footnotes, and citations, etc.</p>
</li>
<li>
<p>Automatically number and cross-reference arbitrary elements
(<a class="cross-ref-sec" href="#sec:cross-references">3.3.8</a>), including but not limited to headings, figures,
tables, and equations.</p>
</li>
<li>
<p>Perform computing with code chunks and inline code expressions (<a class="cross-ref-chp" href="#chp:fuse">2</a>).</p>
</li>
<li>
<p>Create single-file reports/slides, or multiple-file books/websites
(<a class="cross-ref-chp" href="#chp:sites">7</a>).</p>
</li>
</ul>
<p>If you load additional JS/CSS assets, you can create more types of elements,
such as folded code blocks, tabsets, side elements, sticky TOC, and callout
blocks (<a class="cross-ref-chp" href="#chp:assets">5</a>).</p>
<h3 id="sec:live-preview-everything">Live preview everything</h3>
<p>To get started, run <code>litedown::roam()</code> and it will launch a file browser to let
you preview everything that can be rendered to HTML, such as <code>.md</code>, <code>.Rmd</code>, and
<code>.R</code> files (<a class="cross-ref-sec" href="#sec:live-preview">6.1</a>).</p>
<p>The rendering takes place in memory, which means it will not render <code>.html</code>
files on your disk, unless you request so. The page will be automatically
updated as you edit and save a file. This update-on-save feature can be turned
off, and then you can manually refresh the page to re-render the file whenever
you want.</p>
<p>You can open any file in your editor or the default system application by
clicking a button in the browser. You can also render a file or a project in a
new R session by clicking a button in the browser.</p>
<h3 id="sec:precise-parser">Precise parser</h3>
<p>The R Markdown parser stores the precise line and column numbers of code
elements. The location information is used in various places. For example, when
an error occurs, you will get a message that tells you the precise location in
the source. In editors that support ANSI links (such as the RStudio IDE), you
can even click on the message to go to a specific line/column in the source
document, so you can quickly and easily know where the error occurred exactly.
When previewing <code>.Rmd</code> documents with <code>roam()</code>, you will see line numbers on the
left side of code blocks. Clicking on these numbers will bring you to the lines
in the source.</p>
<p>Due to the fact that the parser is based on <strong>commonmark</strong> (instead of solely on
regular expressions like <strong>knitr</strong>’s parser), it can precisely recognize code
chunks and inline code, which means code within other verbatim code blocks or
comments will be untouched. For example:</p>
<pre><code class="language-md">````md
Below is not a code chunk but verbatim content
inside a fenced code block (with four backticks).

```{r}
1 + 1
```

Inline code expressions like `{r} 1+1` are not
parsed, either.
````
</code></pre>
<pre><code class="language-html">&lt;!--
Feel free to comment out anything, such as a code chunk:

```{r}
1 + 1
```
--&gt;
</code></pre>
<h3 id="sec:versioned-css-js-assets">Versioned CSS/JS assets</h3>
<p>By default, <strong>litedown</strong> produces bare minimal HTML output, but many features
can be enabled by adding CSS/JS assets (<a class="cross-ref-chp" href="#chp:assets">5</a>). You can freely choose
whatever versions that work for you to avoid potential future breakage when the
assets are upgraded. The assets are not bundled in the <strong>litedown</strong> package, but
hosted on CDN, so updating <strong>litedown</strong> will not update your assets.</p>
<p>The CSS and JS code for commonly used features do not depend on any frameworks
such as Bootstrap or jQuery. They are simply vanilla code written from scratch.
No generator was used (such as SCSS). The code is often relatively short, so you
could just fork the code, modify it, publish your own version, and use it if you
are not satisfied with the original version.</p>
<h3 id="sec:chunk-options-management">Chunk options management</h3>
<p>Chunk options are managed by an environment, i.e., <code>litedown::reactor()</code>
(<a class="cross-ref-sec" href="#sec:reactor">2.1.2</a>). Using an environment (as compared to a list like <strong>knitr</strong>’s
<code>opts_chunk</code>) means you can access the up-to-date chunk options anywhere,
because environments in R are mutable. I cannot explain how awkward <strong>knitr</strong>’s
<code>opts_current</code> has been. It is basically a lie—chunk options that you get from
<code>opts_current</code> are not necessarily “current”.</p>
<h3 id="sec:non-linear-order-of-execution">Non-linear order of execution</h3>
<p>A document does not have to be compiled in the linear order. With the chunk
option <code>order</code>, you can specify code chunks and inline code expressions to be
executed in an arbitrary order (<a class="cross-ref-sec" href="#sec:option-order">2.1.5.16</a>). For example, if you have an
abstract in the beginning of a document, and the abstract needs to use a number
calculated at the end of the document, you can let the abstract be compiled in
the end, although it appears earlier in the document.</p>
<p>I guess some users may want to kill me upon knowing this feature, and some may
send me flowers (although I’m not sure if they want to thank me or prepare the
flowers for my funeral). For those who want to kill me, please note that this
feature does not mean <strong>litedown</strong> is as awful as Jupyter notebooks. It means
you can specify a <em>fixed</em> order to execute code in the document. The order does
not have to be from beginning to end, but it is <em>deterministic</em>. In other words,
it does not mean you run code chunks in an arbitrary or random order that can
detriment reproducibility.</p>
<h3 id="sec:time-code-chunks">Time code chunks</h3>
<p>If you want to figure out which code chunks are time-consuming, simply set the
chunk option <code>litedown::reactor(time = TRUE)</code> (<a class="cross-ref-sec" href="#sec:option-time">2.1.5.23</a>) in the
beginning, and put <code>litedown::timing_data()</code> in the last code chunk. It will
tell you detailed information. In the <code>roam()</code> preview, the data will also
contain links to specific lines of code chunks, so you click to jump to a
specific code chunk.</p>
<h3 id="sec:table-output-for-data-frames-by-default">Table output for data frames by default</h3>
<p>Rectangular objects such as data frames (including tibbles) and matrices are
printed as tables by default (<a class="cross-ref-sec" href="#sec:option-tab">2.1.5.22</a>), and the number of rows is
limited to 10 by default to avoid generating huge tables by accident.</p>
<h3 id="sec:relieved-pain-of-paths">Relieved pain of paths</h3>
<p>File paths (such as image paths) have been a mess in <strong>knitr</strong>. My deepest
apologies for that. I have worked much harder in <strong>litedown</strong> in this regard.</p>
<h3 id="sec:output-in-memory-or-to-disk">Output in memory or to disk</h3>
<p>Functions such as <code>mark()</code>, <code>fuse()</code>, and <code>fuse_book()</code> can operate in memory
without writing to disk. By default, if you pass a file input, you get a file
output; if you pass text input, you get text output.</p>
<h3 id="sec:a-new-cache-system">A new cache system</h3>
<p>You can feel more confident with using the chunk option <code>cache = TRUE</code> in
<strong>litedown</strong> than in <strong>knitr</strong>. The new cache system is more robust and
intelligent (<a class="cross-ref-sec" href="#sec:option-cache">2.1.5.2</a>).</p>
<h3 id="sec:a-book-is-a-single-html-file">A book is a single HTML file</h3>
<p>Unlike <strong>bookdown</strong> and Quarto, <code>litedown::fuse_book()</code> renders multiple input
files to a single output file. Yes, your whole precious book is in a single
(HTML or PDF) file. Grab and go.</p>
<p>The assumption of single-file output for books has made several things a lot
easier. For example, if you want to search within the book, just press
<code>Ctrl + F</code> or <code>Command + F</code> in your browser as you usually do on any other web
page. You do not need a client-side search library. It is also quicker to jump
between chapters because they are on the same page. If you want to print the
HTML version of the book to PDF, just press <code>Ctrl + P</code> or <code>Command + P</code>.</p>
<p>I know you have a concern: wouldn’t the single HTML file be too heavy for the
browser? The answer is: you should be fine if you do not have too many images.
If you do, do not base64 encode them (which is the default), and you can also
lazy-load images to make the book load faster.</p>
<h3 id="sec:r-scripts-as-first-class-citizens">R scripts as first-class citizens</h3>
<p>An R script has the same status as an R Markdown document (<a class="cross-ref-sec" href="#sec:r-scripts">2.3</a>). You
can write Markdown in <code>#'</code> comments, and chunk options in <code>#|</code> comments (both
are optional). These are the only two rules to remember. Compared to
<code>knitr::spin()</code>, the rules are much simpler. Besides, R scripts are also
carefully parsed into “code chunks”, so their line numbers work as well as R
Markdown’s line numbers.</p>
<p>Any application that you can create with R Markdown can be created with R
scripts, such as books and websites.</p>
<h3 id="sec:clean-html-output">Clean HTML output</h3>
<p>The HTML output generated from <strong>litedown</strong> is very clean. For example, code
blocks in HTML output contain plain code, instead of full of <code>&lt;span&gt;</code> tags with
random attributes. Clean HTML output means the output file size is smaller, and
more importantly, it is easier to inspect the differences between two versions
of output (e.g., in Git). Every time when you update the source document, you
can know more clearly what has changed in the output, which can help you avoid
unexpected changes before publishing the output.</p>
<div class="chapter-after side side-right">
</div>
</div>
<div class="chapter body" data-source="docs/01-start.Rmd">
<div class="chapter-before side side-right">
<p><a href="https://github.com/yihui/litedown/edit/main/docs/01-start.Rmd">Edit this chapter</a> on GitHub</p>
</div>
<h1 id="chp:start"><span class="section-number main-number">1</span> Get Started</h1>
<div class="epigraph">
<blockquote>
<p>Things are in the saddle,<br />
And ride mankind.</p>
<p>—Ralph Waldo Emerson, <em>Ode, Inscribed to William H. Channing</em></p>
</blockquote>
</div>
<p>R Markdown documents need to be compiled to Markdown before being rendered to a
target output format such as HTML and LaTeX.</p>
<p>For those who are familiar with R Markdown, you can think of the function
<code>litedown::fuse()</code> as the new <code>knitr::knit()</code>, <code>litedown::fiss()</code> as the new
<code>knitr::purl()</code>, and <code>litedown::mark()</code> as the new Pandoc. <a class="cross-ref-fig" href="#fig:fuse-flow">3</a> shows
the conversion process from R Markdown to a target format.</p>
<div id="fig:fuse-flow" class="figure box">
<pre class="mermaid">flowchart LR
  A@{ shape: doc, label: &quot;*.Rmd&quot; }-. &lt;code&gt;fuse()&lt;/code&gt; .-o F@{ shape: bolt }
  F o--- B@{ shape: doc, label: &quot;*.md&quot; }
  B-. &lt;code&gt;mark()&lt;/code&gt; .-o G@{ shape: framed-circle }
  G --&gt; C@{ shape: doc, label: &quot;*.html&quot; }
  G --&gt; D@{ shape: doc, label: &quot;*.tex&quot; }
  G --&gt; E@{ shape: doc, label: &quot;...&quot; }
  A-. &lt;code&gt;fiss()&lt;/code&gt; .-o H@{ shape: cross-circ } --&gt; I@{ shape: lin-doc, label: &quot;*.R&quot; }
</pre>
<div class="caption">
<p><span class="ref-number-fig">3</span>
A diagram illustrating how <strong>litedown</strong> converts R Markdown documents to target output formats.</p>
</div>
</div>
<p>The function <code>fuse()</code> “fuses” program code with narratives, i.e., it executes
all code in the source document and interweaves results with narratives in the
output document; <code>fiss()</code> splits the document and extracts the code. Similar to
<strong>knitr</strong>, <strong>litedown</strong> supports code chunks (<a class="cross-ref-sec" href="#sec:code-chunks">2.1</a>) and inline code
(<a class="cross-ref-sec" href="#sec:inline-code">2.2</a>).</p>
<p>We will first introduce <code>fuse()</code> in <a class="cross-ref-chp" href="#chp:fuse">2</a>, and then <code>mark()</code> in <a class="cross-ref-chp" href="#chp:syntax">3</a>
and <a class="cross-ref-chp" href="#chp:mark">4</a>.</p>
<div class="callout-tip">
<p>If you do not do computing in Markdown, you do not need to learn
<code>fuse()</code>—<code>mark()</code> will be enough.</p>
</div>
<h2 id="sec:a-new-road-to-roam"><span class="section-number">1.1</span> A new road to <code>roam()</code></h2>
<p>Before entering the <strong>litedown</strong> world, I suggest you forget the <code>Knit</code> button
if it has become your muscle memory to click on that button to view results
after writing every single line of code. The recommended way to work with
<strong>litedown</strong> is <code>litedown::roam()</code>, which allows you to preview and render
documents through a web interface.</p>
<p>To help you bid goodbye to the <code>Knit</code> button, please take 5 minutes to practice
the following mouse-clicking exercise (but try not to be addicted):</p>
<div class="new-road">
<p><button class="old-knit">Knit</button></p>
<p><button class="new-fuse">Render</button> <button class="new-fuse new-preview">Run</button></p>
</div>
<p>If the <code>Knit</code> button still sticks to your mind after you have practiced for a
few hundred times, I’d like to thank you for your loyalty to <strong>knitr</strong>, and
please see <a class="cross-ref-sec" href="#sec:knit-button">6.3</a> for how to continue to use the <code>Knit</code> button with
<strong>litedown</strong>.</p>
<p>You can learn more about the <code>Render</code> and <code>Run</code> buttons in <a class="cross-ref-sec" href="#sec:live-preview">6.1</a>.
Basically, the <code>Render</code> button renders a document to an output file, whereas the
<code>Run</code> button renders a document in memory without writing to disk.</p>
<div class="callout-tip">
<p>Unless you use <strong>litedown</strong> programmatically (i.e., in scripts), you should
rarely need to call <code>fuse()</code> or <code>mark()</code> directly—<code>litedown::roam()</code> will call
<code>fuse()</code> and <code>mark()</code> for you behind the scenes.</p>
</div>
<h2 id="sec:a-minimal-example"><span class="section-number">1.2</span> A minimal example</h2>
<p>To understand what <code>fuse()</code> does, we look at a minimal example:</p>
<div class="flex-col">
<pre><code class="language-md" data-file="001.Rmd">---
title: The area of a circle
---

Define the radius of a circle as `x`:

```{r}
x = 1 + 1
x
```

The area of the circle with a radius of `x` is `{r} pi * x^2`.
</code></pre>
<pre><code class="language-md" data-file="001.md">---
title: The area of a circle
---

Define the radius of a circle as `x`:

``` {.r}
x = 1 + 1
x
```

```
#&gt; [1] 2
```

The area of the circle with a radius of `x` is 12.6.
</code></pre>
</div>
<p>When we <code>fuse()</code> the source document, the program code will be executed, writing
results to the output.</p>
<p>You can see that the value <code>2</code> was assigned to the object <code>x</code> in a code chunk,
and the inline R expression <code>pi * x^2</code> was also evaluated to a number.</p>
<p>The advantage of interweaving computing code with text is that you can freely
update the source code according to the purpose of computing, and you will get
the up-to-date results after rebuilding the document. For example, you can
change <code>x</code> to <code>3</code>, and the area of the circle will be automatically updated
after you re-run <code>fuse()</code>. You do not need to copy and paste computational
outcome manually from one place to another.</p>
<h2 id="sec:basic-concepts"><span class="section-number">1.3</span> Basic concepts</h2>
<p>A computational document contains both text narratives and code for computing.
<a class="cross-ref-fig" href="#fig:flow-concepts">4</a> shows the basic components of a document and how they work
together.</p>
<div id="fig:flow-concepts" class="figure box">
<pre class="mermaid">flowchart TD
  O@{ shape: lin-doc, label: &quot;Input document&quot; }--&quot;crack()&quot;--&gt; A@{ shape: f-circ } -.-o B[[YAML]]
  A -.-o C[[Text chunk]]
  C -.- C1&gt;Text] --- C12{ } --&gt; H[[Text output]]
  C -.- C2&gt;Inline code]--&gt; F{Value} --&gt; H
  C -.- C3&gt;More...] --- C32{ } --&gt; H
  A -.-o D[[Code chunk]]
  D -.- D1&gt;Chunk options]
  D -.- D2&gt;Code]--&gt; G{Results} --&gt; I[[Chunk output]]
  A -.-o E[[More chunks...]] -.- K&gt;...] --&gt; L{...} --&gt; M[[More output...]] -.-&gt; J
  H -.-&gt; J@{ shape: doc, label: &quot;Markdown&quot; }
  I -.-&gt; J
  B -.-&gt; P&gt;...] --&gt; Q{...} --&gt; R[[YAML]] -.-&gt; J
  J--&quot;mark()&quot; --&gt; N@{ shape: tag-doc, label: &quot;Output document&quot; }
  subgraph &quot;fuse()&quot;
  C1
  C2
  C3
  D1
  D2
  K
  P
  end
  class O,J,N document
  classDef document stroke-width:3px
  class C12,F,C32,G,L,Q fuse-out
  classDef fuse-out fill:lightyellow
  class H,I,J,M,N,R output
  classDef output fill:none
</pre>
<div class="caption">
<p><span class="ref-number-fig">4</span>
An illustration of the structure of a computational document and how its components are split, computed, and merged.</p>
</div>
</div>
<p>First, the input is split into three types of blocks: the YAML metadata, text
chunks, and code chunks.</p>
<p>The <em>YAML metadata</em> contains information such as the title, author, date, and
other configurations for the document.</p>
<p>A <em>text chunk</em> could consist entirely of plain-text narratives that do not
require computing, or contain both text fragments and <em>inline code expressions</em>.
In the latter case, the inline code can be executed to return its value to the
output.</p>
<p>A <em>code chunk</em> contains code that often does more sophisticated computing than
inline code. Optionally, a code chunk can contain <em>chunk options</em> to control the
behavior of the computing and output.</p>
<p>After all code has been executed, the output blocks will be merged to a Markdown
document, which can be further rendered to a target output format such as HTML
and LaTeX.</p>
<div id="fig:humpty-dumpty" class="figure box">
<p><img src="https://upload.wikimedia.org/wikipedia/commons/b/b2/Humpty_Dumpty_1_-_WW_Denslow_-_Project_Gutenberg_etext_18546.jpg" alt="Humpty Dumpty" /></p>
<div class="caption">
<p><span class="ref-number-fig">5</span> After raising two kids for a few years, I have been so
deeply brainwashed by nursery rhymes that it was Humpty Dumpty that came to my
mind when I was thinking about an example to explain computational documents.
Don’t be surprised if you run across Blippi and garbage trucks somewhere in this
book.</p>
</div>
</div>
<p>Take the following document for example:</p>
<pre><code class="language-md" data-file="*.Rmd">---
title: &quot;A Report on the Wall&quot;
author: &quot;`{r} who`&quot;
date: &quot;`{r} Sys.Date()`&quot;
---

```{r, order = 0}
who = 'Humpty Dumpty'
```

`{r} who` sat on a wall.

`{r} who` had a great fall.

```{r}
broken = strsplit(who, ' ') |&gt; unlist()
```

All the king's horses and all the king's men

Couldn't put `{r} broken[1]` together again.

&lt;!--
If the king's horses and men knew R, they could've put
Humpty together again by paste(broken, collapse = ' ').
--&gt;
</code></pre>
<p>The YAML metadata is provided between <code>---</code> and <code>---</code> in the beginning. Note
that it can also contain code to be evaluated, such as the variable <code>who</code> and
the function call <code>Sys.Date()</code>.</p>
<p>The document has two code chunks in triple-backtick (<code>```</code>) fences. The
first code chunk contains a chunk option <code>order = 0</code> (you may see
<a class="cross-ref-sec" href="#sec:option-order">2.1.5.16</a> for its meaning later). You can do any computing in code
chunks and generate text results or graphics.</p>
<p>There are two text chunks: one between the two code chunks, and one after the
second code chunk. These text chunks contain inline R code expressions in
<code>`{r} `</code>. An inline code expression is typically used to get a single value.</p>
<p>In the end, there is a comment in <code>&lt;!-- --&gt;</code>. Comments will not be displayed in
the output document.</p>
<h2 id="sec:a-few-words-on-naming"><span class="section-number">1.4</span> A few words on naming</h2>
<p>When I started writing the <strong>litedown</strong> package, I was thinking of nuclear
fusion reactions (although my knowledge in physics is quite limited): text and
code chunks are like atomic nuclei, and they can be combined to form a report.
The process is controlled by a reactor. That was how I came up with the function
names <code>fuse()</code> and <code>reactor()</code>.</p>
<p>To prepare the atomic nuclei, I need to <code>crack()</code> the source document. When the
input is not a document but a script, I will <code>sieve()</code> out the elements from
comments. The fusion reaction can take place after <code>crack()</code> or <code>sieve()</code> is
done.</p>
<p>Maybe the neurons in my brain are wired in an odd way, but I feel mysteriously
happy that the names <code>crack()</code> and <code>sieve()</code> weakly resembles my friend Carson
Sievert’s name. For that reason, Carson will live in my heart forever, even if
he would never send a pull request to <strong>litedown</strong>.</p>
<p>Since there also exist fission reactions, the function <code>fiss()</code> is meant to
decompose a document.</p>
<p>As for the package name “litedown”, it has three meanings:</p>
<ol>
<li>
<p>The obvious meaning is the lightweight of the package.</p>
</li>
<li>
<p>The less obvious meaning is that light comes down from the fusion reactor
like the Sun. This meaning is represented by the symbol for <code>fuse()</code>, which
is a zigzag arrow (↯).</p>
</li>
<li>
<p>Finally, it is a play on the phrase “lie down”. I intended to write this
package as my last “down” package. After it is done, I wish to lie down.</p>
</li>
</ol>
<p>Let there be light.</p>
<div class="chapter-after side side-right">
</div>
</div>
<div class="chapter body" data-source="docs/02-fuse.Rmd">
<div class="chapter-before side side-right">
<p><a href="https://github.com/yihui/litedown/edit/main/docs/02-fuse.Rmd">Edit this chapter</a> on GitHub</p>
</div>
<h1 id="chp:fuse"><span class="section-number main-number">2</span> Computing</h1>
<div class="epigraph">
<blockquote>
<p>If you give someone a program, you will frustrate them for a day; if you teach
them how to program, you will frustrate them for a lifetime.</p>
<p>—David Leinweber</p>
</blockquote>
</div>
<p>In this chapter, we introduce how to manage computing in computational
documents. The computing may be done in code chunks, inline code expressions,
script files, and in R or other languages.</p>
<h2 id="sec:code-chunks"><span class="section-number">2.1</span> Code chunks</h2>
<p>A code chunk is a fenced code block that consists of: 1) the language (or
engine) name, 2) chunk options that control the behavior of computing and
output, and 3) the program code. It is of the following form:</p>
<pre><code class="language-md">```{lang}
#| chunk options

code
```
</code></pre>
<p>Whitespaces are allowed between the opening <code>```</code> and <code>{</code>. The language
name should begin with only alphanumeric characters (<code>a-z</code>, <code>A-Z</code>, <code>0-9</code>) and
underscores (<code>_</code>). If any other character is used or there are no curly braces
in the chunk header, the chunk will be treated as a normal fenced code block in
Markdown, instead of a code chunk for computing. Below are some examples of
normal code blocks:</p>
<pre><code class="language-md">```r
# lack of {} in the header
```

``` {.r, echo = FALSE}
# the language name should not start with &quot;.&quot;
```
</code></pre>
<p>In this book, we use the term “code block” to refer to <em>plain Markdown</em> code
blocks, and “code chunk” to refer to <em>executable</em> code chunks.</p>
<h3 id="sec:option-syntax"><span class="section-number">2.1.1</span> Syntax for chunk options</h3>
<p>The chunk options can be provided in the chunk header after the language name,
or in the chunk body as pipe comments (<code>#|</code>).</p>
<ul>
<li>
<p>Chunk options in the chunk header must be provided in the comma-separated
tag-value pairs, except for the chunk label, of which the tag <code>label</code> can be
omitted.</p>
</li>
<li>
<p>Chunk options in the chunk body must be provided in <code>#|</code> comments in the
beginning. They can use either the comma-separated or YAML syntax. When
using the comma-separated syntax, you can wrap the comments freely.</p>
</li>
</ul>
<p>For the comma-separated syntax, the option value can be provided via arbitrary R
code as long as it is syntactically valid. The code will be evaluated when the
value is needed (i.e., the evaluation is lazy).</p>
<p>Below are examples showing different ways to write chunk options:</p>
<ul>
<li>
<p>Options in the chunk header (the chunk label is <code>foo</code>, which can also be
written as <code>label = &quot;foo&quot;</code>):</p>
<pre><code class="language-md">```{r, foo, echo = FALSE, fig.height = 6, fig.cap = &quot;A scatterplot.&quot;}
plot(cars)
```
</code></pre>
</li>
<li>
<p>Comma-separated options in pipe comments:</p>
<pre><code class="language-md">```{r}
#| foo, echo = FALSE, fig.height = 6,
#| fig.cap = &quot;A scatterplot.&quot;

plot(cars)
```
</code></pre>
</li>
<li>
<p>YAML options in pipe comments:</p>
<pre><code class="language-md">```{r}
#| label: &quot;foo&quot;
#| echo: false
#| fig.height: 6
#| fig.cap: &quot;A scatterplot.&quot;

plot(cars)
```
</code></pre>
</li>
</ul>
<p>You can use <code>#|</code> for any language, although not all languages use <code>#</code> as the
comment character. If you prefer, you can use language-specific comments and add
pipes after the comment characters to write chunk options, e.g., <code>//|</code> for
JavaScript. You can find the supported comment characters for different
languages in <code>xfun:::comment_chars</code>. Here are a few of them:</p>
<pre><code class="language-r">str(xfun:::comment_chars[c('css', 'fortran', 'js', 'r')])
</code></pre>
<pre><code>#&gt; List of 4
#&gt;  $ css    : chr [1:2] &quot;/*&quot; &quot;*/&quot;
#&gt;  $ fortran: chr &quot;!&quot;
#&gt;  $ js     : chr &quot;//&quot;
#&gt;  $ r      : chr &quot;#&quot;
</code></pre>
<p>For languages that use opening and closing comment delimiters such as C and CSS,
you do not need to repeat the comment pipe on every line, e.g.,</p>
<pre><code class="language-md">```{css}
/*| label = 'foo',
    echo = FALSE   */

p { color: red; }
```
</code></pre>
<p>In this book, I will write options in the chunk header when they are relatively
short, and write them in pipe comments when they are too long to fit one line.</p>
<p>See <a class="cross-ref-sec" href="#sec:chunk-options">2.1.5</a> for the full list of possible chunk options.</p>
<h3 id="sec:reactor"><span class="section-number">2.1.2</span> The chunk option manager</h3>
<p>All chunk options are managed internally via <code>litedown::reactor()</code>. To get an
option value, call <code>reactor(&quot;NAME&quot;)</code>, where <code>NAME</code> is the option name (e.g.,
<code>fig.width</code>). To set an option globally for all code chunks, call
<code>reactor(NAME = VALUE)</code>.</p>
<div class="callout-note">
<p>If an option is set in both <code>reactor()</code> and a code chunk (<a class="cross-ref-sec" href="#sec:option-syntax">2.1.1</a>),
the value in the chunk wins. For example, if you have set
<code>litedown::reactor(echo = FALSE)</code> previously, and <code>echo = TRUE</code> in a chunk
header, the chunk option <code>echo</code> will be <code>TRUE</code> for this chunk.</p>
</div>
<p>Alternatively, you can manipulate the value returned by <code>reactor()</code> directly,
which is essentially an environment:</p>
<pre><code class="language-r">opts = litedown::reactor()
opts$fig.width  # get an option
opts$echo = FALSE  # set an option via assignment
</code></pre>
<p>You can call <code>reactor()</code> anywhere to get or set chunk options. For example, you
can call it inside a code chunk. Please note that when you call it to change
global chunk options <em>outside</em> an R Markdown document, we recommend that you
restore the original options afterwards to limit the scope of the changes,
otherwise the changes may affect the behavior of other documents unexpectedly.
To restore options, you need to save the old option values, e.g.,</p>
<pre><code class="language-r"># reactor() returns old values after setting new values
old_opts = litedown::reactor(echo = FALSE, fig.height = 6)

# fuse a document with new global chunk options
litedown::fuse(&quot;foo.Rmd&quot;)

# restore old option values
litedown::reactor(old_opts)
</code></pre>
<p>This is unnecessary if you call <code>reactor()</code> inside a document, since global
chunk options are always restored when <code>fuse()</code> finishes compiling the document,
e.g.,</p>
<pre><code class="language-md">```{r, setup}
litedown::reactor(echo = FALSE)
```

```{r}
# echo = FALSE will be applied to this chunk
1 + 1
```
</code></pre>
<p>The chunk option <code>echo</code> will be restored to <code>TRUE</code> after <code>fuse()</code> finishes this
document.</p>
<h3 id="sec:skipped-chunks"><span class="section-number">2.1.3</span> Skipped code chunks</h3>
<p>Code chunks inside other code blocks are not parsed or evaluated, which provides
a way to write verbatim code chunks, e.g.,</p>
<pre><code class="language-md">````md
Some verbatim content.

```{r}
1 + 1
```
````
</code></pre>
<p>Similarly, code in HTML comments (<code>&lt;!-- --&gt;</code>) will not be recognized, either,
e.g.,</p>
<pre><code class="language-html">&lt;!--
Do not run this chunk:

```{r}
1 + 1
```

or the inline code `{r} pi`.
--&gt;
</code></pre>
<h3 id="sec:show-chunk-fences-in-output"><span class="section-number">2.1.4</span> Show chunk fences in output</h3>
<p>If <code>N + 1</code> pairs of curly braces are used in the opening fence, the chunk fences
(with <code>N</code> pairs of curly braces) and chunk options will be shown in the output,
which can be useful for telling readers the full source of a chunk, e.g.,</p>
<div class="callout-example">
<pre><code class="language-md">```{{r}}
#| echo = TRUE, eval = FALSE

1 + 1
```
</code></pre>
</div>
<div class="callout-output">
<div class="fenced-chunk">
<pre><code class="language-md code-fence">```{r}
#| echo = TRUE, eval = FALSE
</code></pre>
<pre><code class="language-r">1 + 1
</code></pre>
<pre><code class="language-md code-fence">```
</code></pre>
</div>
</div>
<h3 id="sec:chunk-options"><span class="section-number">2.1.5</span> All chunk options</h3>
<p>All supported chunk options are listed alphabetically below.</p>
<h4 id="sec:option-attr"><span class="section-number">2.1.5.1</span> <code>attr.*</code>: attributes for output elements</h4>
<p>The <code>attr.*</code> options can be used to customize different types of output
elements, such as source code blocks, messages, and plots, etc. To understand
these options, you need to learn the Markdown syntax in <a class="cross-ref-sec" href="#sec:attributes">3.3.5</a> and
<a class="cross-ref-sec" href="#sec:fenced-divs">3.3.7</a>.</p>
<p><a class="cross-ref-fig" href="#fig:attr-structure">6</a> illustrates the structure of Markdown output from a code
chunk (the class names in the figure such as <code>.chunk</code> are not names used in the
actual output but for illustration only).</p>
<style type="text/css">
.attr-blocks {
  margin: 1em auto;
  max-width: 30em;
  border-right: 1px solid;
  pre { margin: 0 2em; }
  code { padding: .5em; border-left: 1px solid; }
  .source-block { border-left-color: orangered; }
  pre:has(.open-fence, .close-fence) {
    code { border-left-width: 2px; }
  }
  pre:has(.open-fence) {
    margin-top: 1em;
    &:first-child { margin: 0 0 1em 0; }
  }
  pre:has(.close-fence) {
    margin-bottom: 1em;
    &:last-child { margin: 1em 0 0; }
  }
}
</style>
<div id="fig:attr-structure" class="figure box">
<div class="attr-blocks fenced-chunk">
<pre><code class="language-md open-fence code-fence">:::: {.chunk}
</code></pre>
<pre><code class="language-md open-fence code-fence source-block">``` {.source}
</code></pre>
<pre><code class="language-r source-block">1:2 + 1:3
</code></pre>
<pre><code class="language-md close-fence code-fence source-block">```
</code></pre>
<pre><code class="language-md open-fence code-fence">``` {.output}
</code></pre>
<pre><code>#&gt; [1] 2 4 4
</code></pre>
<pre><code class="language-md close-fence code-fence">```
</code></pre>
<pre><code class="language-md open-fence code-fence">``` {.warning}
</code></pre>
<pre><code class="language-plain warning">#&gt; longer object length is not a multiple of ...
</code></pre>
<pre><code class="language-md close-fence code-fence">```
</code></pre>
<pre><code class="language-md open-fence code-fence source-block">``` {.source}
</code></pre>
<pre><code class="language-r source-block">plot(cars)
</code></pre>
<pre><code class="language-md close-fence code-fence source-block">```
</code></pre>
<pre><code class="language-md">![alt](*__files/*.png){.plot}
</code></pre>
<pre><code class="language-md close-fence code-fence">::::
</code></pre>
</div>
<div class="caption">
<p><span class="ref-number-fig">6</span> An illustration of the output structure of a code
chunk.</p>
</div>
</div>
<p>The source code, text output, and messages (including warnings and errors) are
formatted as fenced code blocks. Plots are written in <code>![]()</code>. The whole chunk
can be wrapped in a fenced <code>Div</code> (<a class="cross-ref-sec" href="#sec:fenced-divs">3.3.7</a>). The <code>attr.*</code> options will
add attributes to these fenced code blocks, plots, and fenced <code>Div</code>s.</p>
<ul>
<li>
<p><code>attr.asis</code>: When provided and the chunk option <code>results = 'asis'</code>, text
output will be wrapped in a fenced <code>Div</code> using attributes from this option.
By default, this option is empty, and the fenced <code>Div</code> is not generated.</p>
</li>
<li>
<p><code>attr.chunk</code>: When provided, the whole chunk will be wrapped in a fenced
<code>Div</code> with attributes from this option. By default, it is empty.</p>
</li>
<li>
<p><code>attr.error</code>: Attributes for error message blocks. The default is
<code>.plain .error</code> (i.e., two class names <code>plain</code> and <code>error</code> will be added to
error blocks). The class name <code>plain</code> is to avoid syntax highlighting.</p>
</li>
<li>
<p><code>attr.message</code>: Attributes for message blocks generated by <code>message()</code>. The
default is <code>.plain .message</code>.</p>
</li>
<li>
<p><code>attr.output</code>: Attributes for text output blocks. By default, it is empty.</p>
</li>
<li>
<p><code>attr.plot</code>: Attributes for plots. If a code chunk produces multiple plots,
you may provide a vector to <code>attr.plot</code> so that <em>i</em>-th element of the vector
is applied to the <em>i</em>-th plot. For example, if a code chunk has two plots,
you may use <code>attr.plot = c('width=&quot;40%&quot;', 'width=&quot;60%&quot;')</code> to set the width
of the first plot to <code>40%</code>, and the second plot to <code>60%</code>.</p>
</li>
<li>
<p><code>attr.source</code>: Attributes for the source blocks. By default, it uses the
language name of the code chunk as the class name. For example, for
<code>```{r}</code>, the attribute <code>.r</code> will be used.</p>
</li>
<li>
<p><code>attr.warning</code>: Attributes for warning blocks. The default is
<code>.plain .warning</code>.</p>
</li>
</ul>
<p>Below is an example of using options <code>attr.chunk</code>, <code>attr.source</code>, and
<code>attr.plot</code>:</p>
<pre><code class="language-md" data-file="002.Rmd">---
title: The `attr.*` chunk options
---

1. Add an ID `#example-a` to the whole chunk.

2. Add line numbers to source blocks via the `.line-numbers` class.

3. Add the class `.round` to the first plot and set its width to 400px.

4. Add two classes `.dark` and `.img-center` to the second plot.

```{r}
#| example-a,
#| attr.chunk = '#example-a',
#| attr.source = '.line-numbers',
#| attr.plot = c('.round width=&quot;400&quot;', '.dark .img-center'),
#| fig.alt = c('A scatterplot of rnorm(100) numbers.',
#|   'A sunflower plot of iris.')

plot(rnorm(100), rnorm(100))
i34 = iris[, 3:4]
smoothScatter(i34)
sunflowerplot(i34, add = TRUE)
```

Define CSS rules for the classes in the `#example-a` chunk:

```{css}
#example-a {
  .round { border: solid 1px; border-radius: 50%; }
  .dark  { filter: invert(1); }
  .img-center { display: block; margin: auto; }
}
```
</code></pre>
<p>Here is an example of creating a callout (<a class="cross-ref-sec" href="#sec:callout-blocks">5.5</a>) from a code
chunk:</p>
<pre><code class="language-md" data-file="003.Rmd">---
title: Create a callout via the option `attr.chunk`
output:
  html:
    meta:
      css: [&quot;@default&quot;, &quot;@callout&quot;]
      js: [&quot;@callout&quot;]
---

If you use the class name `.callout-*` on a chunk, you can turn it into a callout, e.g.,

```{r}
#| attr.chunk = '.callout-example'

1 + 1
```

Remember to load the `callout` CSS/JS assets in YAML.
</code></pre>
<h4 id="sec:option-cache"><span class="section-number">2.1.5.2</span> <code>cache</code>: speed up the computing</h4>
<blockquote>
<p>There are only two hard things in Computer Science: cache invalidation and
naming things.</p>
<p>—Phil Karlton</p>
</blockquote>
<p>You can cache the computing of code chunks via the chunk option <code>cache = TRUE</code>.
When a code chunk is cached, the computing will be skipped when the document is
compiled on the next time if the source code in the chunk has not
changed<sup class="footnote-ref"><a href="#fn-02-fuse-1" id="fnref-02-fuse-1" data-footnote-ref>3</a></sup> and the external dependencies used by the chunk have not
changed, either, otherwise the cache will be invalidated and the results will be
re-computed.</p>
<p>The key to understand cache (in)validation is understanding the “external
dependencies” of a code chunk. A common dependency is <em>external variables</em>. For
example, <code>x</code> is an external (or global) variable and <code>y</code> is an internal (or
local) variable in the following chunk:</p>
<pre><code class="language-md">```{r}
y = x + 1
```
</code></pre>
<p>That is because <code>y</code> is defined inside the code chunk, and <code>x</code> must come from
elsewhere, otherwise the code chunk will throw an error (“object <code>x</code> not
found”).</p>
<p>When cache is enabled on a code chunk, the global and local variables will be
automatically inferred from the code. If the value of any global variable has
changed, the cache will be invalidated. Local variables will be saved in a
current run, and (lazy-)loaded<sup class="footnote-ref"><a href="#fn-02-fuse-2" id="fnref-02-fuse-2" data-footnote-ref>4</a></sup> in the next run, so they can be
available to later code chunks in the document.</p>
<p>Another common dependency is external data sources. For example, if the data
file <code>foo.csv</code> has been updated in the following chunk, we may want to
invalidate the cache and read the file again:</p>
<pre><code class="language-md">```{r, cache = TRUE}
z = read.csv('foo.csv')
```
</code></pre>
<p><a class="cross-ref-fig" href="#fig:flow-cache">7</a> illustrates how the cache system works. The code expression,
global variables, and other dependencies will be summarized into a hash (a
character string), which will be used to check if the cache exists. Any change
in the input of the hash will lead to a change in the hash value, which in turn
invalidates the old cache and creates new cache.</p>
<div id="fig:flow-cache" class="figure box">
<pre class="mermaid">flowchart TD
  A[[Code chunk]]--&quot;parse()&quot;--&gt; B1&gt;Expression]
  A--&quot;xfun::find_globals()&quot;--&gt; B2&gt;Global variables]
  A--&quot;cache.extra&quot;--&gt; B3&gt;Other dependencies]
  B1--&quot;deparse()&quot;--&gt; C((Hash))
  B2 --&gt; C
  B3 --&gt; C
  C--find cache--&gt; D@{ shape: f-circ }
  D--&quot;No (re-run code)&quot;--&gt; E@{ shape: lin-cyl, label: &quot;New cache&quot; }
  D--&quot;Yes (skip running)&quot;--&gt; F[(Load cache)]--import--&gt; G@{ shape: bow-rect, label: &quot;Local variables&quot; }
  E--&quot;export&quot;--&gt; G
  style C stroke-dasharray:5 5,stroke-width:3px,color:orangered
  style E fill:lightyellow
</pre>
<div class="caption">
<p><span class="ref-number-fig">7</span>
The cache (in)validation process.</p>
</div>
</div>
<p>Besides the option <code>cache</code>, below are other chunk options that allow you to
customize the cache system:</p>
<ul>
<li>
<p><code>cache.path</code>: The path to save the cache. If the path is intended to be a
directory path, please add a trailing slash. By default, the path is set to
<code>INPUT__cache/</code>, where <code>INPUT</code> is the input file path to <code>fuse()</code>. For
example, if you <code>fuse('foo.Rmd')</code>, the default cache path will be
<code>foo__cache/</code>. If the input is not a file, <code>litedown__cache/</code> will be used.</p>
<p>The special value <code>:memory:</code> means in-memory caching, meaning that the cache
will be stored in memory, which is faster than writing to disk but the cache
will be lost once the R session quits.</p>
</li>
<li>
<p><code>cache.vars</code>: Names of local variables. By default, local variables are
automatically detected from the expression via <code>xfun::find_locals()</code>.
Locally created variables are cached along with the full output of the code
chunk. They will be re-loaded the next time the code chunk is recompiled,
unless the cache is invalidated.</p>
</li>
<li>
<p><code>cache.hash</code>: Names of R variables to be used to determine if cache should
be loaded or invalidated. By default, it is the names of global variables
automatically detected by <code>xfun::find_locals()</code> from the code chunk. You can
provide a vector of names to override the automatic detection if you want
some specific global variables to affect caching, or if the automatic
detection is not reliable.</p>
<p>Alternatively, you can also pass a list object containing values that should
affect caching (i.e., if any of these values change, the cache should be
invalidated). Please avoid using too large objects, since hashing them may
be slow.</p>
</li>
<li>
<p><code>cache.extra</code>: Additional information to validate the cache. For example, if
the code reads an external file <code>foo.csv</code>, and you want the cache to be
invalidated after the file is modified, you may use
<code>extra = file.mtime(&quot;foo.csv&quot;)</code> (i.e., use the file modification time for
validation).</p>
</li>
<li>
<p><code>cache.keep</code>: By default, only one copy of the cache is kept, and all other
copies are automatically purged.</p>
<ul>
<li>
<p>If <code>TRUE</code>, all copies of the cache are kept, which can be useful when
you are experimenting with different changes and have not decided the
version of the change to use. You can always go back to a certain
version, and the cache corresponding to that version still exists.</p>
</li>
<li>
<p>If <code>FALSE</code>, all copies are removed, which means the cache is <em>always</em>
invalidated, and can be useful to force re-executing the code, after
which you can clear this option to resume the default behavior of
keeping one copy.</p>
</li>
</ul>
</li>
<li>
<p><code>cache.rw</code>: A list of functions to read/write the cache files. The list is
of the form
<code>list(name = 'xxx', load = function(file) {}, save = function(x, file) {})</code>.
This argument can also take a character string to use some built-in
read/write methods. currently including:</p>
<ul>
<li>
<p><code>rds</code>: The default, using <code>readRDS()</code> and <code>saveRDS()</code>.</p>
</li>
<li>
<p><code>raw</code>: Using <code>serialize()</code> and <code>unserialize()</code>). Note that the <code>rds</code>
method generates smaller files because it uses compression, but is often
slower than the <code>raw</code> method, which does not use compression.</p>
</li>
<li>
<p><code>qs</code>: Using <code>qs::qread()</code> and <code>qs::qsave()</code>). It requires the <strong>qs</strong>
package, which can be much faster than the above base R methods and also
supports compression.</p>
</li>
</ul>
</li>
</ul>
<p>A special application of the <code>cache.hash</code> option is to freeze the computation of
a code chunk, meaning that the cache will not be affected by any variable, even
if the chunk uses global variables. To do this, you can set <code>cache.hash</code> to any
non-character constant, e.g., <code>cache.hash = FALSE</code>. Since <code>FALSE</code> is a constant
that cannot be changed by any variable, the cache will not be invalidated by
changes in any variable.</p>
<div class="callout-caution">
<p>With great power comes great responsibility. Freezing the cache can make it
faster to compile the document, but you may get outdated and/or inconsistent
computational results when the old cache should have been invalidated. Please
make sure you understand what you are doing before freezing the cache.</p>
</div>
<h4 id="sec:option-cap-pos"><span class="section-number">2.1.5.3</span> <code>cap.pos</code>: caption position</h4>
<p>Possible values are <code>'top'</code> and <code>'bottom'</code>. By default, figure captions are
placed below figures, and table captions are placed above tables.
<a class="cross-ref-tab" href="#tab:tab-bottom">1</a> shows an example of a table caption at the bottom.</p>
<div class="fenced-chunk">
<pre><code class="language-md code-fence">```{r}
#| tab-bottom, cap.pos = 'bottom', tab.env = '.table .box',
#| tab.cap = 'A table caption at the bottom via `cap.pos = &quot;bottom&quot;`.'
</code></pre>
<pre><code class="language-r">head(cars, 4)
</code></pre>
<div id="tab:tab-bottom" class="table box">
<table>
<thead>
<tr>
<th align="right">speed</th>
<th align="right">dist</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">4</td>
<td align="right">2</td>
</tr>
<tr>
<td align="right">4</td>
<td align="right">10</td>
</tr>
<tr>
<td align="right">7</td>
<td align="right">4</td>
</tr>
<tr>
<td align="right">7</td>
<td align="right">22</td>
</tr>
</tbody>
</table>
<div class="caption">
<p><span class="ref-number-tab">1</span>
A table caption at the bottom via <code>cap.pos = &quot;bottom&quot;</code>.</p>
</div>
</div>
<pre><code class="language-md code-fence">```
</code></pre>
</div>
<p>You can test different positions for both figures and tables in the following
example.</p>
<pre><code class="language-md" data-file="004.Rmd">---
title: Caption position
---

## Default caption positions

```{r, fig-bottom, fig.cap = 'Bottom figure caption.'}
plot(cars)
```

```{r, tab-top, tab.cap = 'Top table caption.'}
cars
```

## Change the positions

```{r, fig-top, fig.cap = 'Top figure caption.', cap.pos = 'top'}
plot(cars)
```

```{r, tab-bottom, tab.cap = 'Bottom table caption.', cap.pos = 'bottom'}
cars
```
</code></pre>
<h4 id="sec:option-child"><span class="section-number">2.1.5.4</span> <code>child</code>: child documents</h4>
<p>The <code>child</code> option can take a vector of file paths to other <code>.Rmd</code> files, which
will be compiled and included as the output the current chunk. This offers a way
to organize a large R Markdown report as smaller child documents.</p>
<h4 id="sec:option-code"><span class="section-number">2.1.5.5</span> <code>code</code> and <code>file</code>: alternative ways to provide code</h4>
<p>While you can write source code directly in a code chunk, there are two more
ways to provide the code through the chunk options:</p>
<ul>
<li>
<p><code>code</code>: A character vector of the source code, e.g.,
<code>code = c('x = 1 + 1', 'x')</code>.</p>
</li>
<li>
<p><code>file</code>: A vector of file paths to read the code from, e.g.,
<code>file = c('foo.R', 'bar.R')</code>. If both <code>file</code> and <code>code</code> options are provided
and non-empty, the <code>code</code> option will be ignored.</p>
</li>
</ul>
<p>These options will be ignored (with a warning) if the code chunk is not empty.
They can be used in any code chunks (not necessarily R code chunks).</p>
<pre><code class="language-md" data-file="005.Rmd">---
title: The `code` option
---

Define a code template `tpl`:

```{r}
tpl    = 'lm(mpg ~ %s, data = mtcars) |&gt; summary() |&gt; coef()'
x_vars = names(mtcars)[2:4]
```

We run regressions on three variables one by one:

```{r, code = sprintf(tpl, x_vars)}
```
</code></pre>
<pre><code class="language-md" data-file="005.md">.
.
.
``` {.r}
lm(mpg ~ cyl, data = mtcars) |&gt; summary() |&gt; coef()
```
| |Estimate|Std. Error|t value|Pr(&gt;\|t\|)|
|---|--:|--:|--:|--:|
|(Intercept)|37.885| 2.074|18.268| 0.000|
|cyl|-2.876| 0.322|-8.920| 0.000|


``` {.r}
lm(mpg ~ disp, data = mtcars) |&gt; summary() |&gt; coef()
```
| |Estimate|Std. Error|t value|Pr(&gt;\|t\|)|
|---|--:|--:|--:|--:|
|(Intercept)|29.600| 1.230|24.070| 0.000|
|disp|-0.041| 0.005|-8.747| 0.000|


``` {.r}
lm(mpg ~ hp, data = mtcars) |&gt; summary() |&gt; coef()
```
| |Estimate|Std. Error|t value|Pr(&gt;\|t\|)|
|---|--:|--:|--:|--:|
|(Intercept)|30.099| 1.634|18.421| 0.000|
|hp|-0.068| 0.010|-6.742| 0.000|
</code></pre>
<h4 id="sec:option-collapse"><span class="section-number">2.1.5.6</span> <code>collapse</code>: collapse source code and text output</h4>
<p>When the option <code>collapse = TRUE</code> (it is <code>FALSE</code> by default), adjacent source
code blocks and verbatim text output blocks will be merged, which can make the
output a little more compact, e.g.,</p>
<div class="fenced-chunk">
<pre><code class="language-md code-fence">```{r, collapse = TRUE}
</code></pre>
<pre><code class="language-r">x = 1:5
x
#&gt; [1] 1 2 3 4 5
x + 100
#&gt; [1] 101 102 103 104 105
</code></pre>
<pre><code class="language-md code-fence">```
</code></pre>
</div>
<p>Note that if a source block and an output block are not adjacent to each other,
they will not be merged, e.g., when there is a warning block between the source
and text output.</p>
<h4 id="sec:option-comment"><span class="section-number">2.1.5.7</span> <code>comment</code>: comment out text output</h4>
<p>By default, verbatim text output is commented out with a prefix <code>#&gt;</code>. This
comment prefix can be set via the chunk option <code>comment</code>, e.g.,</p>
<div class="fenced-chunk">
<pre><code class="language-md code-fence">```{r, comment = '#~~&gt; ', print = NA}
</code></pre>
<pre><code class="language-r">1:9
</code></pre>
<pre><code>#~~&gt; [1] 1 2 3 4 5 6 7 8 9
</code></pre>
<pre><code class="language-r">matrix(1:9, 3)
</code></pre>
<pre><code>#~~&gt;      [,1] [,2] [,3]
#~~&gt; [1,]    1    4    7
#~~&gt; [2,]    2    5    8
#~~&gt; [3,]    3    6    9
</code></pre>
<pre><code class="language-md code-fence">```
</code></pre>
</div>
<p>If you do not want the comment prefix, you may set <code>comment = ''</code>.</p>
<div class="fenced-chunk">
<pre><code class="language-md code-fence">```{r, comment = '', print = NA}
</code></pre>
<pre><code class="language-r">matrix(1:9, 3)
</code></pre>
<pre><code>     [,1] [,2] [,3]
[1,]    1    4    7
[2,]    2    5    8
[3,]    3    6    9
</code></pre>
<pre><code class="language-md code-fence">```
</code></pre>
</div>
<p>The reason to use comments is that readers will be able to copy multiple code
blocks from the chunk output in one go and directly run the copied text as code
elsewhere when desired (all text output will be ignored as comments).</p>
<h4 id="sec:option-dev"><span class="section-number">2.1.5.8</span> <code>dev</code>: graphics device</h4>
<p>For a code chunk to generate graphics output, it will need a graphics device to
record the plots. The device can be set via the <code>dev</code> option. The value can be a
function (e.g., <code>svg</code>), a function name as a string (e.g., <code>&quot;svg&quot;</code>), or a string
that can be evaluated to a function (e.g., <code>&quot;grDevices::svg&quot;</code>).</p>
<p>The default device is <code>cairo_pdf</code> for LaTeX output, and <code>png</code> for other types of
output (such as HTML).</p>
<p>The plot file path (specified via the chunk option <code>fig.path</code>) will be passed to
the first argument of the device function. The chunk option <code>dev.args</code> can be
used to pass a list of additional arguments to the device, and the default list
is:</p>
<pre><code class="language-r">list(units = &quot;in&quot;, onefile = FALSE, width = 8, height = 8, res = 84)
</code></pre>
<p>Note that the default unit for <code>width</code> and <code>height</code> is inches instead of pixels.</p>
<p>Any argument in <code>dev.args</code> that is not available in a device function will be
ignored. For example, the <code>png()</code> device does not have the <code>onefile</code> argument,
so it will not be passed to <code>png()</code>, whereas you can use
<code>dev.args = list(bg = 'yellow')</code> to pass a custom <code>bg</code> value (yellow background)
to <code>png()</code>. Please read the help page of the device function (e.g., <code>?png</code>) to
learn the possible arguments that you can use.</p>
<pre><code class="language-md" data-file="008.Rmd">---
title: The graphics device
---

The default (png) device with a higher resolution:

```{r}
#| chunk-a, dev.args = list(res = 96),
#| fig.alt = 'png with a resolution of 96 ppi'

plot(cars)
```

The `svg` device with a background color:

```{r}
#| chunk-b, dev = 'svg', dev.args = list(bg = 'lightyellow'),
#| fig.alt = 'svg with a lightyellow background'

plot(cars)
```
</code></pre>
<h4 id="sec:option-echo"><span class="section-number">2.1.5.9</span> <code>echo</code>: visibility of source code</h4>
<p>By default, the source code blocks are displayed in the output with the chunk
option <code>echo = TRUE</code>. To suppress source code blocks, you can use
<code>echo = FALSE</code>.</p>
<h4 id="sec:option-error"><span class="section-number">2.1.5.10</span> <code>error</code>: error behavior</h4>
<p>You can specify how errors in a code chunk should be handled with the <code>error</code>
option. Its possible values are:</p>
<ul>
<li>
<p><code>NA</code> (default): No special handling, i.e., if an error occurs, just throw it
and halt the process.</p>
</li>
<li>
<p><code>TRUE</code>: Capture errors with <code>tryCatch()</code> and show the error messages in the
output.</p>
</li>
<li>
<p><code>FALSE</code>: Suppress errors.</p>
</li>
</ul>
<p>If a certain error cannot be captured by <code>tryCatch()</code>, the chunk option
<code>error = TRUE</code> or <code>FALSE</code> will not work.</p>
<p>Note that in addition to errors in executing the code, syntax errors in the
source code can also be captured, e.g.,</p>
<div class="fenced-chunk">
<pre><code class="language-md code-fence">```{r, error = TRUE}
</code></pre>
<pre><code class="language-r">x = 1 + 2 +
</code></pre>
<pre><code class="language-plain error">#&gt; &lt;text&gt;:2:0: unexpected end of input
#&gt; 1: x = 1 + 2 +
#&gt;    ^
</code></pre>
<pre><code class="language-md code-fence">```
</code></pre>
</div>
<h4 id="sec:option-eval"><span class="section-number">2.1.5.11</span> <code>eval</code>: code evaluation</h4>
<p>If you do not want to evaluate a certain code chunk, you can use the chunk
option <code>eval = FALSE</code>, which is <code>TRUE</code> by default.</p>
<h4 id="sec:option-fig"><span class="section-number">2.1.5.12</span> <code>fig.*</code>: figure options</h4>
<p>The <code>fig.*</code> options fall into two categories: one for decorating the images in
the output, and the other for customizing the plot files. Chunk options for
decoration include:</p>
<ul>
<li>
<p><code>fig.alt</code>: The alt text for plots, which will be used in image tags
(<code>&lt;img alt=&quot;...&quot; /&gt;</code>) in HTML output. By default, it takes value from the
<code>fig.cap</code> option, which defaults to <code>NULL</code>. You are encouraged to provide
the alt text, since it improves the accessibility of images on HTML pages.</p>
</li>
<li>
<p><code>fig.cap</code>: The figure caption. By default, it is empty (<code>NULL</code>).</p>
</li>
<li>
<p><code>fig.env</code>: Attributes for the figure environment. By default, it is a class
name <code>.figure</code>.</p>
</li>
</ul>
<div class="callout-tip">
<p>To avoid omitting the alt text inadvertently, you can set
<code>options(litedown.fig.alt = TRUE)</code> in your <code>.Rprofile</code>. When this option is set
and the chunk option <code>fig.alt</code> is unset, <code>fuse()</code> will emit reminders about the
missing alt text for code chunks containing plots. You can also set this option
inside a particular R Markdown document to receive reminders only for that
document.</p>
</div>
<p>When all these options are provided, the Markdown output of figures will be of
this form:</p>
<pre><code class="language-md">:::: {fig.env}
![fig.alt](fig.path){attr.plot}

:::
fig.cap
:::
::::
</code></pre>
<p>When a code chunk generates multiple plots, the options <code>fig.alt</code> and
<code>attr.plot</code> (<a class="cross-ref-sec" href="#sec:option-attr">2.1.5.1</a>) are vectorized, i.e., they will be recycled to a
length equal to the number of plots, and each value in the vectors will be
applied to each plot. For example, for <code>fig.alt = c('aaa', 'bbb')</code>, the first
value will be the alt text for the first plot, and the second value is for the
second plot.</p>
<p>When <code>fig.cap</code> is provided and a chunk generates multiple plots, all plots will
be moved into the same figure environment at the end of the chunk output. As a
result, one code chunk can produce at most one figure environment, which may
contain one or more plots. If you need multiple figure environments, you have to
write separate code chunks.</p>
<pre><code class="language-md" data-file="009.Rmd">---
title: Decorating figures
output:
  html:
    meta:
      css: [&quot;@default&quot;, &quot;@article&quot;]
      js: [&quot;@sidenotes&quot;]
---

Place two plots side by side via the `width` attribute:

```{r}
#| chunk-a, attr.plot = 'width=&quot;45%&quot;',
#| fig.alt = c('a histogram', 'a sunflower plot'),
#| fig.cap = 'Exploring the faithful dataset.',
#| fig.env = '.figure .box'

hist(faithful$eruptions, main = '', border = 'white')
sunflowerplot(faithful)
```

A full-width figure (requires the `@article` CSS):

```{r}
#| chunk-b, fig.dim = c(14, 4), fig.env = '.figure .fullwidth',
#| fig.cap = 'Monthly mean relative sunspot numbers from 1749 to 1983.'
par(mar = c(4, 4, .1, .1), bg = 'lightyellow', fg = 'red', las = 1)
plot(sunspots, col = 'red')
grid()
```

Feel free to experiment with other class names provided by the `@article` CSS, such as `.side .side-right` or `.embed-right` in addition to `.fullwidth`.
</code></pre>
<p>Chunk options for plot files include:</p>
<ul>
<li>
<p><code>fig.ext</code>: The plot file extension. By default, it will be automatically
inferred from the first argument of the graphics device function
(<a class="cross-ref-sec" href="#sec:option-dev">2.1.5.8</a>). For example, the extensions <code>.png</code> and <code>.svg</code> can be
detected from the <code>png()</code> and <code>svg()</code> devices, respectively:</p>
<pre><code class="language-r">formals(png)[[1]]
#&gt; [1] &quot;Rplot%03d.png&quot;
formals(svg)[[1]]
#&gt; if (onefile) &quot;Rplots.svg&quot; else &quot;Rplot%03d.svg&quot;
</code></pre>
<p>You can manually provide the extension via <code>fig.ext</code> if the automatic
inference fails.</p>
</li>
<li>
<p><code>fig.height</code> and <code>fig.width</code>: The physical size of plots to be passed to the
graphics device. By default, a plot is 8 x 8 inches with a resolution of
84ppi (i.e., 672 x 672 pixels). The chunk option <code>fig.dim</code> (figure
dimension) can be used as a shorthand to provide <code>fig.width</code> and
<code>fig.height</code> at the same time, e.g., <code>fig.dim = c(10, 6)</code> means
<code>fig.width = 10</code> and <code>fig.height = 6</code>. These options can be overridden by
the option <code>dev.args</code> (<a class="cross-ref-sec" href="#sec:option-dev">2.1.5.8</a>), e.g.,
<code>dev.args = list(width = 9, height = 7)</code>.</p>
</li>
<li>
<p><code>fig.path</code>: A path prefix for plot files. This prefix, joined by the chunk
label and the plot number, will be the actual plot file path. For example,
for <code>fig.path = 'figures/'</code> and a chunk with the label <code>foo</code>, the <em>i</em>-th
plot in the chunk will be <code>figures/foo-i.ext</code>, with the extension <code>.ext</code>
from the chunk option <code>fig.ext</code>. The default <code>fig.path</code> is the input file
path with its extension substituted by <code>__files/</code>, e.g., when running
<code>fuse('path/foo.Rmd')</code>, the <code>fig.path</code> will be set to <code>path/foo__files/</code> by
default.</p>
<p>If <code>fig.path</code> is not a character value or <code>NULL</code> (e.g., <code>fig.path = NA</code>),
plots will not be captured for output.</p>
</li>
</ul>
<pre><code class="language-md" data-file="010.Rmd">---
title: Plot files
---

The default extension for the `jpeg()` device is `jpeg`, and you can change it to `.jpg` if desired:

```{r, chunk-a, dev = 'jpeg', fig.ext = '.jpg'}
plot(cars)
```

Set the plot size via `fig.dim`:

```{r, chunk-b, fig.dim = c(5, 4)}
plot(cars)
```

Write plot files to a different folder:

```{r, chunk-c, fig.path = 'figures/'}
plot(cars)
```
</code></pre>
<h4 id="sec:option-include"><span class="section-number">2.1.5.13</span> <code>include</code>: visibility of whole code chunk</h4>
<p>When you want to hide the full output of a code chunk, you can use the option
<code>include = FALSE</code>, instead of trying to hide elements individually like
<code>echo = FALSE</code> (source), <code>results = 'hide'</code> (text output), <code>message = FALSE</code>,
and <code>warning = FALSE</code>, etc.</p>
<p>Note that even with <code>include = FALSE</code>, the code is still executed, unless you
also set <code>eval = FALSE</code>.</p>
<h4 id="sec:option-label"><span class="section-number">2.1.5.14</span> <code>label</code>: chunk label</h4>
<p>The chunk label is an identifier of a code chunk. It is used in plot/cache
filenames and figure/table cross-references. If two code chunks have the same
label, their plots and cache will overwrite each other, which may lead to
unexpected output. If one of these chunks does not produce plots/tables or use
cache, it is fine for them to use the same label.</p>
<p>If two code chunks share the same label, and one of the chunks is empty, the
empty chunk will copy code from the non-empty one.</p>
<pre><code class="language-md" data-file="011.Rmd">---
title: Shared chunk labels
---

```{r, chunk-a}
message(&quot;This chunk's label is chunk-a&quot;)
```

Repeat `chunk-a` but suppress the message:

```{r, chunk-a, message=FALSE}
```
</code></pre>
<pre><code class="language-md" data-file="011.md">---
title: Shared chunk labels
---

``` {.r}
message(&quot;This chunk's label is chunk-a&quot;)
```

``` {.plain .message}
#&gt; This chunk's label is chunk-a
```

Repeat `chunk-a` but suppress the message:

``` {.r}
message(&quot;This chunk's label is chunk-a&quot;)
```
</code></pre>
<p>If the label is not provided in a chunk, a label of the form <code>chunk-i</code> will be
assigned to the chunk, where <code>i</code> is the chunk number in the document. For
example, the labels for the following code chunks will be <code>chunk-a</code>, <code>chunk-2</code>,
<code>chunk-js</code>, and <code>project-flowchart</code>:</p>
<pre><code class="language-md">```{r, chunk-a}
```

```{css}
```

```{js}
//| label: chunk-js
```

```{mermaid, label = 'project-flowchart'}
```
</code></pre>
<h4 id="sec:option-message"><span class="section-number">2.1.5.15</span> <code>message</code>: message behavior</h4>
<p>The <code>message</code> option is similar to the <code>error</code> option (<a class="cross-ref-sec" href="#sec:option-error">2.1.5.10</a>) but is
for handling <code>message()</code>. Possible values are:</p>
<ul>
<li>
<p><code>NA</code>: No special handling (messages will be written to the R console by
default).</p>
</li>
<li>
<p><code>TRUE</code> (default): Capture messages and show them in the output document.</p>
</li>
<li>
<p><code>FALSE</code>: Suppress messages.</p>
</li>
</ul>
<h4 id="sec:option-order"><span class="section-number">2.1.5.16</span> <code>order</code>: order of execution</h4>
<p>Code chunks and inline code expressions do not have to be executed sequentially.
The chunk option <code>order</code> can be used to customize the order of execution. It
takes a numeric value and defaults to the chunk number (e.g., <code>3</code> for the 3rd
chunk), therefore all chunks are executed in the natural linear order by
default.</p>
<p>A lower <code>order</code> value indicates earlier execution of the chunk, and <em>vice
versa</em>. If you want to delay the execution of a chunk, assign a higher <code>order</code>
value to it. If you want to prioritize the execution, you may assign a lower
value.</p>
<p>It is the order of these values that matters, instead of the specific values.
For example, if the input contains three chunks in total, order values <code>1</code>,
<code>1000</code>, and <code>888</code> for these chunks will be equivalent to <code>1</code>, <code>3</code>, and <code>2</code>,
since the order is calculated via the <code>order()</code> function:</p>
<pre><code class="language-r">order(c(1, 1000, 888))
#&gt; [1] 1 3 2
order(c(1, 3, 2))  # same order
#&gt; [1] 1 3 2
</code></pre>
<p>You may use two variables, <code>i</code> (the chunk number) and <code>N</code> (the total number of
chunks), in the <code>order</code> value, which can make it easier to specify the relative
order. For example, if a chunk has <code>order = i + 1.5</code>, its next chunk will be
executed before it, because the order of the next chunk is <code>i + 1</code> (unless its
order has also been changed), which is smaller than <code>i + 1.5</code>. Without the
variable <code>i</code>, you would have to figure out the chunk number by yourself and
assign a fixed value like <code>8.5</code> in this case.</p>
<p>If you want an earlier chunk to be executed last, you may use <code>order = N + 1</code>.
Similarly, to execute a later chunk first, you may use <code>order = 0</code>.</p>
<p>Note that the <code>order</code> option also works for text chunks that contain inline code
expressions. To specify the order of a text chunk, set the <code>order</code> option in any
inline code expression in the chunk.</p>
<p>In the following example, we execute the first text chunk in the end by setting
<code>order = N + 1</code>, so that the variables <code>x</code> and <code>n_cyl</code> will be available
(calculated from later chunks), and we move the last chunk one step earlier via
<code>order = i - 1.5</code>, so the variable <code>m</code> will be ready for the text chunk before.
Without the custom order, this example will either throw errors (objects not
found) or use wrong values of these variables (from elsewhere in the session).</p>
<pre><code class="language-md" data-file="012.Rmd">---
title: Custom execution order
abstract: &quot;We analyzed `{r, order = N + 1} nrow(x)` `{r} n_cyl`-cylinder cars, with an average MPG of `{r} m`.&quot;
---

Subset the data:

```{r}
n_cyl = 8
x = subset(mtcars, cyl == n_cyl)
```

The average MPG `{r} m` is calculated from:

```{r, order = i - 1.5}
m = mean(x$mpg)
```
</code></pre>
<pre><code class="language-md" data-file="012.md">---
title: Custom execution order
abstract: &quot;We analyzed 14 8-cylinder cars, with an average MPG of 15.1.&quot;
---

Subset the data:

``` {.r}
n_cyl = 8
x = subset(mtcars, cyl == n_cyl)
```

The average MPG 15.1 is calculated from:

``` {.r}
m = mean(x$mpg)
```
</code></pre>
<p>You can change the value of <code>n_cyl</code> to 4 or 6, re-run the example, and get a new
report of cars with 4 or 6 cylinders.</p>
<h4 id="sec:option-print"><span class="section-number">2.1.5.17</span> <code>print</code>: printing function</h4>
<p>In a code chunk, if the value of an expression is visible, it will be printed.
You may read the help pages <code>?invisible</code> and <code>?withVisible</code> to learn more about
the visibility of values.</p>
<p>To print a value, a print function needs to be called. The function can be
provided via the chunk option <code>print</code>, which defaults to the S3 generic function
<code>xfun::record_print()</code>, with the following methods:</p>
<pre><code class="language-r">methods(xfun::record_print)
</code></pre>
<pre><code>#&gt; [1] record_print.data.frame*  record_print.default*    
#&gt; [3] record_print.knitr_kable* record_print.matrix*     
#&gt; [5] record_print.record_asis* record_print.tbl_df*     
#&gt; see '?methods' for accessing help and source code
</code></pre>
<p>These methods are mainly for generating tables from rectangular data objects,
such as matrices and data frames.</p>
<p>If a non-function value (such as <code>NA</code>) is passed to the <code>print</code> option,
<code>base::print()</code> (or <code>methods::show()</code> for S4 objects) will be called, which will
generate text output that you would normally see in the R console. Therefore if
you wish to avoid printing data objects to tables, you may use the chunk option
<code>print = NA</code>.</p>
<p>The chunk option <code>print.args</code> can be used to pass additional arguments to the
print function. It should be of the form
<code>list(class_a = args_a, class_b = args_b, ...)</code>, where <code>class_x</code> is a class
name, and <code>args_x</code> is a list of arguments. If the (first) class name of a
visible value in a code chunk is <code>class_x</code>, <code>args_x</code> will be passed to the print
function.</p>
<p>In the following example, objects are printed through <code>base::print()</code> (by
setting the chunk option <code>print = NA</code>). The argument <code>zero.print = '.'</code> (see
<code>?print.table</code>) is used for <code>table</code> objects, and arguments <code>quote</code> /
<code>max.levels</code> (see <code>?print.factor</code>) are used for <code>factor</code> objects.</p>
<pre><code class="language-md" data-file="013.Rmd">---
title: Print objects
---

Print objects with `base::print()`, and use different arguments for different objects.

```{r}
#| print = NA,
#| print.args = list(table = list(zero.print = '.'),
#|   factor = list(quote = TRUE, max.levels = 3))

X = c('a', 'b', 'c', 'c', 'c', 'a')
Y = factor(c('A', 'B', 'C', 'C', 'D', 'E'))
Y  # factor

table(X, Y)  # table
```
</code></pre>
<pre><code class="language-md" data-file="013.md">.
.
.
```
#&gt; [1] &quot;A&quot; &quot;B&quot; &quot;C&quot; &quot;C&quot; &quot;D&quot; &quot;E&quot;
#&gt; 5 Levels: &quot;A&quot; &quot;B&quot; ... &quot;E&quot;
```

``` {.r}
table(X, Y)  # table
```

```
#&gt;    Y
#&gt; X   A B C D E
#&gt;   a 1 . . . 1
#&gt;   b . 1 . . .
#&gt;   c . . 2 1 .
```
</code></pre>
<p>If you do not want to pass arguments by class names but pass a list of arguments
to the print function regardless of the object classes, you can wrap the list in
<code>I()</code>. For example, <code>print.args = I(list(zero.print = '.'))</code> means that
<code>print(..., zero.print = '.')</code> is called to print <em>any</em> objects in the chunk in
the above example. However, please note that this “universal” argument list may
not work for all print functions or methods—some arguments may be ignored, and
some may cause errors if the print function does not have certain arguments. It
is often better to define <code>print.args</code> by class names.</p>
<h4 id="sec:option-purl"><span class="section-number">2.1.5.18</span> <code>purl</code>: code extraction</h4>
<p>When using <code>litedown::fiss()</code> to extract code from a document, all code chunks
are extracted by default. To skip a code chunk, set <code>purl = FALSE</code> for that
chunk.</p>
<pre><code class="language-md" data-file="014.Rmd">This code chunk is not important for the `fiss()` output.

```{r, setup, purl = FALSE}
litedown::reactor(fig.height = 5)
```

This code chunk will be included in the script.

```{r}
if (TRUE) {
  x = 1 + 1
}
```
</code></pre>
<pre><code class="language-R" data-file="014.R">if (TRUE) {
  x = 1 + 1
}
</code></pre>
<p>You can see that the <code>setup</code> chunk with the option <code>purl = FALSE</code> was omitted in
the R script output (generated by <code>fiss()</code>).</p>
<h4 id="sec:option-ref-label"><span class="section-number">2.1.5.19</span> <code>ref.label</code>: chunk references</h4>
<p>A code chunk can reuse code from other code chunks via the option <code>ref.label</code>.
It takes a vector of chunk labels, and will copy code from these chunks.</p>
<p>Using chunk references makes it possible to avoid copying code from one chunk to
another manually. You can also compose code freely from other chunks.</p>
<pre><code class="language-md" data-file="015.Rmd">---
title: Reference chunks by labels
---

We define a function `abs2()`:

```{r, chunk-a, eval = FALSE}
abs2 = function(x)
```

Return `x` if `x &gt;= 0`, otherwise return `-x`:

```{r, chunk-b, eval=FALSE}
  ifelse(x &gt;= 0, x, -x)
```

The full function (combining `chunk-a` and `chunk-b`):

```{r, ref.label = c('chunk-a', 'chunk-b')}
```

See if it works:

```{r}
abs2(c(1, -2, 0, -100))
```
</code></pre>
<pre><code class="language-md" data-file="015.md">.
.
.
The full function (combining `chunk-a` and `chunk-b`):

``` {.r}
abs2 = function(x)
  ifelse(x &gt;= 0, x, -x)
```

See if it works:

``` {.r}
abs2(c(1, -2, 0, -100))
```

```
#&gt; [1]   1   2   0 100
```
</code></pre>
<h4 id="sec:option-results"><span class="section-number">2.1.5.20</span> <code>results</code>: text output behavior</h4>
<p>Text output from code chunks can be shown verbatim, hidden, or just written out
as is. The behavior is controlled by the option <code>results</code>, with possible values:</p>
<ul>
<li>
<p><code>TRUE</code> (default): Show text output verbatim (in fenced code blocks).</p>
</li>
<li>
<p><code>FALSE</code> (or <code>&quot;hide&quot;</code>): Hide text output.</p>
</li>
<li>
<p><code>&quot;asis&quot;</code>: Write raw text (interpreted as Markdown) to the output.</p>
</li>
</ul>
<pre><code class="language-md" data-file="016.Rmd">---
title: Text output
---

Default verbatim output:

```{r, test-out}
cat('Hello _world_!\n')
```

Hide output:

```{r, test-out, results = FALSE}
```

Output as is:

```{r, test-out, results = 'asis'}
```
</code></pre>
<pre><code class="language-md" data-file="016.md">---
title: Text output
---

Default verbatim output:

``` {.r}
cat('Hello _world_!\n')
```

```
#&gt; Hello _world_!
```

Hide output:

``` {.r}
cat('Hello _world_!\n')
```

Output as is:

``` {.r}
cat('Hello _world_!\n')
```
Hello _world_!
</code></pre>
<h4 id="sec:option-strip-white"><span class="section-number">2.1.5.21</span> <code>strip.white</code>: leading / trailing blank lines in code</h4>
<p>By default, blank lines at the beginning and end of a source code block are
removed. To keep them, you can use the chunk option <code>strip.white = FALSE</code>.</p>
<pre><code class="language-md" data-file="017.Rmd">---
title: Blank lines in source code
---

Keep blank lines at the beginning/end:

```{r, strip.white = FALSE}

# a blank line above
1 + 1
# and a blank line below

```
</code></pre>
<pre><code class="language-md" data-file="017.md">.
.
.
``` {.r}

# a blank line above
1 + 1
```

```
#&gt; [1] 2
```

``` {.r}
# and a blank line below

```
</code></pre>
<h4 id="sec:option-tab"><span class="section-number">2.1.5.22</span> <code>tab.*</code>: table options</h4>
<p>Unless the default <code>print</code> option (<a class="cross-ref-sec" href="#sec:option-print">2.1.5.17</a>) is changed, common
rectangular data objects are printed to Markdown tables through
<code>xfun::record_print()</code>, and tables are generated by a simple function
<code>xfun::md_table()</code>, which is even much simpler than <code>knitr::kable()</code>.</p>
<p>The chunk option <code>tab.cap</code> can be used to provide the table caption. The option
<code>tab.env</code> can be used to customize the attributes (<a class="cross-ref-sec" href="#sec:fenced-divs">3.3.7</a>) of the
table environment, and it defaults to <code>.table</code>, i.e., a class name <code>table</code>.
Below is a quick example showing where <code>tab.cap</code> and <code>tab.env</code> are used in the
Markdown output:</p>
<pre><code class="language-md" data-file="018.Rmd">---
title: A simple table
---

See @tab:simple.

```{r}
#| simple, tab.env = '.table .box',
#| tab.cap = 'First 3 rows of the `cars` data.',
head(cars, 3)
```
</code></pre>
<pre><code class="language-md" data-file="018.md">.
.
.
``` {.r}
head(cars, 3)
```

:::: {.table .box #tab:simple}

::: {.caption}
[](#@tab:simple)
First 3 rows of the `cars` data.
:::

|speed|dist|
|--:|--:|
|4| 2|
|4|10|
|7| 4|
::::
</code></pre>
<p>The position of the caption can be changed via the chunk option <code>cap.pos</code>
(<a class="cross-ref-sec" href="#sec:option-cap-pos">2.1.5.3</a>).</p>
<p>To customize the table content, you can pass arguments to <code>xfun::md_table()</code> via
the chunk option <code>print.args</code>. Below is an example that limits data frames to at
most 4 rows and 6 columns:</p>
<div class="fenced-chunk">
<pre><code class="language-md code-fence">```{r}
#| print.args = list(data.frame = list(limit = c(4, 6)))
</code></pre>
<pre><code class="language-r">mtcars
</code></pre>
<table>
<thead>
<tr>
<th></th>
<th align="right">mpg</th>
<th align="right">cyl</th>
<th align="center">…</th>
<th align="right">gear</th>
<th align="right">am</th>
<th align="right">vs</th>
</tr>
</thead>
<tbody>
<tr>
<td>Mazda RX4</td>
<td align="right">21.0</td>
<td align="right">6</td>
<td align="center">…</td>
<td align="right">4</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr>
<td>Mazda RX4 Wag</td>
<td align="right">21.0</td>
<td align="right">6</td>
<td align="center">…</td>
<td align="right">4</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr>
<td>⋮</td>
<td align="right">⋮</td>
<td align="right">⋮</td>
<td align="center">…</td>
<td align="right">⋮</td>
<td align="right">⋮</td>
<td align="right">⋮</td>
</tr>
<tr>
<td>Maserati Bora</td>
<td align="right">15.0</td>
<td align="right">8</td>
<td align="center">…</td>
<td align="right">5</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr>
<td>Volvo 142E</td>
<td align="right">21.4</td>
<td align="right">4</td>
<td align="center">…</td>
<td align="right">4</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<pre><code class="language-md code-fence">```
</code></pre>
</div>
<p>By default, tables are limited to 10 rows. If you want to get rid of this limit,
you may set <code>options(xfun.md_table.limit = Inf)</code> or <code>limit = Inf</code> in
<code>print.args</code> or wrap the data object in <code>I()</code>.</p>
<p>Please read the help page <code>?xfun::md_table</code> to learn the possible arguments, and
also see <a class="cross-ref-sec" href="#sec:option-print">2.1.5.17</a> to learn how the chunk option <code>print.args</code> works.</p>
<h4 id="sec:option-time"><span class="section-number">2.1.5.23</span> <code>time</code>: code timing</h4>
<p>When the chunk option <code>time</code> is set to <code>TRUE</code>, the execution time of the chunk
will be recorded. You can print out <code>litedown::timing_data()</code> at the end of a
document to check the timing data. The data is sorted by default, so you can
quickly know which code chunks are slow.</p>
<p>You can time specific code chunks by applying <code>time = TRUE</code> to them, or time all
chunks in the document by setting <code>litedown::reactor(time = TRUE)</code> in the first
code chunk.</p>
<h4 id="sec:option-verbose"><span class="section-number">2.1.5.24</span> <code>verbose</code>: printing verbosity</h4>
<p>By default, invisible values are not printed (<a class="cross-ref-sec" href="#sec:option-print">2.1.5.17</a>). However, you
can use the chunk option <code>verbose</code> to change this behavior. Its possible values
are:</p>
<ul>
<li>
<p><code>0</code> (default): Do not print invisible values.</p>
</li>
<li>
<p><code>1</code>: Always print the last value in the code chunk, no matter if it is
visible.</p>
</li>
<li>
<p><code>2</code>: Print all invisble values in the code, except for invisible <code>NULL</code>
(which is often not useful).</p>
</li>
</ul>
<p>Below are examples for different values of <code>verbose</code>:</p>
<div class="fenced-chunk">
<pre><code class="language-md code-fence">```{r, test-verbose, collapse = TRUE}
</code></pre>
<pre><code class="language-r">1:5
#&gt; [1] 1 2 3 4 5
x = 1 + 1
y = x^2
</code></pre>
<pre><code class="language-md code-fence">```
</code></pre>
</div>
<div class="fenced-chunk">
<pre><code class="language-md code-fence">```{r, test-verbose, verbose = 1, collapse = TRUE}
</code></pre>
<pre><code class="language-r">1:5
#&gt; [1] 1 2 3 4 5
x = 1 + 1
y = x^2
#&gt; [1] 4
</code></pre>
<pre><code class="language-md code-fence">```
</code></pre>
</div>
<div class="fenced-chunk">
<pre><code class="language-md code-fence">```{r, test-verbose, verbose = 2, collapse = TRUE}
</code></pre>
<pre><code class="language-r">1:5
#&gt; [1] 1 2 3 4 5
x = 1 + 1
#&gt; [1] 2
y = x^2
#&gt; [1] 4
</code></pre>
<pre><code class="language-md code-fence">```
</code></pre>
</div>
<p>In case you do not know, an assignment (e.g., <code>x = 1 + 1</code>) in R returns the
value being assigned invisibly, so the value will not be printed by default. You
can set <code>verbose = 2</code> to reveal the value. Normally you would have to explicitly
print the variable or use the <code>()</code> trick to make it visible:</p>
<pre><code class="language-r">x = 1 + 1
x  # print x explicitly
(x = 1 + 1)  # or the () trick
</code></pre>
<h4 id="sec:option-warning"><span class="section-number">2.1.5.25</span> <code>warning</code>: warning behavior</h4>
<p>The <code>warning</code> option is similar to the <code>error</code> option (<a class="cross-ref-sec" href="#sec:option-error">2.1.5.10</a>) but is
for handling <code>warning()</code>. Possible values are:</p>
<ul>
<li>
<p><code>NA</code>: No special handling (warnings will be sent to the R console by
default).</p>
</li>
<li>
<p><code>TRUE</code> (default): Capture warnings and show them in the output document.</p>
</li>
<li>
<p><code>FALSE</code>: Suppress warnings. Warnings often exist for good reasons. Please
make sure the warnings can be safely suppressed before using
<code>warning = FALSE</code>.</p>
</li>
</ul>
<h4 id="sec:option-wd"><span class="section-number">2.1.5.26</span> <code>wd</code>: working directory</h4>
<p>The working directory when evaluating code chunks and inline code will be
temporarily changed to the directory of the input file to <code>fuse()</code>. If the input
is not a file path, the working directory will not be changed.</p>
<div class="callout-note">
<p>When using relative paths to read/write files in code chunks, these paths are
relative to the directory of the input file by default. I know some people hate
this default. It is a matter of thinking inside or outside the (R Markdown) box.
I tend to think <em>inside</em>—everything is relative to the document that I’m working
inside. It is just a habit (following the conventions of HTML and CSS), not
necessarily right or wrong.</p>
</div>
<p>You are free to specify any directory as the working directory for the code via
the chunk option <code>wd</code>, e.g., <code>wd = '../'</code> (up one level from the directory of
the input file) or <code>wd = 'C:/Documents/Project/'</code>. Please note that using a
hard-coded absolute directory may affect others if they need to re-run your
document on their computers, since the absolute directory may not exist there.</p>
<p>If you have to change the working directory to an absolute directory, you may
consider using functions like <code>xfun::proj_root()</code> to dynamically find the
absolute directory.</p>
<h2 id="sec:inline-code"><span class="section-number">2.2</span> Inline code</h2>
<h3 id="sec:inline-syntax"><span class="section-number">2.2.1</span> The syntax</h3>
<p>The syntax for inline code expressions is <code>`{lang} code`</code>, where <code>lang</code> is
the language name, e.g., <code>r</code>. Spaces are allowed after the opening backtick and
before the closing backtick. If the <code>code</code> happens to contain <code>N</code> backticks, you
will need to use at least <code>N + 1</code> backticks outside, e.g.,
<code>``{r} paste(&quot;`&quot;, rnorm(1), &quot;`&quot;)``</code>. An inline code expression inside
another piece of inline code is not parsed or evaluated, which provides a way to
write verbatim inline code expressions, e.g., <code>`` `{lang} code` ``</code>.</p>
<p>Comma-separated chunk options can also be provided to inline code expressions
after the language name, e.g., <code>`{r, eval = FALSE} code`</code>. Currently, only
<code>eval</code> (<a class="cross-ref-sec" href="#sec:option-eval">2.1.5.11</a>) and <code>error</code> (<a class="cross-ref-sec" href="#sec:option-error">2.1.5.10</a>) are supported, and
most other chunk options in <a class="cross-ref-sec" href="#sec:chunk-options">2.1.5</a> are not supported for inline
code. A few additional options are provided for formatting inline numeric output
(<a class="cross-ref-sec" href="#sec:numeric-output">2.2.2</a>).</p>
<p>The inline code is expected to return a value of length 1. If it returns an
object of length greater than 1, all elements in the object will be concatenated
by line breaks (<code>\n</code>) to form a single string.</p>
<h3 id="sec:numeric-output"><span class="section-number">2.2.2</span> Numeric output</h3>
<p>If the inline expression returns a single number, the number will be formatted.
To bypass the formatting, wrap the inline expression in <code>I()</code>. We denote the
number by \(x\) for now.</p>
<ul>
<li>
<p>First, \(x\) will be rounded to \(n\) significant digits, where \(n\) is
controlled by the option <code>signif</code> and its default value is <code>3</code>.</p>
</li>
<li>
<p>Then \(x\) will be formatted using the scientific notation \(\pm m\times 10^n\)
if \(|x| \geq 10^p\) or \(|x| \leq 10^{-p}\), where \(p\) is controlled by the
option <code>power</code>, which defaults to <code>6</code>. If you want to avoid the scientific
notation, you can set this option to <code>Inf</code>. When \(m = 1\), it will be omitted
(i.e., the output will be \(10^n\) instead of \(1 \times 10^n\).</p>
</li>
</ul>
<p>When a number is formatted in the scientific notation, it will be enclosed with
<code>$ $</code> as an inline LaTeX math expression. For example, <code>`{r} 1234567`</code> will
be rendered to \(1.23 \times 10^{6}\).</p>
<p>Options to control the formatting include:</p>
<ul>
<li>
<p><code>dollar</code>: Whether to add <code>$ $</code> to numbers in the scientific notation. By
default (<code>dollar = NA</code>), dollar signs will be added automatically if the
inline code expression in the source is not directly enclosed with dollar
signs. <code>TRUE</code> means to always add dollar signs, and <code>FALSE</code> means to never
add dollar signs. You will need to use <code>dollar = FALSE</code> for numbers in a
LaTeX math expression because you should not use <code>$ $</code> inside a math
expression (see the example below).</p>
</li>
<li>
<p><code>power</code>: The threshold for scientific notation.</p>
</li>
<li>
<p><code>signif</code>: The desired number of significant digits.</p>
</li>
</ul>
<pre><code class="language-md" data-file="020.Rmd">---
title: Inline output
---

We know that $\pi = `{r} pi`$, and the first 3 letters are `{r} LETTERS[1:3]`. The first 3 variables of `mtcars` are `{r} xfun::join_words(names(mtcars)[1:3])`. You will not see this value `{r, eval = FALSE} 2 * pi`.

Some numbers:

```{r}
x = 1.23456789 * 10^c(0, 5, 6, 9, -6) * c(1, 1, -1, 1, 1)
sprintf('%f', x)
```

| n = signif/p = power | n = 3, p = 6 | n = 5/2/4/1/7 | p = 0/4/Inf/9/5 |
|-----------|-----------:|---------------------:|----------------------:|
| x_1       | `{r} x[1]` | `{r, signif=5} x[1]` | `{r, power=0}   x[1]` | 
| x_2 10^5  | `{r} x[2]` | `{r, signif=2} x[2]` | `{r, power=4}   x[2]` |
| x_3 10^6  | `{r} x[3]` | `{r, signif=4} x[3]` | `{r, power=Inf} x[3]` |
| x_4 10^9  | `{r} x[4]` | `{r, signif=1} x[4]` | `{r, power=9}   x[4]` |
| x_5 10^-6 | `{r} x[5]` | `{r, signif=7} x[5]` | `{r, power=5}   x[5]` |

An equation: $Y = 300 `{r, dollar = FALSE, signif = 1} x[3]`x$.
</code></pre>
<pre><code class="language-md" data-file="020.md">---
title: Inline output
---

We know that $\pi = 3.14$, and the first 3 letters are A
B
C. The first 3 variables of `mtcars` are mpg, cyl, and disp. You will not see this value .

Some numbers:

``` {.r}
x = 1.23456789 * 10^c(0, 5, 6, 9, -6) * c(1, 1, -1, 1, 1)
sprintf('%f', x)
```

```
#&gt; [1] &quot;1.234568&quot;          &quot;123456.789000&quot;     &quot;-1234567.890000&quot;  
#&gt; [4] &quot;1234567890.000000&quot; &quot;0.000001&quot;         
```

| n = signif/p = power | n = 3, p = 6 | n = 5/2/4/1/7 | p = 0/4/Inf/9/5 |
|-----------|-----------:|---------------------:|----------------------:|
| x_1       | 1.23 | 1.2346 | $1.23 \times 10^{0}$ | 
| x_2 10^5  | 123000 | 120000 | $1.23 \times 10^{5}$ |
| x_3 10^6  | $-1.23 \times 10^{6}$ | $-1.235 \times 10^{6}$ | -1230000 |
| x_4 10^9  | $1.23 \times 10^{9}$ | $10^{9}$ | $1.23 \times 10^{9}$ |
| x_5 10^-6 | 0.00000123 | 0.000001234568 | $1.23 \times 10^{-6}$ |

An equation: $Y = 300 -10^{6}x$.
</code></pre>
<p>To make it easier to read the numbers in the Markdown table above, we render the
table to <a class="cross-ref-tab" href="#tab:inline-numbers">2</a>:</p>
<div class="table box">
<div class="caption">
<p><span class="ref-number-tab">2</span> Inline numbers formatted with different <code>signif</code> and
<code>power</code> options.</p>
</div>
<table>
<thead>
<tr>
<th>n = signif/p = power</th>
<th align="right">n = 3, p = 6</th>
<th align="right">n = 5/2/4/1/7</th>
<th align="right">p = 0/4/Inf/9/5</th>
</tr>
</thead>
<tbody>
<tr>
<td>x_1</td>
<td align="right">1.23</td>
<td align="right">1.2346</td>
<td align="right">\(1.23 \times 10^{0}\)</td>
</tr>
<tr>
<td>x_2 10^5</td>
<td align="right">123000</td>
<td align="right">120000</td>
<td align="right">\(1.23 \times 10^{5}\)</td>
</tr>
<tr>
<td>x_3 10^6</td>
<td align="right">\(-1.23 \times 10^{6}\)</td>
<td align="right">\(-1.235 \times 10^{6}\)</td>
<td align="right">-1230000</td>
</tr>
<tr>
<td>x_4 10^9</td>
<td align="right">\(1.23 \times 10^{9}\)</td>
<td align="right">\(10^{9}\)</td>
<td align="right">\(1.23 \times 10^{9}\)</td>
</tr>
<tr>
<td>x_5 10^-6</td>
<td align="right">0.00000123</td>
<td align="right">0.000001234568</td>
<td align="right">\(1.23 \times 10^{-6}\)</td>
</tr>
</tbody>
</table>
</div>
<h3 id="sec:compatibility-with-knitr"><span class="section-number">2.2.3</span> Compatibility with knitr</h3>
<p>For <strong>knitr</strong> users, please note that the syntax <code>`r code`</code> is not supported
by default. You have to wrap the language name <code>r</code> in curly braces. As a
temporary workaround, you may set <code>options(litedown.enable.knitr_inline = TRUE)</code>
in your <code>.Rprofile</code> to make <strong>litedown</strong> recognize <code>`r code`</code>, but we
recommend that you convert the document via <code>litedown:::convert_knitr()</code> instead
if you decide to stay with <strong>litedown</strong> in the long run.</p>
<h2 id="sec:r-scripts"><span class="section-number">2.3</span> R scripts</h2>
<p>Besides R Markdown, you can also pass an R script to <code>fuse()</code>. You can write
Markdown content in <code>#'</code> comments, and group lines of code into chunks by <code>#|</code>
comments, e.g.,</p>
<pre><code class="language-r">#' ---
#' title: An R script
#' output: latex
#' ---
#' 
#' A _paragraph_.

#| eval = FALSE
1:10
1 + 1

#| fig.width = 10, dev = 'pdf'
plot(cars)
</code></pre>
<p>Both <code>#'</code> and <code>#|</code> comments are optional. If no <code>#'</code> or <code>#|</code> comments are found
in the script, the whole script will be treated as a single code chunk.</p>
<div id="fig:flow-sieve" class="figure box">
<pre class="mermaid">flowchart TD
  O@{ shape: lin-doc, label: &quot;Input script&quot; }--&quot;sieve()&quot;--&gt; A@{ shape: f-circ } -.-o B[[&quot;#' YAML&quot;]]
  A -.-o C[[&quot;#' Text&quot;]]
  C ---&gt; H[[Text]]
  A -.-o D[[Code chunk]]
  D -.- D1&gt;&quot;#| Chunk options&quot;]
  D -.- D2&gt;Code]--&gt; G{Results} --&gt; I[[Chunk output]]
  A -.-o E[[More chunks...]] -.- K&gt;...] --&gt; L{...} --&gt; M[[More output...]] -.-&gt; J
  H -.-&gt; J@{ shape: doc, label: &quot;Markdown&quot; }
  I -.-&gt; J
  B --&gt; R[[YAML]] -.-&gt; J
  J--&quot;mark()&quot; --&gt; N@{ shape: tag-doc, label: &quot;Output document&quot; }
  class O,J,N document
  classDef document stroke-width:3px
  class G,L fuse-out
  classDef fuse-out fill:lightyellow
  class H,I,M,R output
  classDef output fill:none
</pre>
<div class="caption">
<p><span class="ref-number-fig">8</span>
An illustration of how scripts are rendered.</p>
</div>
</div>
<h2 id="sec:engines"><span class="section-number">2.4</span> Language engines</h2>
<p>Currently, the main computing language supported by <strong>litedown</strong> is R. You can
check all supported languages via:</p>
<pre><code class="language-r">sort(names(litedown::engines()))
</code></pre>
<pre><code>#&gt; [1] &quot;css&quot;     &quot;embed&quot;   &quot;js&quot;      &quot;md&quot;      &quot;mermaid&quot; &quot;r&quot;      
</code></pre>
<p>You can get a language engine definition via <code>litedown::engines('LANG')</code>, where
<code>LANG</code> is the language name, e.g.,</p>
<pre><code class="language-r">litedown::engines('md')
</code></pre>
<p>You can also set a new language engine via:</p>
<pre><code class="language-r">litedown::engines(LANG = function(x, inline = FALSE, ...) {

})
</code></pre>
<p>The function’s argument <code>x</code> is an element in the list returned by
<code>litedown::crack()</code>.</p>
<h3 id="sec:the-markdown-engine"><span class="section-number">2.4.1</span> The Markdown engine</h3>
<p>The <code>md</code> engine will output Markdown text both verbatim and as-is, which can be
useful for showing Markdown examples, e.g.,</p>
<pre><code class="language-md">```{md}
You can see both the _source_ and _output_ of
this `md` chunk.
```

You can also use `{md} the engine **inline**`.
</code></pre>
<h3 id="sec:the-css-js-engines"><span class="section-number">2.4.2</span> The CSS/JS engines</h3>
<p>You can insert CSS/JS to the output via the <code>css</code>/<code>js</code> engines, e.g.,</p>
<pre><code class="language-md">```{css}
a {
  color: red;
}
```

```{js}
document.body.classList.add('dark');
```
</code></pre>
<h3 id="sec:the-mermaid-engine"><span class="section-number">2.4.3</span> The Mermaid engine</h3>
<p>The <code>mermaid</code> engine can be used to draw diagrams with
<a href="https://mermaid.js.org">mermaid.js</a>, e.g.,</p>
<pre><code class="language-md">```{mermaid, flow-abcd, echo = FALSE, fig.cap = 'A flowchart.'}
flowchart TD;
    A[WEB] --&gt; B[noweb] --&gt; D[Sweave] --&gt; E[knitr]
    A --&gt; C[CWEB]
    D --&gt; F[litedown]
```
</code></pre>
<p>The JS library mermaid.js has to be loaded for the diagrams to be rendered. By
default, the latest version of mermaid.js will be added to the <code>js</code> variable
(<a class="cross-ref-sec" href="#sec:the-js-variable">4.3.2.2</a>) in the YAML metadata automatically. If you prefer using a
specific version, you can add it manually to the YAML metadata, e.g.,</p>
<pre><code class="language-md">---
title: &quot;A mermaid diagram&quot;
output:
  html:
    meta:
      js: [&quot;@npm/mermaid@11.3.0/dist/mermaid.min.js&quot;]
---

```{mermaid}

```
</code></pre>
<h3 id="sec:the-embed-engine"><span class="section-number">2.4.4</span> The embed engine</h3>
<p>The <code>embed</code> engine can be used to embed text files verbatim in the output. You
can pass the file paths to the chunk option <code>file</code> or write the paths in the
chunk body (with optional quotes), e.g.,</p>
<pre><code class="language-md">```{embed, file = &quot;foo.txt&quot;}
```

```{embed}
&quot;foo.txt&quot;
```
</code></pre>
<p>You can use multiple paths in either case, e.g.,</p>
<pre><code class="language-md">```{embed, file = c(&quot;foo.txt&quot;, &quot;bar.R&quot;)}
```

```{embed}
&quot;foo.txt&quot;
bar.R
```
</code></pre>
<p>The content of the file(s) will be included in a fenced code block in the
output. For example, if <code>foo.txt</code> contains a single line “hello world”, the
output will be:</p>
<pre><code class="language-md">``` {.txt}
hello world
```
</code></pre>
<p>By default, the language name of the code block is from the file extension. You
can use the chunk option <code>attr.output</code> to customize the name, e.g.,</p>
<pre><code class="language-md">```{embed, file = &quot;foo.txt&quot;, attr.output = &quot;.md&quot;}
```
</code></pre>
<p>Then the output will be in a Markdown (<code>.md</code>) block:</p>
<pre><code class="language-md">``` {.md}
hello world
```
</code></pre>
<p>You can use the chunk option <code>results = &quot;hide&quot;</code> to hide the output, or
<code>results = &quot;asis&quot;</code> to output the file content as is (i.e., not wrapping it in a
code block).</p>
<h2 id="sec:comparison-to-knitr"><span class="section-number">2.5</span> Comparison to <strong>knitr</strong></h2>
<p>Major differences between <strong>knitr</strong> and <strong>litedown</strong> include:</p>
<ul>
<li>
<p><strong>knitr</strong> accepts a variety of input document formats, such as <code>*.Rnw</code>,
<code>*.Rhtml</code>, <code>*.Rmd</code>, <code>*.Rtex</code>, <code>*.Rrst</code>, and <code>*.Rasciidoc</code>,<sup class="footnote-ref"><a href="#fn-02-fuse-3" id="fnref-02-fuse-3" data-footnote-ref>5</a></sup>
whereas <strong>litedown</strong> only supports Markdown.</p>
</li>
<li>
<p><strong>knitr</strong> supports multiple graphics devices for a chunk via the <code>dev</code>
option, and <strong>litedown</strong> only supports one device for a chunk (but there are
multiple choices for this device). I hate the
<a href="https://github.com/yihui/knitr/blob/4510c0/R/block.R#L393-L426">ugly</a>
<a href="https://github.com/yihui/knitr/blob/69b063/R/plot.R#L288-L306">hacks</a> in
<strong>knitr</strong> for drawing a plot in one device and rendering it with other
devices later. This feature is not worth the effort due to the daunting
complexity of implementation, not to mention that it doesn’t always work. If
you need multiple file formats for the same plot in <strong>litedown</strong>, you should
start a new chunk with the same code (<a class="cross-ref-sec" href="#sec:option-ref-label">2.1.5.19</a>) and a different
<code>dev</code> option instead.</p>
</li>
<li>
<p><strong>knitr</strong> may output images in Markdown (<code>![]()</code>) or raw HTML (<code>&lt;img&gt;</code>) /
LaTeX (<code>\includegraphics{}</code>), depending on certain chunk options;
<strong>litedown</strong> always uses the Markdown syntax for figures, which is cleaner
and more portable.</p>
</li>
<li>
<p>The document parser of <strong>knitr</strong> is based solely on regular expressions and
not robust. Code chunks and inline expressions are not aware of their
contexts. The parser of <strong>litedown</strong> is based on <strong>commonmark</strong>, which is
more robust and makes it straightforward to write verbatim code or comment
out code (<a class="cross-ref-sec" href="#sec:skipped-chunks">2.1.3</a>).</p>
</li>
<li>
<p><strong>knitr</strong> supports a large number of chunk options and language engines, and
<strong>litedown</strong> only supports a limited number of chunk options and engines
(this number may grow in the future but perhaps not significantly).</p>
</li>
<li>
<p>Inline code for <strong>knitr</strong> does not support options or non-R languages, and
<strong>litedown</strong> is much more flexible in this regard.</p>
</li>
<li>
<p>All code chunks in <strong>knitr</strong> are executed in the linear order, and
<strong>litedown</strong> can execute code in an arbitrary custom order
(<a class="cross-ref-sec" href="#sec:option-order">2.1.5.16</a>).</p>
</li>
<li>
<p><strong>knitr</strong> supports chunk hooks and output hooks; <strong>litedown</strong> doesn’t
support hooks but the <code>attr.*</code> (<a class="cross-ref-sec" href="#sec:option-attr">2.1.5.1</a>) and <code>print</code>
(<a class="cross-ref-sec" href="#sec:option-print">2.1.5.17</a>) options have provided some flexibility in customizing
the chunk output.</p>
</li>
<li>
<p><strong>knitr</strong> is more than 12 years old and quite mature, and <strong>litedown</strong> is
new and still experimental.</p>
</li>
</ul>
<p>If you feel any indispensable <strong>knitr</strong> features are missing in <strong>litedown</strong>,
please feel free to suggest them in <a href="https://github.com/yihui/litedown">Github
issues</a>. However, please remember that the
goal of <strong>litedown</strong> is not to fully re-implement <strong>rmarkdown</strong>, <strong>knitr</strong> or
Pandoc. Some features may never be re-implemented, especially when the
implementation is not simple enough.</p>
<div class="chapter-after side side-right">
</div>
</div>
<div class="chapter body" data-source="docs/03-syntax.Rmd">
<div class="chapter-before side side-right">
<p><a href="https://github.com/yihui/litedown/edit/main/docs/03-syntax.Rmd">Edit this chapter</a> on GitHub</p>
</div>
<h1 id="chp:syntax"><span class="section-number main-number">3</span> Markdown Syntax</h1>
<div class="epigraph">
<blockquote>
<p>All the tired horses in a run; how’m I gonna get any writing done!</p>
<p>—<a href="https://bsky.app/profile/datavisfriendly.bsky.social/post/3lapaume4m22k">Michael
Friendly</a>
(and Bob Dylan)</p>
</blockquote>
</div>
<p>A Markdown document consists of a YAML frontmatter providing the document
metadata, and a Markdown body. The frontmatter is optional, and (if provided)
should be written using the syntax introduced in <a class="cross-ref-sec" href="#sec:yaml-syntax">3.1</a>. The syntax
for the body is introduced in <a class="cross-ref-sec" href="#sec:markdown-basic">3.2</a> and <a class="cross-ref-sec" href="#sec:markdown-addon">3.3</a>.</p>
<h2 id="sec:yaml-syntax"><span class="section-number">3.1</span> YAML syntax</h2>
<p>YAML stands for “YAML Ain’t Markup Language”, which aims at being a
“human-friendly data serialization language”. You may judge how “human-friendly”
it is<sup class="footnote-ref"><a href="#fn-03-syntax-1" id="fnref-03-syntax-1" data-footnote-ref>6</a></sup> by yourself after reading its specifications at
<a href="https://yaml.org">https://yaml.org</a>.</p>
<p>What we introduce in this section is a significantly trimmed-down version of
YAML used by <strong>litedown</strong>. For now, let’s call it TRACY, a recursive acronym for
“TRACY Really Ain’t Complete YAML” and also in honor of <a href="https://en.wikipedia.org/wiki/Tracy_Teal">Tracy
Teal</a> since she was once a nice boss
of mine.</p>
<p>The following example shows all types of data that TRACY supports:</p>
<pre><code class="language-yaml">a: 1
b: &quot;string&quot;
c: true
d: null
# e is also null
e:
# an expression
f: !expr 1 + 1
# vectors
g: [1, 2, 3]
h: [&quot;foo&quot;, &quot;bar&quot;]
# a nested list
i:
  i1: -1e8
  i2: &quot;another string&quot;
  i3:
    i31: [true, false, true]
any_character.is-okay: string not quoted
</code></pre>
<p>The TRACY specifications are:</p>
<ol>
<li>
<p>Each line should be of the form <code>field: value</code>. The <code>field</code> name can use any
character. The <code>value</code> cannot span across multiple lines. If a line starts
with <code>#</code>, it will be ignored (i.e., it is treated as a comment). Any line
that is not of the form <code>field: value</code> or a comment are ignored.</p>
</li>
<li>
<p>Values must be character, numeric, logical, expressions, null, or vectors.</p>
<ul>
<li>
<p>Character strings are quoted in either single or double quotes. Quotes
are optional when the values cannot be interpreted as other types of
values (e.g., numeric or logical).</p>
</li>
<li>
<p>Numeric values must consist of numbers (0-9), <code>+</code>, <code>-</code>, and <code>e</code>, and can
be converted to numbers.</p>
</li>
<li>
<p>Logical values must be either <code>true</code> or <code>false</code>. No other values are
recognized, such as <code>yes</code>, <code>YES</code>, <code>no</code>, <code>NO</code>,<sup class="footnote-ref"><a href="#fn-03-syntax-2" id="fnref-03-syntax-2" data-footnote-ref>7</a></sup> <code>on</code>, <code>off</code>,
<code>TRUE</code>, <code>FALSE</code>, <code>T</code>, <code>F</code>, <code>to be</code>, or <code>not to be</code> .</p>
</li>
<li>
<p>Expressions start with <code>!expr</code> followed by R code.</p>
</li>
<li>
<p>Null values can be either literally <code>null</code> or empty.</p>
</li>
<li>
<p>A vector consists of comma-separated character/numeric/logical values in
<code>[ ]</code>.</p>
</li>
</ul>
</li>
<li>
<p>If <code>value</code> is empty, and the next line is of the form <code>field: value</code>
indented by \(n\) white spaces (\(n \geq 1\)),<sup class="footnote-ref"><a href="#fn-03-syntax-3" id="fnref-03-syntax-3" data-footnote-ref>8</a></sup> the next line will
be treated as a child member of the current line. One field can have
multiple chidren indented to the same level, and each child can have its
children (further indented by \(n\) spaces).</p>
</li>
</ol>
<p>See <a class="cross-ref-sec" href="#sec:yaml-metadata">4.3</a> for all possible fields supported in <strong>litedown</strong>.</p>
<h2 id="sec:markdown-basic"><span class="section-number">3.2</span> Basic Markdown</h2>
<p>If you cannot learn the basic Markdown in this section (i.e.,
<a class="cross-ref-sec" href="#sec:markdown-basic">3.2</a>) in a few minutes, please feel free to file <a href="https://github.com/yihui/litedown/issues">a GitHub
issue</a> and I will send you a
sponsorship of $20 on GitHub.</p>
<h3 id="sec:inline-elements"><span class="section-number">3.2.1</span> Inline elements</h3>
<p>You can write these elements inline: <code>**strong**</code>, <code>_emphasis_</code>, <code>`code`</code>,
<code>~~strikethrough~~</code>, <code>[text](link)</code>, and <code>![alt](image/path)</code>.</p>
<div class="callout-note">
<p>For links and images, their URLs <a href="https://spec.commonmark.org/current/#link-destination">should not contain
spaces</a>. If they do, the
URLs must be enclosed in <code>&lt;&gt;</code>, e.g., <code>![alt](&lt;some dir/a subdir/foo.png&gt;).</code></p>
</div>
<p>The rest of elements in this section are block-level elements.</p>
<h3 id="sec:headings"><span class="section-number">3.2.2</span> Headings</h3>
<p>Headings start with a number of <code>#</code>’s, e.g., <code>## level-two heading</code>.</p>
<p>You are recommended to use <code>##</code> (level-two) as the top heading level in a
document, except for books, in which case each document is a chapter and you
should use <code>#</code> (level-one) as the top level.</p>
<h3 id="sec:paragraphs"><span class="section-number">3.2.3</span> Paragraphs</h3>
<p>Paragraphs are separated by blank lines.</p>
<h3 id="sec:code-blocks"><span class="section-number">3.2.4</span> Code blocks</h3>
<p>Code blocks can be indented by 4 spaces, or fenced by <code>```</code>. In the
latter case, the code block can have a class name (typically the language name).
For example, below is a JS code block:</p>
<pre><code class="language-md">```js
x &lt; 0 ? -x : x;
```
</code></pre>
<h3 id="sec:lists"><span class="section-number">3.2.5</span> Lists</h3>
<p>There are three types of lists: unordered, ordered, and task lists.</p>
<p>An unordered list item starts with <code>-</code>, <code>+</code>, or <code>*</code>, e.g., <code>- item</code>.</p>
<p>A task list item is a regular list item with <code>[ ]</code> (unchecked) or <code>[x]</code>
(checked) in the beginning, e.g., <code>- [ ] item</code>.</p>
<p>An ordered list item starts with a number followed by a period. The number of
the first item is used as the starting number of the list, and the rest of
numbers can be arbitrary. The examples on the left below are equivalent to those
on the right:</p>
<div class="flex-col">
<pre><code class="language-md">1. Get up!
1. Write a book!
1. Go to bed!
</code></pre>
<pre><code class="language-md">1. Get up!
2. Write a book!
3. Go to bed!
</code></pre>
</div>
<div class="flex-col">
<pre><code class="language-md">5. Get up!
100. Write a book!
1. Go to bed!
</code></pre>
<pre><code class="language-md">5. Get up!
6. Write a book!
7. Go to bed!
</code></pre>
</div>
<h3 id="sec:block-quotes"><span class="section-number">3.2.6</span> Block quotes</h3>
<p>Block quotes start with <code>&gt;</code> followed by a space and then the quote. A quote can
contain any number of any Markdown elements. If it contains multiple block-level
elements, each line needs to start with <code>&gt;</code>. For example, below is a block quote
with multiple paragraphs:</p>
<pre><code class="language-md">&gt; &quot;You're an oaf. I told you quite distinctly to make his discharge papers out.&quot;
&gt;
&gt; And all the bile which had accumulated in the judge advocate's soul in the course of that day because of Captain Linhart and Švejk poured out like a wild torrent on the head of the staff warder. At the end of it Bernis said:
&gt;
&gt; &quot;And now do you understand that you are a prize royal oaf?&quot;
&gt;
&gt; This is something which should only be said to kings and emperors, but even this simple staff warder, who was no royal personage, was not very pleased about it.
&gt;
&gt; ---Jaroslav Hašek, _The Good Soldier Švejk_ (Chapter 9)
</code></pre>
<h3 id="sec:tables"><span class="section-number">3.2.7</span> Tables</h3>
<p>Tables are created with <code>|</code> as the column separator, i.e., Pandoc’s pipe table,
which can be generated by <code>xfun::md_table(x)</code> or <code>knitr::kable(x, &quot;pipe&quot;)</code> if
you want to create a table from a rectangular object <code>x</code> in R.</p>
<pre><code class="language-md">| col 1 | col 2 | col 3 |
|:------|------:|:-----:|
| row 1 | row 1 | row 1 |
| row 2 | row 2 | row 2 |
</code></pre>
<p>The position of the colon below the table header controls the column alignment,
e.g., a colon on the right means the column is right-aligned, and colons on both
ends means the column is center-aligned.</p>
<h2 id="sec:markdown-addon"><span class="section-number">3.3</span> Add-on features</h2>
<p>In addition to the basic features above (supported by <strong>commonmark</strong>), the
<strong>litedown</strong> package also supports the following features.</p>
<h3 id="sec:raw-latex-html-blocks"><span class="section-number">3.3.1</span> Raw LaTeX/HTML blocks</h3>
<p>Raw LaTeX and HTML blocks can be written as fenced code blocks with language
names <code>=latex</code> (or <code>=tex</code>) and <code>=html</code>, e.g.,</p>
<pre><code class="language-markdown">```{=tex}
This only appears in \LaTeX{} output.
```
</code></pre>
<p>Raw LaTeX blocks will only appear in LaTeX output, and will be ignored in other
output formats. Similarly, raw HTML blocks will only appear in HTML output. One
exception is raw LaTeX blocks that are LaTeX math environments, which also work
for HTML output (see the next section).</p>
<h3 id="sec:latex-math_1"><span class="section-number">3.3.2</span> LaTeX math</h3>
<p>You can write both <code>$inline$</code> and <code>$$display$$</code> LaTeX math, e.g.,
\(\sin^{2}(\theta)+\cos^{2}(\theta) = 1\).</p>
<p>$$\bar{X} = \frac{1}{n} \sum_{i=1}^n X_i$$</p>
<p>$$|x| = \begin{cases}
x &amp;\text{if } x \geq 0 \\
-x &amp;\text{if } x &lt; 0
\end{cases}$$</p>
<p>For expressions in pairs of single or double dollar signs to be recognized as
LaTeX math, there must be no spaces after the opening dollar sign, or before the
closing dollar sign. The math expression should either start from the very
beginning of a line, or have a space or <code>(</code> before the opening dollar sign.</p>
<ul>
<li>
<p>For a pair of single dollar signs, they must be on the same line in the
text, and the closing dollar sign should not be followed by a number (to
avoid detecting math mistakenly from text like “a $5 bill and a $10
bill”). The inner math expression should not be wrapped in backticks.</p>
</li>
<li>
<p>For <code>$$ $$</code> expressions, they can span over multiple lines, in which case
the closing <code>$$</code> must have at least one non-space character before it, and
no spaces after it.</p>
</li>
</ul>
<p>Valid examples:</p>
<pre><code class="language-tex">$x + y$
($x + y$)
  $x + y$
text $x + y$ text

$$x + y$$
  $$x + y$$
text $$x + y$$ text
$$x +
  y$$
</code></pre>
<p>Invalid examples:</p>
<pre><code class="language-md">$ x + y$  &lt;- space after the opening `$`
text$x + y$  &lt;- lack of space before the opening `$`
text $x + y$10 text  &lt;- number after closing `$`
$x +
y$  &lt;- multi-line `$ $` expressions
$`x + y`$  &lt;- expression wrapped in backticks

$$x +
  y
$$
^- lack of non-space character before closing `$$`
</code></pre>
<p>LaTeX math environments are also supported, e.g., below are an <code>align</code>
environment and an <code>equation</code> environment:</p>
<pre><code class="language-tex">\begin{align}
a^{2}+b^{2} &amp; =  c^{2}\\
\sin^{2}(\theta)+\cos^{2}(\theta) &amp; =  1
\label{eq:pyth-identity}
\end{align}

\begin{equation}
  \begin{split}
  (a+b)^2 &amp;=(a+b)(a+b)\\
    &amp;=a^2+2ab+b^2
  \end{split}
\end{equation}
</code></pre>
<div class="callout-output">
<p>\begin{align}
a^{2}+b^{2} &amp; =  c^{2}\\
\sin^{2}(\theta)+\cos^{2}(\theta) &amp; =  1
\label{eq:pyth-identity}
\end{align}</p>
<p>\begin{equation}
  \begin{split}
  (a+b)^2 &amp;=(a+b)(a+b)\\
    &amp;=a^2+2ab+b^2
  \end{split}
\end{equation}</p>
</div>
<p>These math environments can be written as either nake LaTeX code or raw LaTeX
blocks (<code>```{=latex}</code>), but we recommend that you use raw LaTeX blocks
because they are more robust. LaTeX math environments work for both LaTeX and
HTML output.</p>
<p>For HTML output, it is up to the JavaScript library (MathJax or KaTeX) whether a
math environment can be rendered (<a class="cross-ref-sec" href="#sec:js-math">4.1.6</a>).</p>
<h3 id="sec:superscripts-and-subscripts"><span class="section-number">3.3.3</span> Superscripts and subscripts</h3>
<p>Write superscripts in <code>^text^</code> and subscripts in <code>~text~</code> (same syntax as
Pandoc’s Markdown), e.g., 2<sup>10</sup> and H<sub>2</sub>O. Currently only alphanumeric
characters, <code>*</code>, <code>(</code>, and <code>)</code> are allowed in the scripts. For example, <code>a^b c^</code>
will not be recognized as a superscript (because the space is not allowed). Note
that GFM supports striking out text via <code>~text~</code>, but this feature has been
disabled and replaced by the feature of subscripts in <strong>litedown</strong>. To strike
out text, you must use a pair of <em>double</em> tildes.</p>
<h3 id="sec:footnotes_1"><span class="section-number">3.3.4</span> Footnotes</h3>
<p>Insert footnotes via <code>[^n]</code>, where <code>n</code> is a footnote number (a unique
identifier). The footnote content should be defined in a separate block starting
with <code>[^n]:</code>. For example:</p>
<pre><code class="language-markdown">Insert a footnote here.[^1]

[^1]: This is the footnote.
</code></pre>
<p>The support is limited for LaTeX output at the moment, and there are two caveats
if the document is intended to be converted to LaTeX:</p>
<ul>
<li>
<p>The footnote content must be a single paragraph.</p>
</li>
<li>
<p>Only numbers<sup class="footnote-ref"><a href="#fn-03-syntax-4" id="fnref-03-syntax-4" data-footnote-ref>9</a></sup> are supported as identifiers, and other types of
identifiers are not recognized.</p>
</li>
</ul>
<p>The two limitations do not apply to HTML output, e.g., you can write arbitrary
elements in footnotes and not necessarily one paragraph.</p>
<h3 id="sec:attributes"><span class="section-number">3.3.5</span> Attributes</h3>
<p>Attributes on images, links, fenced code blocks, and section headings can be
written in <code>{}</code>. ID and class are two common attributes. An ID can be written
after the <code>#</code> character, and a class can be written after <code>.</code> . Attributes are
typically written in the form <code>name=&quot;value&quot;</code>, and separated by spaces (in fact,
you can also write IDs and classes explicitly like other attributes, e.g.,
<code>id=&quot;foo&quot; class=&quot;bar&quot;</code>). Certain attributes do not require values, and you can
provide the attribute name only, e.g., <code>disabled</code> or <code>contenteditable</code>, although
it is harmless to write <code>disabled=&quot;true&quot;</code>.</p>
<div class="callout-note">
<p>Only lowercase letters (a-z), digits (0-9), hyphens (<code>-</code>), and colons (<code>:</code>) are
allowed in ID and class strings. For example, <code>sec:intro</code> and <code>fig-cars</code> are
valid IDs, but <code>sec_intro</code> and <code>tab cars</code> are not.</p>
</div>
<p>For example, <code>![text](path){.foo #bar width=&quot;50%&quot;}</code> will generate an <code>&lt;img&gt;</code> tag
with attributes in HTML output:</p>
<pre><code class="language-html">&lt;img src=&quot;path&quot; alt=&quot;text&quot; id=&quot;bar&quot; class=&quot;foo&quot; width=&quot;50%&quot; /&gt;
</code></pre>
<p>and <code>## Heading {#baz}</code> will generate:</p>
<pre><code class="language-html">&lt;h2 id=&quot;baz&quot;&gt;Heading&lt;/h2&gt;
</code></pre>
<p>Links of the form <code>[text](url){...}</code> will generate:</p>
<pre><code class="language-html">&lt;a href=&quot;url&quot; ...&gt;&lt;/a&gt;
</code></pre>
<p>When the <code>url</code> is empty, <code>&lt;a&gt;</code> will be converted to <code>&lt;span&gt;</code>, e.g.,
<code>[text](){.foo .bar}</code> will generate:</p>
<pre><code class="language-html">&lt;span class=&quot;foo bar&quot;&gt;text&lt;/span&gt;
</code></pre>
<p>This provides a way to create <code>&lt;span&gt;</code> elements, which is similar to <a href="https://pandoc.org/MANUAL.html#extension-bracketed_spans">bracketed
<code>Span</code>s</a> (i.e.,
<code>[text]{...}</code>) in Pandoc’s Markdown.</p>
<p>For fenced code blocks, a special rule is that the first class name will be
treated as the language name for a block, and the <code>class</code> attribute of the
result <code>&lt;code&gt;</code> tag will have a <code>language-</code> prefix. For example, the following
code block</p>
<pre><code class="language-markdown">```{.foo .bar #my-code style=&quot;color: red;&quot;}
```
</code></pre>
<p>will generate the HTML output below:</p>
<pre><code class="language-html">&lt;pre&gt;
  &lt;code class=&quot;language-foo bar&quot; id=&quot;my-code&quot; style=&quot;color: red;&quot;&gt;
  &lt;/code&gt;
&lt;/pre&gt;
</code></pre>
<p>Most attributes in <code>{}</code> are ignored for LaTeX output except for:</p>
<ul>
<li>
<p>The <code>width</code> attribute for images, e.g., <code>![text](path){width=&quot;50%&quot;}</code> will be
converted to <code>\includegraphics[width=.5\linewidth]{path}</code>.</p>
</li>
<li>
<p>The <code>.unnumbered</code> attribute, which will make a heading unnumbered, e.g.,
<code># Hello {.unnumbered}</code> will be converted to <code>\section*{Hello}</code>.</p>
</li>
<li>
<p>The <code>.appendix</code> attribute on a heading, which will start the appendix, e.g.,
<code># Appendix {.appendix}</code> will be converted to <code>\appendix</code>.</p>
</li>
<li>
<p>The ID attributes on headings, which will be converted to <code>\label{}</code>, e.g.,
<code># Introduction {#sec:intro}</code> will be converted to
<code>\section{Introduction}\label{sec:intro}</code>.</p>
</li>
</ul>
<h3 id="sec:appendices"><span class="section-number">3.3.6</span> Appendices</h3>
<p>When a top-level heading has the attribute <code>.appendix</code>, the rest of the document
will be treated as the appendix. If section numbering is enabled
(<a class="cross-ref-sec" href="#sec:number-sections">4.1.9</a>), the appendix section headings will be numbered
differently.</p>
<h3 id="sec:fenced-divs"><span class="section-number">3.3.7</span> Fenced <code>Div</code>s</h3>
<p>A fenced <code>Div</code> can be written in <code>:::</code> fences. Note that the opening fence must
have at least one attribute, such as the class name. For example:</p>
<pre><code class="language-markdown">::: foo
This is a fenced Div.
:::

::: {.foo}
The syntax `::: foo` is equivalent to `::: {.foo}`.
:::

::: {.foo #bar style=&quot;color: red;&quot;}
This div has more attributes.

It will be red in HTML output.
:::
</code></pre>
<p>A fenced <code>Div</code> will be converted to <code>&lt;div&gt;</code> with attributes in HTML output,
e.g.,</p>
<pre><code class="language-html">&lt;div class=&quot;foo&quot; id=&quot;bar&quot; style=&quot;color: red;&quot;&gt;
&lt;/div&gt;
</code></pre>
<p>For LaTeX output, it can be converted to a LaTeX environment if both the class
name and an attribute <code>data-latex</code> are present. For example,</p>
<pre><code class="language-markdown">::: {.tiny data-latex=&quot;&quot;}
This is _tiny_ text.
:::
</code></pre>
<p>will be converted to:</p>
<pre><code class="language-latex">\begin{tiny}
This is \emph{tiny} text.
\end{tiny}
</code></pre>
<p>The <code>data-latex</code> attribute can be used to specify arguments to the environment
(which can be an empty string if the environment doesn’t need an argument). For
example,</p>
<pre><code class="language-markdown">::: {.minipage data-latex=&quot;{.5\linewidth}&quot;}
</code></pre>
<p>will be converted to:</p>
<pre><code class="language-latex">\begin{minipage}{.5\linewidth}
</code></pre>
<p>The <code>data-latex</code> attribute is optional for fenced <code>Div</code>s with class names
<code>figure</code> or <code>table</code>. They will be converted to <code>figure</code> or <code>table</code> environments.
For example,</p>
<pre><code class="language-markdown">:::: {.figure}
![](foo.png)

::: {.caption}
This is a caption.
:::
::::
</code></pre>
<p>will be converted to:</p>
<pre><code class="language-tex">\begin{figure}
  \includegraphics{foo.png}
  \caption{This is a caption.}
\end{figure}
</code></pre>
<p>Other fenced <code>Div</code>s will be ignored if they don’t have the <code>data-latex</code>
attribute, and their inner content will be written out normally without a
surrounding environment.</p>
<p>If a fenced <code>Div</code> has multiple class names (e.g., <code>{.a .b .c}</code>), only the first
class name will be used as the LaTeX environment name. However, all class names
will be used if the output format is HTML (e.g., <code>&lt;div class=&quot;a b c&quot;&gt;</code>).</p>
<h3 id="sec:cross-references"><span class="section-number">3.3.8</span> Cross-references</h3>
<p>To cross-reference an element, it must be numbered first. Then we can refer to
it by its ID.</p>
<h4 id="sec:sections-figures-and-tables"><span class="section-number">3.3.8.1</span> Sections, figures, and tables</h4>
<p>Section heading IDs can be either manually assigned or automatically generated
(<a class="cross-ref-sec" href="#sec:auto-identifiers">4.1.1</a>). Section numbers are automatically generated if the
<code>number_sections</code> option is true (<a class="cross-ref-sec" href="#sec:number-sections">4.1.9</a>).</p>
<p>Figures and tables are automatically numbered if their captions are provided
(via the chunk options <code>fig.cap</code> / <code>tab.cap</code>), e.g.,</p>
<pre><code class="language-md">```{r}
#| nice-plot, fig.cap = &quot;A nice caption&quot;

plot(cars)
```
</code></pre>
<p>To refer to an element in the text, use the syntax <code>@ID</code>, where <code>ID</code> is the ID
of the element to be referenced, which typically consists of a prefix (e.g.,
<code>sec:</code>, <code>fig:</code>, <code>tab:</code>, or <code>eq:</code>) and a label. For example:</p>
<pre><code class="language-md">Please see @fig:nice-plot for an overview of the `cars` data.
</code></pre>
<p>Hyphens (<code>-</code>) are also allowed in place of colons in the ID prefix, e.g.,
<code>@fig-nice-plot</code>.</p>
<h4 id="sec:latex-equations"><span class="section-number">3.3.8.2</span> LaTeX equations</h4>
<p>LaTeX math environments such as <code>align</code> and <code>equation</code> are numbered by default.
To refer to an expression (e.g., an equation) in a math environment, a label
needs to be assigned to the expression first via <code>\label{}</code>, and it must start
with the prefix <code>eq:</code> or <code>eq-</code>, e.g.,</p>
<pre><code class="language-md">```{=latex}
\begin{equation}
\sin^2(x) + \cos^2(x) = 1 \label{eq:pyth-identity}
\end{equation}
```
</code></pre>
<p>Then we can use either <code>@eq:*</code> or <code>@eqn:*</code> to cross-reference the equation,
e.g., <code>@eqn:pyth-identity</code>. Under the hood, the prefix <code>@eq</code> will be resolved to
<code>\ref{}</code>, and <code>@eqn</code> will be resolved to <code>\eqref{}</code>. If you are not familiar
with LaTeX commands <code>\ref{}</code> and <code>\eqref{}</code>, the main difference is that
<code>\eqref{}</code> will render the equation number in parentheses, e.g.,
\(\eqref{eq:pyth-identity}\), whereas <code>\ref{}</code> will only generate the equation number,
e.g., \(\ref{eq:pyth-identity}\).</p>
<p>In HTML output, <code>\eqref{}</code> will also add a label “Equation” before the number by
default. If you prefer writing the label manually and having control over the
parentheses, you can use <code>@eq:</code> instead of <code>@eqn:</code>, e.g., <code>Eq. [@eq:*]</code> (using
the label “Eq.” and square brackets).</p>
<p>In addition to equation numbers, you can also specify a tag for an equation via
<code>\tag{}</code> and refer to the equations by its tag, e.g.,</p>
<pre><code class="language-tex">For a right-angled triangle, we are all familiar with @eqn:pyth-theorem.

\begin{equation}
a^2 + b^2 = c^2 \label{eq:pyth-theorem} \tag{PT}
\end{equation}
</code></pre>
<div class="callout-output">
<p>For a right-angled triangle, we are all familiar with \(\eqref{eq:pyth-theorem}\).</p>
<p>\begin{equation}
a^2 + b^2 = c^2 \label{eq:pyth-theorem} \tag{PT}
\end{equation}</p>
</div>
<h4 id="sec:arbitrary-elements"><span class="section-number">3.3.8.3</span> Arbitrary elements</h4>
<p>You can cross-reference any other type of elements by adding empty anchors of
the form <code>[](#@ID)</code> into them, e.g.,</p>
<pre><code class="language-md">:::: {#lst:example .box}
::: caption
[](#@lst:example) A code listing demonstrating how to fold code blocks with JS.
:::

```js
document.querySelectorAll('pre').forEach(pre =&gt; {
  const d = document.createElement('details');
  d.innerHTML = '&lt;summary&gt;Details&lt;/summary&gt;';
  pre.before(d);  // insert &lt;details&gt; before &lt;pre&gt;
  d.append(pre);  // move &lt;pre&gt; into &lt;details&gt;
});
```
::::

We can cross-reference @lst:example.
</code></pre>
<div class="callout-output">
<div id="lst:example" class="box">
<div class="caption">
<p><span class="ref-number-lst">1</span> A code listing demonstrating how to fold code blocks with JS.</p>
</div>
<pre><code class="language-js">document.querySelectorAll('pre').forEach(pre =&gt; {
  const d = document.createElement('details');
  d.innerHTML = '&lt;summary&gt;Details&lt;/summary&gt;';
  pre.before(d);  // insert &lt;details&gt; before &lt;pre&gt;
  d.append(pre);  // move &lt;pre&gt; into &lt;details&gt;
});
</code></pre>
</div>
<p>We can cross-reference <a class="cross-ref-lst" href="#lst:example">1</a>.</p>
</div>
<style type="text/css">
[id^="lst:"] code[class] { background-color: inherit; }
</style>
<p>Note that we also added the ID (<code>#lst:example</code>) to the fenced Div to make it the
target of the cross reference, i.e., when you click on the reference, the
browser will navigate to the Div.</p>
<p>For HTML output, we can style the numbers and references with CSS. Element
numbers are wrapped in <code>&lt;span class=&quot;ref-number-*&quot;&gt;&lt;/span&gt;</code>, and references are
wrapped in <code>&lt;span class=&quot;cross-ref-*&quot;&gt;&lt;/span&gt;</code>, where <code>*</code> is the ID prefix
(e.g., <code>fig</code>, <code>tab</code>, and <code>eqn</code>). For example, we can add the label “Listing” to
the number and reference of the block above:</p>
<pre><code class="language-css">.ref-number-lst::before, .cross-ref-lst::before {
  content: &quot;Listing &quot;;
}
.ref-number-lst {
  font-style: italic;
}
.ref-number-lst::after {
  content: &quot;. &quot;
}
</code></pre>
<style type="text/css">
.ref-number-lst::before, .cross-ref-lst::before {
  content: "Listing ";
}
.ref-number-lst {
  font-style: italic;
}
.ref-number-lst::after {
  content: ". "
}
</style>
<h3 id="sec:citations"><span class="section-number">3.3.9</span> Citations</h3>
<p>This feature requires the R package <strong>rbibutils</strong>. Please make sure it is
installed before using citations.</p>
<pre><code class="language-r">xfun::pkg_load2(&quot;rbibutils&quot;)
</code></pre>
<p>To insert citations, you have to first declare one or multiple bibliography
databases in the YAML metadata, e.g.,</p>
<pre><code class="language-yaml">bibliography: [&quot;papers.bib&quot;, &quot;books.bib&quot;]
</code></pre>
<p>Each <code>.bib</code> file contains entries that start with keywords. For example,
<code>R-base</code> is the keyword for the following entry:</p>
<pre><code class="language-plain">@Manual{R-base,
  title = {R: A Language and Environment for Statistical Computing},
  author = {{R Core Team}},
  organization = {R Foundation for Statistical Computing},
  address = {Vienna, Austria},
  year = {2024},
  url = {https://www.R-project.org/},
}
</code></pre>
<p>Then you can use <code>[@R-base]</code> or <code>@R-base</code> to cite this item. The keywords must
consist of only alphanumeric characters (<code>a-z</code>, <code>A-Z</code>, <code>0-9</code>) and <code>-</code>. You can
include multiple keywords in <code>[ ]</code> separated by semicolons.</p>
<p>For HTML output, the citation uses the author-year style. The syntax
<code>[@keyword]</code> generates the citation in parentheses (e.g., <code>(Author, 2024)</code>), and
<code>@keyword</code> only puts the year in parentheses (e.g., <code>Author (2024)</code>).</p>
<p>For LaTeX output, the citation style depends on the LaTeX package, which you can
set via the <code>citation_package</code> option of the output format in YAML metadata,
e.g.,</p>
<pre><code class="language-yaml">output:
  latex:
    citation_package: biblatex
</code></pre>
<p>The default is <code>natbib</code>. The table below shows the LaTeX commands corresponding
to the Markdown citation syntax:</p>
<table>
<thead>
<tr>
<th>citation package</th>
<th><code>[@key-1; @key-2]</code></th>
<th><code>@key</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>none</td>
<td><code>\cite{key-1, key-2}</code></td>
<td><code>\cite{key}</code></td>
</tr>
<tr>
<td>natbib</td>
<td><code>\citep{key-1, key-2}</code></td>
<td><code>\citet{key}</code></td>
</tr>
<tr>
<td>biblatex</td>
<td><code>\parencite{key-1, key-2}</code></td>
<td><code>\cite{key}</code></td>
</tr>
</tbody>
</table>
<p>Note that <strong>litedown</strong> actually generates <code>\citep</code> and <code>\citet</code> regardless of
the citation package, but will redefine them to <code>\cite</code> or <code>\parencite</code>
according to the citation package. For example, it will insert
<code>\let\citep\parencite</code> in the LaTeX preamble when <code>citation_package</code> is
<code>biblatex</code>.</p>
<h3 id="sec:smart-html-entities"><span class="section-number">3.3.10</span> Smart HTML entities</h3>
<p>“Smart” HTML entities can be represented by ASCII characters, e.g., you can
write fractions in the form <code>n/m</code>. Below are some example entities:</p>
<table>
<thead>
<tr>
<th><code>1/2</code></th>
<th><code>1/3</code></th>
<th><code>2/3</code></th>
<th><code>7/8</code></th>
<th><code>1/7</code></th>
<th><code>1/9</code></th>
<th><code>1/10</code></th>
<th><code>(c)</code></th>
<th><code>(r)</code></th>
<th><code>(tm)</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>½</td>
<td>⅓</td>
<td>⅔</td>
<td>⅞</td>
<td>⅐</td>
<td>⅑</td>
<td>⅒</td>
<td>©</td>
<td>®</td>
<td>™</td>
</tr>
</tbody>
</table>
<h2 id="sec:comparison-to-pandoc"><span class="section-number">3.4</span> Comparison to Pandoc</h2>
<p>As mentioned earlier, a lot of features in Pandoc’s Markdown are not supported
in the <strong>litedown</strong> package. Any feature that you find missing in previous
sections is likely to be unavailable. In addition, a lot of R Markdown and
Quarto (both are based on Pandoc) features are not supported, either. Some HTML
features have been implemented via JavaScript and CSS.</p>
<p>Pandoc can convert Markdown to many output formats, such as Word, PowerPoint,
LaTeX beamer, and EPUB. The <strong>litedown</strong> package is unlikely to support output
formats beyond HTML and LaTeX.</p>
<div class="chapter-after side side-right">
</div>
</div>
<div class="chapter body" data-source="docs/04-mark.Rmd">
<div class="chapter-before side side-right">
<p><a href="https://github.com/yihui/litedown/edit/main/docs/04-mark.Rmd">Edit this chapter</a> on GitHub</p>
</div>
<h1 id="chp:mark"><span class="section-number main-number">4</span> Markdown Rendering</h1>
<div class="epigraph">
<blockquote>
<p>Mature mental health demands, then, an extraordinary capacity to flexibly
strike and continually restrike a delicate balance between conflicting needs,
goals, duties, responsibilities, directions, et cetera. The essence of this
discipline of balancing is “giving up.”</p>
<p>—M. Scott Peck, <em>The Road Less Traveled</em></p>
</blockquote>
</div>
<p>The main function to convert Markdown to other formats is <code>litedown::mark()</code>.</p>
<p>The output format can be specified in the <code>output</code> (or <code>format</code>) field in YAML
metadata (<a class="cross-ref-sec" href="#sec:yaml-metadata">4.3</a>), e.g.,</p>
<pre><code class="language-yaml">---
output:
  html:
    options:
      js_math:
        package: &quot;katex&quot;
        version: &quot;0.16.4&quot;
      number_sections: true
      embed_resources: [&quot;local&quot;, &quot;https&quot;]
    meta:
      css: &quot;custom.css&quot;
---
</code></pre>
<h2 id="sec:markdown-options"><span class="section-number">4.1</span> Markdown options</h2>
<p>The <code>options</code> argument of <code>mark()</code> can be used to enable/disable/set options to
control Markdown rendering. This argument can take either a list, e.g.,
<code>list(toc = TRUE, smart = FALSE)</code>, or a character vector, e.g.,
<code>c(&quot;+toc&quot;, &quot;-smart&quot;)</code>, or equivalently, <code>+toc-smart</code>, where <code>+</code> means to enable
an option, and <code>-</code> means to disable an option. The options can also be set in
YAML metadata in <a class="cross-ref-sec" href="#sec:yaml-metadata">4.3</a> (recommended). Available options are listed
below.</p>
<h3 id="sec:auto-identifiers"><span class="section-number">4.1.1</span> <code>auto_identifiers</code></h3>
<p>Add automatic IDs to headings, e.g.,</p>
<pre><code class="language-markdown"># Hello world!

## Introduction
</code></pre>
<p>will be converted to</p>
<pre><code class="language-html">&lt;h1 id=&quot;chp:hello-world&quot;&gt;Hello world!&lt;/h1&gt;

&lt;h2 id=&quot;sec:introduction&quot;&gt;Introduction&lt;/h2&gt;
</code></pre>
<p>The prefix <code>chp:</code> (chapter) will be added to the automatic IDs of level-one
headings, and <code>sec:</code> (section) will be added for other levels of headings.</p>
<p>You can override the automatic ID by providing an ID manually via the ID
attribute, e.g.,</p>
<pre><code class="language-markdown"># Hello world! {#hello}
</code></pre>
<p>An automatic ID is generated by substituting non-alphanumeric characters in the
heading text with hyphens. If the result is empty, the ID will be <code>section</code>. If
any ID is duplicated, a numeric suffix will be added to the ID, e.g.,
<code>example_1</code> and <code>example_2</code>.</p>
<h3 id="sec:cleveref"><span class="section-number">4.1.2</span> <code>cleveref</code></h3>
<p>Whether to use the LaTeX package <a href="https://ctan.org/pkg/cleveref"><strong>cleveref</strong></a>
for “clever” cross-references (<a class="cross-ref-sec" href="#sec:cross-references">3.3.8</a>). This option is for LaTeX
output only. If enabled, <strong>cleveref</strong> will be loaded and references will use the
command <code>\cref{}</code> instead of <code>\ref{}</code>, which will automatically add the type of
reference before the reference number, e.g., <code>\cref{sec:intro}</code> may generate
<code>Section 1</code>, so you do not have to write <code>Section \ref{sec:intro}</code>.</p>
<h3 id="sec:embed-cleanup"><span class="section-number">4.1.3</span> <code>embed_cleanup</code></h3>
<p>Whether to clean up plot files after they have been embedded in HTML output (see
<a class="cross-ref-sec" href="#sec:embed-resources">4.1.4</a>).</p>
<h3 id="sec:embed-resources"><span class="section-number">4.1.4</span> <code>embed_resources</code></h3>
<p>Embed resources (images, CSS, and JS) in the HTML output using their
base64-encoded data (images) or raw content (CSS/JS). Possible values are:</p>
<ul>
<li>
<p><code>null</code> or <code>false</code>: Do not embed any resources.</p>
</li>
<li>
<p><code>&quot;local&quot;</code> or <code>true</code>: Embed local image/CSS/JS files.</p>
</li>
<li>
<p><code>&quot;https&quot;</code>: Embed web resources (links that start with <code>https://</code>).</p>
</li>
<li>
<p><code>&quot;all&quot;</code>: An alias to the union of <code>&quot;local&quot;</code> and <code>&quot;https&quot;</code>.</p>
</li>
</ul>
<p>The default is <code>&quot;local&quot;</code>, i.e., local resources are embedded, whereas <code>https</code>
resources are not. This means the output document may not work offline. If you
have to view the output offline, you need to use the option value <code>&quot;https&quot;</code> (or
<code>&quot;all&quot;</code>) and render the document at least once before you go offline.</p>
<h3 id="sec:js-highlight"><span class="section-number">4.1.5</span> <code>js_highlight</code></h3>
<p>Specify the JavaScript library to syntax highlight code blocks. Possible values
are <code>highlight</code> (<a href="https://highlightjs.org">highlight.js</a>) and <code>prism</code>
(<a href="https://prismjs.com">Prism.js</a>). The default is <code>prism</code>. This option can also
take a list of the form <code>list(package, version, style, languages)</code>, which
specifies the package name (<code>highlight</code> or <code>prism</code>), version, CSS style/theme
name, and names of languages to be highlighted.</p>
<ul>
<li>
<p>You can find information about Prism.js from its CDN at
<a href="https://cdn.jsdelivr.net/npm/prismjs/">https://cdn.jsdelivr.net/npm/prismjs/</a>. Available styles are under the
<code>themes/</code> directory (e.g., <code>prism-dark</code>), and languages are under the
<code>components/</code> directory (e.g., <code>prism-c</code>). You can omit the prefix <code>prism-</code>,
e.g.,</p>
<pre><code class="language-yaml">js_highlight:
  package: prism
  style: dark
  languages: [r, latex, yaml]
</code></pre>
</li>
<li>
<p>The CDN of highlight.js is at
<a href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/">https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/</a>. Themes are
under the <code>styles/</code> directory (e.g., <code>github</code>), and you can find demos of
themes at <a href="https://highlightjs.org/static/demo/">https://highlightjs.org/static/demo/</a>. Supported language are
under the <code>languages/</code> directory (e.g., <code>latex</code>).</p>
</li>
</ul>
<p>By default, languages are automatically detected and the required JS files are
automatically loaded. Normally you need to specify the <code>languages</code> array only if
the automatic detection fails.</p>
<p>Technically this option is a shorthand for setting the metadata variables <code>css</code>
and <code>js</code> in <a class="cross-ref-sec" href="#sec:yaml-metadata">4.3</a>. If you want full control, you may disable this
option (set it to <code>false</code> or <code>null</code>) and use metadata variables directly, which
requires more familiarity with the JS libraries and the jsdelivr CDN.</p>
<h3 id="sec:js-math"><span class="section-number">4.1.6</span> <code>js_math</code></h3>
<p>Specify the JavaScript library for rendering math expressions in HTML output.
Possible values are <code>&quot;mathjax&quot;</code> and <code>&quot;katex&quot;</code> (the default). Like the
<code>js_highlight</code> option, this option is also essentially a shorthand for setting
the metadata variables <code>css</code> and <code>js</code>.</p>
<ul>
<li>
<p>For <a href="https://www.mathjax.org/#gettingstarted">MathJax</a>, the <code>js</code> variable is
set to <code>tex-mml-chtml.js</code>.</p>
</li>
<li>
<p>For <a href="https://katex.org/docs/browser.html">KaTeX</a>, the <code>js</code> variable is set
to <code>katex.min.js</code> and the <code>css</code> variable is set to <code>katex.min.css</code>. KaTeX’s
<code>auto-render</code> extension (<code>auto-render.min.js</code>) is also enabled by default,
so math expressions can be immediately rendered when the page is loaded.</p>
</li>
</ul>
<p>If you want finer control, you can provide a list of the form
<code>list(package, version, css, js)</code>. This will allow you to specify the package
name, version, and css/js files. For example, if you want to use MathJax’s
<code>tex-chtml.js</code> instead, you may set:</p>
<pre><code class="language-yaml">js_math:
  package: mathjax
  version: 3
  js: es5/tex-chtml.js
</code></pre>
<p>By default, MathJax version 3 is used. If you want to use the older v2, you may
set:</p>
<pre><code class="language-yaml">js_math:
  package: mathjax
  version: 2
  js: MathJax.js?config=TeX-AMS-MML_CHTML
</code></pre>
<p>Please visit <a href="https://cdn.jsdelivr.net/npm/mathjax/">the MathJax CDN</a> to know
which versions and JS files are available.</p>
<p>For KaTeX, the version is not specified by default, which means the latest
version from <a href="https://cdn.jsdelivr.net/npm/katex/">the CDN</a>. Below is an example
of specifying the version 0.16.4 and using the <code>mhchem</code> extension:</p>
<pre><code class="language-yaml">js_math:
  package: katex
  version: 0.16.4
  js: [dist/katex.min.js, dist/contrib/mhchem.min.js]
</code></pre>
<p>Note that if you want the HTML output to be self-contained via the
<code>embed_resources</code> option, KaTeX can be embedded and used offline, but MathJax
cannot be fully embedded due to its complexity. MathJax v3 can be partially
embedded and used offline, but currently only its fonts can be embedded, and
extensions cannot. If you must view HTML output offline, we recommend using
KaTeX, but please also note that KaTeX and MathJax do not fully cover each
other’s features.</p>
<h3 id="sec:keep-yaml"><span class="section-number">4.1.7</span> <code>keep_yaml</code></h3>
<p>Whether to keep the YAML metadata in the output. When <code>TRUE</code>, the original YAML
in the Markdown input (if exists) will be written to the output. Note that when
this option is enabled, templates (<a class="cross-ref-sec" href="#sec:templates">4.2</a>) will be disabled and <code>mark()</code>
will only generate a document fragment. This option was introduced mainly for
Hugo websites to use <strong>litedown</strong> instead of Hugo’s Markdown engines to render
pages.</p>
<h3 id="sec:latex-math_2"><span class="section-number">4.1.8</span> <code>latex_math</code></h3>
<p>Whether to identify LaTeX math expressions in pairs of single (<code>$ $</code>) or double
dollar signs (<code>$$ $$</code>), and transform them so that they could be correctly
rendered by MathJax (HTML output) or LaTeX.</p>
<h3 id="sec:number-sections"><span class="section-number">4.1.9</span> <code>number_sections</code></h3>
<p>Whether to number section headings. To skip numbering a specific heading, add a
class attribute <code>.unnumbered</code> (or use the shorthand <code>-</code>) to it. For example:</p>
<pre><code class="language-md">## Preface {.unnumbered}

## About the author {-}
</code></pre>
<h3 id="sec:smartypants"><span class="section-number">4.1.10</span> <code>smartypants</code></h3>
<p>Whether to translate certain ASCII strings into smart typographic characters
(see <code>?litedown::smartypants</code>).</p>
<h3 id="sec:superscript"><span class="section-number">4.1.11</span> <code>superscript</code></h3>
<p>Whether to translate strings between two carets into superscripts, e.g.,
<code>text^foo^</code> to <code>text&lt;sup&gt;foo&lt;/sup&gt;</code>.</p>
<h3 id="sec:subscript"><span class="section-number">4.1.12</span> <code>subscript</code></h3>
<p>Whether to translate strings between two tildes into subscripts, e.g.,
<code>text~foo~</code> to <code>text&lt;sub&gt;foo&lt;/sub&gt;</code>.</p>
<h3 id="sec:toc"><span class="section-number">4.1.13</span> <code>toc</code></h3>
<p>Whether to generate a table of contents (TOC) from section headings. If a
heading has an <code>id</code> attribute, the corresponding TOC item will be a link to this
heading. You can also set a sub-option:</p>
<ul>
<li>
<p><code>depth</code>: The number of section levels to include in the TOC (<code>3</code> by
default). Setting <code>toc</code> to <code>true</code> is equivalent to:</p>
<pre><code class="language-yaml">toc:
  depth: 3
</code></pre>
</li>
</ul>
<p>To exclude a certain heading from the TOC, assign a class name <code>unlisted</code> to it.
For example:</p>
<pre><code class="language-md">## Acknowledgments {.unlisted}
</code></pre>
<h3 id="sec:top-level"><span class="section-number">4.1.14</span> <code>top_level</code></h3>
<p>The desired type of the top-level headings in LaTeX output. Possible values are
<code>'chapter'</code> and <code>'part'</code>. For example, if <code>top_level = 'chapter'</code>, <code># heading</code>
will be rendered to <code>\chapter{heading}</code> instead of the default
<code>\section{heading}</code>.</p>
<p>Options not described above can be found on the help pages of <strong>commonmark</strong>,
e.g., the <code>hardbreaks</code> option is for the <code>hardbreaks</code> argument of
<code>commonmark::markdown_*()</code> functions, and the <code>table</code> option is for the <code>table</code>
extension in <strong>commonmark</strong>’s extensions.</p>
<pre><code class="language-r">litedown::markdown_options()
#&gt;  [1] &quot;-cleveref&quot;         &quot;-hardbreaks&quot;       &quot;-number_sections&quot; 
#&gt;  [4] &quot;-smartypants&quot;      &quot;-tagfilter&quot;        &quot;-toc&quot;             
#&gt;  [7] &quot;+auto_identifiers&quot; &quot;+autolink&quot;         &quot;+cross_refs&quot;      
#&gt; [10] &quot;+embed_cleanup&quot;    &quot;+embed_resources&quot;  &quot;+js_highlight&quot;    
#&gt; [13] &quot;+js_math&quot;          &quot;+latex_math&quot;       &quot;+smart&quot;           
#&gt; [16] &quot;+strikethrough&quot;    &quot;+subscript&quot;        &quot;+superscript&quot;     
#&gt; [19] &quot;+table&quot;            &quot;+tasklist&quot;        
# commonmark's arguments
opts = formals(commonmark::markdown_html)
opts = opts[setdiff(names(opts), c('text', 'extensions'))]
unlist(opts)
#&gt; hardbreaks      smart  normalize  sourcepos  footnotes 
#&gt;      FALSE      FALSE      FALSE      FALSE      FALSE 
# commonmark's extensions
commonmark::list_extensions()
#&gt; [1] &quot;table&quot;         &quot;strikethrough&quot; &quot;autolink&quot;      &quot;tagfilter&quot;    
#&gt; [5] &quot;tasklist&quot;     
</code></pre>
<h2 id="sec:templates"><span class="section-number">4.2</span> Templates</h2>
<p>By default, <code>mark()</code> generates a document fragment (i.e., the body) if the input
does not contain YAML metadata at the beginning. To generate a full document,
you need to specify YAML metadata. A full document is generated with a template.
Below is a simple HTML template example:</p>
<pre><code class="language-html">&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;$title$&lt;/title&gt;
  &lt;/head&gt;

  &lt;body&gt;
  $body$
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>It contains two variables, <code>$title$</code> and <code>$body$</code>. All variables will be
substituted by metadata values, except for <code>$body$</code>, which is from the body of
the input document (after conversion to a target output format).</p>
<p>The <strong>litedown</strong> has provided default templates for
<a href="https://github.com/yihui/litedown/blob/main/inst/resources/litedown.html">HTML</a>
and
<a href="https://github.com/yihui/litedown/blob/main/inst/resources/litedown.latex">LaTeX</a>
output. To pass metadata to templates, use the <code>meta</code> argument, e.g.,</p>
<pre><code class="language-r">litedown::mark(..., meta = list(title = &quot;My Title&quot;))
</code></pre>
<p>If you want to use a custom template file, you can set the path in the global
option <code>litedown.FORMAT.template</code> (where <code>FORMAT</code> is the output format name
(<code>html</code> or <code>latex</code>), e.g., in <code>.Rprofile</code>:</p>
<pre><code class="language-r">options(litedown.html.template = 'path/to/my/template.html')
</code></pre>
<p>The global option will be applied to all documents to be converted by <code>mark()</code>.
Alternatively, you can pass a template path to the <code>template</code> argument of the
output format <code>html</code> or <code>latex</code> in an individual document, e.g.,</p>
<pre><code class="language-yaml">---
output:
  html:
    template: &quot;path/to/my/template.html&quot;
---
</code></pre>
<p>The template path can also take a logical value: <code>TRUE</code> means to use the default
template, and <code>FALSE</code> means to generate only a fragment document without using
any template.</p>
<h2 id="sec:yaml-metadata"><span class="section-number">4.3</span> YAML metadata</h2>
<p>Alternatively, the <code>meta</code> argument can read YAML metadata in the Markdown
document.</p>
<h3 id="sec:top-level-variables"><span class="section-number">4.3.1</span> Top-level variables</h3>
<p>The following variables can be set in the top-level fields in YAML:</p>
<ul>
<li>
<p><code>abstract</code>: The abstract.</p>
</li>
<li>
<p><code>author</code>: The document author(s).</p>
</li>
<li>
<p><code>date</code>: The date.</p>
</li>
<li>
<p><code>subtitle</code>: The document subtitle.</p>
</li>
<li>
<p><code>title</code>: The document title.</p>
</li>
</ul>
<p>For example:</p>
<pre><code class="language-yaml">---
title: &quot;My Title&quot;
author: &quot;[Frida Gomam](https://example.com)&quot;
date: &quot;2023-01-09&quot;
---
</code></pre>
<p>The values are treated as Markdown text, and will be converted to the target
output format before being passed to the template. For the above example, the
variable <code>$author$</code> will be <code>&lt;a href=&quot;https://example.com&quot;&gt;Frida Gomam&lt;/a&gt;</code> in
the HTML template.</p>
<p>For top-level variables, <code>mark()</code> will also create the “underscore” versions for
templates, which contain HTML and LaTeX markups. For example, for the <code>$title$</code>
variable, <code>$title_$</code> will also be available to the template. The following table
shows the values of the underscore variables, assuming the original value of a
variable is <code>TEXT</code>:</p>
<table>
<thead>
<tr>
<th>Variables</th>
<th>HTML</th>
<th>LaTeX</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>$title_$</code></td>
<td><code>&lt;div class=&quot;title&quot;&gt; &lt;h1&gt;TEXT&lt;/h1&gt; &lt;/div&gt;</code></td>
<td><code>\title{TEXT}</code></td>
</tr>
<tr>
<td><code>$subtitle_$</code></td>
<td><code>&lt;div class=&quot;subtitle&quot;&gt; &lt;h2&gt;TEXT&lt;/h2&gt; &lt;/div&gt;</code></td>
<td><code>\subtitle{TEXT}</code></td>
</tr>
<tr>
<td><code>$author_$</code></td>
<td><code>&lt;div class=&quot;author&quot;&gt; &lt;h2&gt;TEXT&lt;/h2&gt; &lt;/div&gt;</code></td>
<td><code>\author{TEXT}</code></td>
</tr>
<tr>
<td><code>$date_$</code></td>
<td><code>&lt;div class=&quot;date&quot;&gt; &lt;h3&gt;TEXT&lt;/h3&gt; &lt;/div&gt;</code></td>
<td><code>\date{TEXT}</code></td>
</tr>
<tr>
<td><code>$abstract_$</code></td>
<td><code>&lt;div class=&quot;abstract&quot;&gt; &lt;p&gt;TEXT&lt;/p&gt; &lt;/div&gt;</code></td>
<td><code>\begin{abstract} TEXT \end{abstract}</code></td>
</tr>
</tbody>
</table>
<p>If an original variable is empty or missing, its underscore version will also be
empty. For the <code>$author_$</code> variable, if the <code>$author$</code> variable contains
multiple author names as an array, each name will be in a separate <code>&lt;h2&gt;</code> in
HTML output, and all names will be concatenated by <code>\and</code> in LaTeX output, e.g.,
for</p>
<pre><code class="language-yaml">author: [&quot;Jane X&quot;, &quot;John Y&quot;]
</code></pre>
<p>in YAML, the HTML output will be:</p>
<pre><code class="language-html">&lt;div class=&quot;author&quot;&gt;
  &lt;h2&gt;Jane X&lt;/h2&gt;
  &lt;h2&gt;John Y&lt;/h2&gt;
&lt;/div&gt;
</code></pre>
<p>and the LaTeX output will be:</p>
<pre><code class="language-tex">\author{Jane X \and John Y}
</code></pre>
<p>If you design your own template, you are free to use either the original or the
underscore versions of these variables. For example, you could put the title in
an <code>&lt;h1&gt;</code> without the <code>&lt;div&gt;</code> wrapper via <code>&lt;h1 class=&quot;title&quot;&gt;$title$&lt;/h1&gt;</code>
instead of using <code>$title_$</code>.</p>
<p>When these top-level variables are also provided as <code>meta</code> variables for an
output format, the latter will override the former, e.g.,</p>
<pre><code class="language-yaml">title: &quot;Global Title&quot;
output:
  html:
    meta:
      title: &quot;Title for HTML output&quot;
  latex:
    meta:
      title: &quot;Title for LaTeX output&quot;
</code></pre>
<h3 id="sec:format-specific-variables"><span class="section-number">4.3.2</span> Format-specific variables</h3>
<p>Other variables need to be specified under <code>output -&gt; * -&gt; meta</code>, where <code>*</code> can
be <code>html</code> or <code>latex</code>, e.g.,</p>
<pre><code class="language-yaml">---
title: &quot;My Title&quot;
output:
  html:
    meta:
      css: &quot;style.css&quot;
      js: &quot;script.js&quot;
  latex:
    meta:
      documentclass: &quot;book&quot;
      header_includes: &quot;\usepackage{microtype}&quot;
---
</code></pre>
<p>The following metadata variables are supported for both HTML and LaTeX
templates:</p>
<ul>
<li><code>header-includes</code>, <code>include-before</code>, <code>include-after</code>: Either a vector of
(HTML/LaTeX) code or a code file to be included in the header, before the
body, or after the body of the output.</li>
</ul>
<hr />
<p>The following variables are for HTML templates:</p>
<h4 id="sec:the-css-variable"><span class="section-number">4.3.2.1</span> The <code>css</code> variable</h4>
<p>A vector of CSS files to be included in the output. The default value is
<code>litedown:::pkg_file('resources', 'default.css')</code>.</p>
<p>If you want to use built-in CSS files in this package, you can only specify the
base name, e.g., <code>default</code> means <code>default.css</code> in this package.</p>
<p>You can also use web resources, e.g., <code>https://example.org/style.css</code>. One
special case is <a href="https://www.jsdelivr.com">jsdelivr</a> resources: if a <code>css</code> value
starts with <code>@</code>, it will be recognized as a jsdelivr.com resource. if you are
not familiar with jsdelivr, you may read its documentation to understand the
following example URLs. The shorthand syntax is as follows (<code>CDN</code> stands for
<code>https://cdn.jsdelivr.net</code>):</p>
<ul>
<li>
<p><code>@foo</code> (without a filename extension) will be converted to
<code>CDN/npm/@xiee/utils/css/foo.min.css</code>, e.g., <code>@default</code> means
<code>CDN/npm/@xiee/utils/css/default.min.css</code>. If you prefer the <code>.css</code>
extension over <code>.min.css</code>, you can use <code>@default.css</code>.</p>
</li>
<li>
<p><code>@foo@version</code> (a filename followed by a version number) will be converted
to <code>CDN/npm/@xiee/utils@version/css/foo.min.css</code>, e.g., <code>@article@1.12.0</code>
means <code>CDN/npm/@xiee/utils@1.12.0/css/article.min.css</code>.</p>
</li>
<li>
<p><code>@path/to/file</code> (i.e., a value that contains slashes) will be converted to
<code>CDN/path/to/file</code>, e.g., <code>@npm/@xiee/utils/js/center-img.js</code> will be
converted to <code>CDN/npm/@xiee/utils/js/center-img.min.js</code>.</p>
</li>
<li>
<p><code>@path/to/file-1,file-2</code> (comma-separated values and later values do not
contain slashes) will be converted to
<code>CDN/combine/path/to/file-1,path/to/file-2</code> (this can be useful to
<a href="https://www.jsdelivr.com/documentation#id-combine-multiple-files">combine</a>
multiple resources and load all at once).</p>
</li>
<li>
<p><code>@path-1/to/file-1,path-2/to/file-2</code> (comma-separated values and later
values contain slashes) will be converted to
<code>CDN/combine/path-1/to/file-1,path-2/to/file-2</code>.</p>
</li>
</ul>
<p>This provides a way to reduce the output HTML file size by loading CSS from the
web instead of embedding inside HTML, at the cost of requiring Internet
connection when viewing the HTML file. If you need the external web resources to
work after you go offline, you can enable <code>&quot;https&quot;</code> in the Markdown option
<code>embed_resources</code> in advance to embed the resources.</p>
<h4 id="sec:the-js-variable"><span class="section-number">4.3.2.2</span> The <code>js</code> variable</h4>
<p>A vector of JavaScript files to be included in the output. The syntax is the
same as the <code>css</code> variable, e.g., <code>snap</code> means <code>snap.js</code> in this package,
<code>@snap</code> means a “jsdelivr” resource, and you can use arbitrary paths or URLs to
other JS files.</p>
<h4 id="sec:the-body-class-variable"><span class="section-number">4.3.2.3</span> The <code>body-class</code> variable</h4>
<p>A class name for the main body (the default value is <code>body</code>).</p>
<hr />
<p>The following variables are for LaTeX templates:</p>
<h4 id="sec:the-classoption-variable"><span class="section-number">4.3.2.4</span> The <code>classoption</code> variable</h4>
<p>A string containing options for the document class.</p>
<h4 id="sec:the-documentclass-variable"><span class="section-number">4.3.2.5</span> The <code>documentclass</code> variable</h4>
<p>The document class (by default, <code>article</code>).</p>
<h3 id="sec:naming-convention-of-variables"><span class="section-number">4.3.3</span> Naming convention of variables</h3>
<p>A variable name must consist of alphanumeric characters and hyphens only. You
could use underscores in variable names in the metadata, but please note that
underscores will be normalized to hyphens internally, e.g., <code>header_includes</code>
will be converted to <code>header-includes</code>. This means if you use a custom template,
you must use hyphens instead of underscores as separators in variable names in
the template.</p>
<h3 id="sec:using-custom-variables"><span class="section-number">4.3.4</span> Using custom variables</h3>
<p>The above are variables supported in the default templates. If you use a custom
template, you can use arbitrary variable names following the naming convention
(except for <code>body</code>, which is a reserved name and cannot be used in metadata),
and the values of variables in the metadata will be passed to your template.</p>
<h3 id="sec:setting-options-in-yaml"><span class="section-number">4.3.5</span> Setting options in YAML</h3>
<p>Besides metadata variables, the aforementioned Markdown options
(<a class="cross-ref-sec" href="#sec:markdown-options">4.1</a>) can also be set in YAML under <code>output -&gt; * -&gt; options</code>,
e.g.,</p>
<pre><code class="language-yaml">output:
  html:
    options:
      toc: true
      js_highlight:
        package: highlight
        theme: github
        languages: [diff, latex]
</code></pre>
<h3 id="sec:other-fields-in-yaml"><span class="section-number">4.3.6</span> Other fields in YAML</h3>
<p>See the help page <code>?html</code> for possible fields in addiction to <code>meta</code> and
<code>options</code> that can be specified under the format name, e.g.,</p>
<pre><code class="language-yaml">output:
  latex:
    latex_engine: xelatex
    keep_md: true
    template: custom-template.tex
</code></pre>
<div class="chapter-after side side-right">
</div>
</div>
<div class="chapter body" data-source="docs/05-assets.Rmd">
<div class="chapter-before side side-right">
<p><a href="https://github.com/yihui/litedown/edit/main/docs/05-assets.Rmd">Edit this chapter</a> on GitHub</p>
</div>
<h1 id="chp:assets"><span class="section-number main-number">5</span> CSS/JS assets</h1>
<div class="epigraph">
<blockquote>
<p>And it seemed as though in a little while the solution would be found, and
then a new and splendid life would begin; and it was clear to both of them
that they had still a long, long road before them, and that the most
complicated and difficult part of it was only just beginning.</p>
<p>—Anton Chekhov, <em>The Lady with the Dog</em></p>
</blockquote>
</div>
<p>The <strong>litedown</strong> package aims at lightweight with a minimal number of features
at its core, but you can add more features by yourself. In this chapter, we
introduce some CSS/JS assets from the GitHub repository
<a href="https://github.com/yihui/lite.js">https://github.com/yihui/lite.js</a>. You can load arbitrary external JS and CSS
files via the <code>js</code> and <code>css</code> meta variables. There are numerous JS libraries and
CSS frameworks on the web that you can use, and you do not have to use the ones
mentioned in this chapter. You can also write CSS/JS by yourself to enhance your
HTML applications.</p>
<p>Remember that the CSS and JS are introduced under the output format <code>html</code> in
YAML metadata, e.g.,</p>
<pre><code class="language-yaml">---
output:
  html:
    meta:
      css: [&quot;one.css&quot;, &quot;two.css&quot;]
      js: [&quot;three.js&quot;, &quot;four.js&quot;]
---
</code></pre>
<p>For the sake of brevity, we will omit the full YAML fields in examples
throughout this chapter but only use the <code>css</code> and <code>js</code> fields. A file name
<code>foo.js</code> denotes the file under the <code>js/</code> directory of the aforementioned
<a href="https://github.com/yihui/lite.js"><code>yihui/lite.js</code> repository</a>. Similarly,
<code>foo.css</code> is under the <code>css/</code> directory.</p>
<p>All these CSS/JS resources can be used offline, and there are two ways to do it.
One way is to clone the GitHub repo to your working directory, and use the files
you need, e.g.,</p>
<pre><code class="language-yaml">js: [&quot;repo/path/js/callout.js&quot;]
</code></pre>
<p>Another way is to enable embedding resources:</p>
<pre><code class="language-yaml">output:
  html:
    meta:
      js: [&quot;@callout&quot;]
    options:
      embed_resources: [&quot;https&quot;]
</code></pre>
<p>After you have embedded CSS/JS resources once when you have Internet access,
these resources will be cached locally and will not require an Internet
connection again. This solution works for any online resources, not limited to
the <code>yihui/lite.js</code> repository.</p>
<h2 id="sec:html-slides"><span class="section-number">5.1</span> HTML slides</h2>
<p>With <code>snap.css</code> and <code>snap.js</code>, you can create lightweight HTML slides:</p>
<pre><code class="language-yaml">css: [&quot;@default&quot;, &quot;@snap&quot;]
js: [&quot;@snap&quot;]
</code></pre>
<p>You can learn more in <code>vignette('slides', package = 'litedown')</code>.</p>
<h2 id="sec:html-articles"><span class="section-number">5.2</span> HTML articles</h2>
<p>You can style an HTML page in an article format via the following CSS and JS:</p>
<pre><code class="language-yaml">css: [&quot;@default&quot;, &quot;@article&quot;]
js: [&quot;@sidenotes&quot;, &quot;@appendix&quot;]
</code></pre>
<p>The <code>article.css</code> is mainly for styling the article frontmatter, body, and side
content.</p>
<ul>
<li>
<p>The <code>sidenotes.js</code> is required only if you want to place certain elements on
the left or right side, such as the table of contents (TOC), footnotes, and
sidenotes.</p>
</li>
<li>
<p>The <code>appendix.js</code> is required only if you have an appendix in the article.</p>
</li>
</ul>
<p>The web version of this book is also based on the article format, so you know
what an article format looks like when you read the HTML version of the book.</p>
<h3 id="sec:the-overall-style"><span class="section-number">5.2.1</span> The overall style</h3>
<p>The maximum width of the article body is 800px. For larger screens, this means
there will be extra space in the left/right margin, where we can place auxiliary
information, such as the TOC and footnotes. On smaller screens, the side content
will be collapsed into the body.</p>
<p>The article frontmatter, body, and optionally the appendix are placed in
separate boxes.</p>
<p>The default typeface is sans-serif, and you can customize it by supplying an
external CSS file (via the <code>css</code> meta variable) or just embedding CSS in the
document body, e.g.,</p>
<pre><code class="language-md">```{css, echo = FALSE}
body {
  font-family: Palatino, &quot;Book Antiqua&quot;, Georgia, serif;
  font-size: 1em;
}
```
</code></pre>
<h3 id="sec:side-elements"><span class="section-number">5.2.2</span> Side elements</h3>
<p>The TOC and footnotes are automatically placed in the margin if space permits.
You can also write arbitrary content in the margin via a fenced <code>Div</code>.</p>
<h4 id="sec:the-toc"><span class="section-number">5.2.2.1</span> The TOC</h4>
<p>The TOC is sticky on the left side as you scroll down the article. If you do not
like this behavior, you may cancel it via CSS:</p>
<pre><code class="language-css">#TOC {
  top: unset;
}
</code></pre>
<h4 id="sec:footnotes_2"><span class="section-number">5.2.2.2</span> Footnotes</h4>
<p>Footnotes are moved to the right side. When you move your cursor over a footnote
number in the body, the footnote will be moved next to your cursor. This can be
convenient when you have multiple footnotes on a line, since you do not need to
look for a specific footnote in the margin.</p>
<h4 id="sec:arbitrary-sidenotes"><span class="section-number">5.2.2.3</span> Arbitrary sidenotes</h4>
<p>You can write anything in the margin by using a fenced <code>Div</code> with the classes
<code>.side</code> and <code>.side-left</code> or <code>.side-right</code>.</p>
<div class="side side-left">
<p><strong>Notice</strong></p>
<p>Here is a note on the left side. Anything permitted by law is permitted here.
Math? No problem!</p>
<p>$$e^{i\theta}=\sin{\theta}+i\cos{\theta}$$</p>
<p>When you have this sidenote “hammer”, I’m sure you will hit a lot of nails into
the margin, even if you do not have to.</p>
</div>
<pre><code class="language-markdown">::: {.side .side-left}
**Anything** on the left.
:::
</code></pre>
<pre><code class="language-markdown">::: {.side .side-right}
_Anything_ on the right.
:::
</code></pre>
<h3 id="sec:body-elements"><span class="section-number">5.2.3</span> Body elements</h3>
<p>Inside the article body, you can write a few special elements.</p>
<h4 id="sec:full-width-elements"><span class="section-number">5.2.3.1</span> Full-width elements</h4>
<p>When an element is wider than the article body, you can show it in its full
width by enclosing the element in a fenced <code>Div</code> with the class <code>.fullwidth</code>,
e.g.,</p>
<pre><code class="language-markdown">::: {.fullwidth}
![text](path/to/image)
:::
</code></pre>
<div class="fullwidth">
<p><img src="https://prose.yihui.org/post/2020/11/10/r-markdown-demo/index_files/figure-html/sunspots-1.svg" alt="Sunspots" /></p>
</div>
<p>If you use R Markdown, you can generate a wide plot or table from an R code
chunk, e.g.,</p>
<pre><code class="language-markdown">::: {.fullwidth}
```{r}
#| sunspots, echo = FALSE, fig.dim = c(14, 4),
#| fig.cap = 'Monthly mean relative sunspot numbers from 1749 to 1983.'
par(mar = c(4, 4, .1, .1), bg = 'lightyellow', fg = 'red', las = 1)
plot(sunspots, col = 'red')
grid()
```
:::
</code></pre>
<p>If you want to show code (<code>echo = TRUE</code>) but do not want the code to be in the
full-width container, you can apply the <code>.fullwidth</code> class to the plot only,
e.g.,</p>
<pre><code class="language-md">```{r}
#| sunspots, fig.dim = c(14, 4), fig.env = '.fullwidth .figure .box',
#| fig.cap = 'Monthly mean relative sunspot numbers from 1749 to 1983.'
par(mar = c(4, 4, .1, .1), bg = 'lightyellow', fg = 'red', las = 1)
plot(sunspots, col = 'red')
grid()
```
</code></pre>
<h4 id="sec:left-right-quotes"><span class="section-number">5.2.3.2</span> Left/right quotes</h4>
<div class="quote-right">
<blockquote>
<p>Whenever you find that you are on the side of the majority, it is time to
pause and reflect.</p>
<p>—<a href="http://www.quotationspage.com/quotes/Mark_Twain/81">Mark Twain</a></p>
</blockquote>
</div>
<p>Sometimes you may want to add a quote but do not want it to take the full width
in the body. You may use a fenced <code>Div</code> with the class <code>.quote-left</code> or
<code>.quote-right</code>.</p>
<p>Despite the class names, the content does not have to be a quote. If you do want
a quote, just use the blockquote syntax <code>&gt;</code>, e.g.,</p>
<pre><code class="language-markdown">::: {.quote-right}
&gt; This is a boring quote.
&gt;
&gt; ---Someone
:::
</code></pre>
<h4 id="sec:margin-embedding"><span class="section-number">5.2.3.3</span> Margin embedding</h4>
<p>You can embed elements on the left or right margin using a fenced <code>Div</code> with the
class <code>.embed-left</code> or <code>.embed-right</code>. These elements will float to the left or
right and exceed the margin by about 200px, which can save some space in the
article body. You can use the extra space to explain the embedded element with
text.</p>
<div class="embed-right">
<table>
<thead>
<tr>
<th></th>
<th align="right">mpg</th>
<th align="right">cyl</th>
<th align="right">disp</th>
<th align="right">hp</th>
<th align="right">drat</th>
<th align="right">wt</th>
<th align="right">qsec</th>
<th align="right">vs</th>
</tr>
</thead>
<tbody>
<tr>
<td>Mazda RX4</td>
<td align="right">21.0</td>
<td align="right">6</td>
<td align="right">160</td>
<td align="right">110</td>
<td align="right">3.90</td>
<td align="right">2.620</td>
<td align="right">16.46</td>
<td align="right">0</td>
</tr>
<tr>
<td>Mazda RX4 Wag</td>
<td align="right">21.0</td>
<td align="right">6</td>
<td align="right">160</td>
<td align="right">110</td>
<td align="right">3.90</td>
<td align="right">2.875</td>
<td align="right">17.02</td>
<td align="right">0</td>
</tr>
<tr>
<td>Datsun 710</td>
<td align="right">22.8</td>
<td align="right">4</td>
<td align="right">108</td>
<td align="right">93</td>
<td align="right">3.85</td>
<td align="right">2.320</td>
<td align="right">18.61</td>
<td align="right">1</td>
</tr>
<tr>
<td>Hornet 4 Drive</td>
<td align="right">21.4</td>
<td align="right">6</td>
<td align="right">258</td>
<td align="right">110</td>
<td align="right">3.08</td>
<td align="right">3.215</td>
<td align="right">19.44</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
</div>
<p>We have embedded a table of the first 4 rows of the <code>mtcars</code> data on the right
margin, which you can see if the browser window is wide enough.</p>
<h2 id="sec:tabbed-sections"><span class="section-number">5.3</span> Tabbed sections</h2>
<p>You can load the script <code>tabsets.js</code> and CSS <code>tabsets.css</code> to create tabsets
from sections (see <a href="https://yihui.org/en/2023/10/section-tabsets/">documentation
here</a>).</p>
<pre><code class="language-yaml">css: [&quot;@tabsets&quot;]
js: [&quot;@tabsets&quot;]
</code></pre>
<h2 id="sec:code-folding"><span class="section-number">5.4</span> Code folding</h2>
<p>Code folding is supported by <code>fold-details.js</code> (see <a href="https://yihui.org/en/2023/09/code-folding/">documentation
here</a>).</p>
<pre><code class="language-yaml">js: [&quot;@fold-details&quot;]
</code></pre>
<h2 id="sec:callout-blocks"><span class="section-number">5.5</span> Callout blocks</h2>
<p>A callout block is a fenced Div with the class name <code>callout-*</code>. Callouts
require <code>callout.css</code> and <code>callout.js</code>:</p>
<pre><code class="language-yaml">css: [&quot;@callout&quot;]
js: [&quot;@callout&quot;]
</code></pre>
<p>For example:</p>
<pre><code class="language-md">::: callout-tip
This is a tip.

&gt; You can write arbitrary content, such as a blockquote.

You can even _nest another callout_ into this one!

Is that cool?
:::
</code></pre>
<div class="callout-output">
<div class="callout-tip">
<p>This is a tip.</p>
<blockquote>
<p>You can write arbitrary content, such as a blockquote.</p>
</blockquote>
<p>You can even <em>nest another callout</em> into this one!</p>
<p>Is that cool?</p>
</div>
</div>
<h3 id="sec:built-in-callouts"><span class="section-number">5.5.1</span> Built-in callouts</h3>
<p>The stylesheet <code>callout.css</code> supports styling <code>tip</code>, <code>note</code>, <code>caution</code>,
<code>warning</code>, <code>important</code>, and <code>example</code> callouts. For example:</p>
<div class="callout-note">
<p>Thank you for your notice! Your notice has been noted.</p>
</div>
<div class="callout-caution">
<p>Be careful when testing for strict equality of floating point numbers.</p>
<pre><code class="language-r">seq(0, 1, .2) == c(0, .2, .4, .6, .8, 1)
</code></pre>
<pre><code>#&gt; [1]  TRUE  TRUE  TRUE FALSE  TRUE  TRUE
</code></pre>
</div>
<div class="callout-warning">
<p>Never try to out-stubborn a cat!</p>
</div>
<div class="callout-important">
<p>For the sake of reproducibility, please remember to render an R Markdown
document in a <em>new R session</em> before publishing or submitting the output
document.</p>
</div>
<div class="callout-example">
<pre><code class="language-md">::: {.callout-example data-legend=&quot;Demo&quot;}
Change the title of this example to &quot;Demo&quot;.
:::
</code></pre>
<div class="callout-example" data-legend="Demo">
<p>Change the title of this example to “Demo”.</p>
</div>
</div>
<h3 id="sec:customizing-callouts"><span class="section-number">5.5.2</span> Customizing callouts</h3>
<p>You do not have to use <code>callout.css</code> but can define your own CSS rules, e.g.,</p>
<pre><code class="language-css">.callout-important {
  background: red;
  color: yellow;
}
</code></pre>
<p>Under the hood, <code>callout.js</code> turns the fenced Div into a <code>&lt;fieldset&gt;</code> for the
form:</p>
<pre><code class="language-html">&lt;fieldset class=&quot;callout-*&quot;&gt;
  &lt;legend&gt;Title&lt;/legend&gt;

  Content.
&lt;/fieldset&gt;
</code></pre>
<p>The content comes from the original fenced Div. The title comes from the class
name (converted to uppercase) by default. You can provide a custom title via the
<code>data-legend</code> attribute of the Div, e.g.,</p>
<pre><code class="language-md">::: {.callout-tip data-legend=&quot;Information&quot;}
:::
</code></pre>
<p>The icons before the callout titles can be defined via CSS, e.g., you can add
two exclamation marks before the title of <code>important</code> callouts:</p>
<pre><code class="language-css">.callout-important legend::before {
  content: &quot;!! &quot;;
}
</code></pre>
<p>The default icons defined in <code>callout.css</code> are essentially <a href="https://www.w3schools.com/charsets/ref_utf_symbols.asp">UTF-8
characters</a>. In theory,
there are hundreds of thousands of characters that you can choose from. Each
character is 1 to 4 bytes. For example, you can define a <code>music</code> callout with
the music note symbol ♫ in the CSS:</p>
<pre><code class="language-css">.callout-music {
  background: springgreen;
  border-color: yellow;
}
.callout-music legend::before {
  content: &quot;♫ &quot;;
}
</code></pre>
<p>Then you can insert a <code>music</code> callout in your document:</p>
<pre><code class="language-md">::: callout-music
Please listen to this lovely song.
:::
</code></pre>
<p>Alternatively, if you are using <code>callout.css</code>, you can also use CSS variables to
define the border color, background, and icon of a callout, e.g.,</p>
<pre><code class="language-css">.callout-music {
  --callout-background: springgreen;
  --callout-border: yellow;
  --callout-icon: &quot;♫ &quot;;
}
</code></pre>
<h2 id="sec:right-align-a-quote-footer"><span class="section-number">5.6</span> Right-align a quote footer</h2>
<p>You can use the script <code>right-quote.js</code> to right-align a blockquote footer if it
starts with an em-dash (<code>---</code>).</p>
<pre><code class="language-yaml">js: [&quot;@right-quote&quot;]
</code></pre>
<h2 id="sec:add-anchor-links-to-headings"><span class="section-number">5.7</span> Add anchor links to headings</h2>
<p>The CSS is necessary only if you want to hide the anchors by default and reveal
them on hover.</p>
<pre><code class="language-yaml">css: [&quot;@heading-anchor&quot;]
js: [&quot;@heading-anchor&quot;]
</code></pre>
<h2 id="sec:style-keyboard-shortcuts"><span class="section-number">5.8</span> Style keyboard shortcuts</h2>
<p>The script <code>key-button.js</code> identifies keys and the CSS styles them, which can be
useful for <a href="https://yihui.org/en/2023/02/key-buttons/">showing keyboard
shortcuts</a>.</p>
<pre><code class="language-yaml">css: [&quot;@key-buttons&quot;]
js: [&quot;@key-buttons&quot;]
</code></pre>
<p>Of course, you can combine any number of JS scripts and CSS files if you want
multiple features.</p>
<h2 id="sec:arbitrary-assets"><span class="section-number">5.9</span> Include arbitrary CSS/JS</h2>
<p>You can include arbitrary CSS frameworks and JS libraries in your documents, not
limited to aforementioned ones in the GitHub repository <code>yihui/lite.js</code>. Below
is a quick example of using the DataTables library to create interactive tables:</p>
<pre><code class="language-md">---
title: Display Tables with the JS Library DataTables
output:
  html:
    meta:
      css: [&quot;@default&quot;, &quot;@npm/datatables/media/css/jquery.dataTables.min.css&quot;]
      js: [&quot;@npm/jquery/dist/jquery&quot;, &quot;@npm/datatables/media/js/jquery.dataTables.min.js&quot;]
---

::: {#mtcars-table}
```{r}
I(mtcars)
```
:::

```{js}
window.addEventListener('load', () =&gt; {
  $('#mtcars-table table').DataTable();
});
```
</code></pre>
<div class="chapter-after side side-right">
</div>
</div>
<div class="chapter body" data-source="docs/06-editor.Rmd">
<div class="chapter-before side side-right">
<p><a href="https://github.com/yihui/litedown/edit/main/docs/06-editor.Rmd">Edit this chapter</a> on GitHub</p>
</div>
<h1 id="chp:authoring"><span class="section-number main-number">6</span> Authoring</h1>
<div class="epigraph">
<blockquote>
<p>I don’t hide from you that I don’t detest the countryside—having been brought
up there, snatches of memories from past times, yearnings for that infinite of
which the Sower, the sheaf, are the symbols, still enchant me as before. But
when will I do the starry sky, then, that painting that’s always on my mind?</p>
<p>—Vincent van Gogh, <a href="https://vangoghletters.org/vg/letters/let628/letter.html"><em>The
Letters</em></a></p>
</blockquote>
</div>
<h2 id="sec:live-preview"><span class="section-number">6.1</span> Live preview</h2>
<p>Unless it has become your muscle memory to click on the <code>Knit</code> button in
RStudio, you may try to switch to <code>litedown::roam()</code> to preview your HTML output
by clicking on the <code>run</code> buttons in the user interface. Note that the preview
takes place <em>in memory only</em>. Although you see an HTML page rendered from a file
in the preview, the page is not rendered to disk, unless you click on the
<code>render</code> button (<a class="cross-ref-sec" href="#sec:the-buttons">6.1.3</a>), or call <code>litedown::fuse()</code> (<a class="cross-ref-chp" href="#chp:fuse">2</a>) or
<code>mark()</code> (<a class="cross-ref-chp" href="#chp:mark">4</a>) on the file.</p>
<h3 id="sec:live-reload"><span class="section-number">6.1.1</span> Live reload</h3>
<p>By default, the preview will automatically refresh the content after you edit
and save a file. If you prefer building the document only when you want to, you
can turn off the live preview via <code>litedown::roam(live = FALSE)</code>. In this case,
the document will be rebuilt only when you refresh the page by yourself.</p>
<h3 id="sec:the-file-listing"><span class="section-number">6.1.2</span> The file listing</h3>
<p>After launching the preview via <code>litedown::roam()</code>, a file listing will be
displayed, which shows the first few lines of <code>*.R</code>, <code>*.Rmd</code>, and <code>*.md</code> files
in boxes, followed by the list of other files.</p>
<p>By clicking on plain-text files, you will see their full content. For binary
files, they may be opened in your browser; if they cannot be opened, the browser
may prompt to download the file.</p>
<p>Each file will have its size displayed after the filename, with a link attached
to the file size. The link points to the raw file (the behavior of the link is
up to the browser—the file may be opened or downloaded), and <strong>litedown</strong> will
not process it at all.</p>
<p>The full path of the file or directory being previewed is displayed at the top
left.</p>
<p>For <code>.R</code>, <code>.Rmd</code>, and <code>.md</code> files, you can click on the “Run” button
(<span class="larger">⏵</span>) to render them to HTML in memory and preview the output. This
button is displayed at the top right of each file box on the listing page, and
at the top right of the preview page of an individual file.</p>
<div class="callout-caution">
<p>Rendering <code>.R</code> and <code>.Rmd</code> files via the <code>Run</code> button means <em>the full R code</em> in
them will be executed. If the R code involves intensive computing, it may not be
a good idea to run the whole file, unless you have taken measures to speed up
the computing (e.g., via caching).</p>
</div>
<h3 id="sec:the-buttons"><span class="section-number">6.1.3</span> The buttons</h3>
<p>There is a button group at the top right of the preview page.</p>
<ul>
<li>
<p>The <code>render</code> button (with the lightning or voltage icon, <span class="larger">↯</span>): It
renders a document or project in a new R session and save the output file(s)
to disk, which is similar to what the <code>Knit</code> button does in RStudio.</p>
<p>You can also use the keyboard shortcut <code>Ctrl + K</code> (or <code>Command + K</code> on
macOS).</p>
</li>
<li>
<p>The <code>edit</code> buttons (with a pencil icon, <span class="larger">✎</span>): Clicking on this
button will open a plain-text file in your default editor.</p>
</li>
<li>
<p>The <code>back</code>/<code>forward</code> buttons (with arrow icons, <span class="larger">←</span> and
<span class="larger">→</span>): They are similar to the back/forward buttons on web browser
toolbars, and can be used to go back/forward through the browsing history.</p>
<p>You can also use the keyboard shortcuts <code>Alt + Left</code> / <code>Alt + Right</code>.</p>
</li>
<li>
<p>The <code>refresh</code> button (with the refresh icon, <span class="larger">⟳</span>): It can be used
to refresh the page. If you are previewing an Rmd file, refreshing the page
will rebuild it.</p>
<p>You can also use the keyboard shortcut <code>Ctrl + R</code> (or <code>Command + R</code> on
macOS).</p>
</li>
<li>
<p>The <code>printer</code> button (with a printer icon, <span class="larger">⎙</span>): It brings up the
printer dialog, e.g., you can print the page to PDF.</p>
</li>
</ul>
<p>Code blocks in the preview mode will have line numbers automatically added to
their left. If you click on a line number, it will bring you to that line in the
source document.</p>
<p>Note that the keyboard shortcuts require the page to be currently on focus
before they can take effect. This is important when you are viewing a page
inside RStudio or other IDEs, because the viewer may not gain focus
automatically, and you will have to explicitly click on it.</p>
<h3 id="sec:cleaning-up"><span class="section-number">6.1.4</span> Cleaning up</h3>
<p>Previewing <code>.Rmd</code> and <code>.R</code> files that generate plots will leave <code>*__files/</code>
directories (containing plot files) on disk by default. If you want to clean up
such directories when closing or navigating away from the preview page, you may
set the option</p>
<pre><code class="language-r">options(litedown.roam.cleanup = TRUE)
</code></pre>
<p>before you run <code>litedown::roam()</code> or in your <code>.Rprofile</code>. Note that it will not
clean up a <code>*__files/</code> directory if it has existed before you preview a file.
This is to make sure <code>roam()</code> will not delete existing files by accident. If you
are certain that a <code>*__files/</code> directory can be safely deleted, you can always
delete it by hand. After that, <code>roam()</code> will automatically clean it up when you
preview the file again.</p>
<p>Please also note that when caching is enabled (via the chunk option
<code>cache = TRUE</code>) in the file being previewed, the <code>*__files/</code> directory will not
be cleaned up, because when a code chunk is cached, it will not be re-evaluated
or re-generate plots next time (unless the cache is invalidated).</p>
<h2 id="sec:visual-editor"><span class="section-number">6.2</span> Visual editor</h2>
<p>Since the Markdown syntax of <strong>litedown</strong> can be viewed as a subset of Pandoc’s
Markdown, you can use RStudio’s visual Markdown editor to author documents.
Please bear in mind that most common, but not all, Markdown features are
supported.</p>
<h2 id="sec:knit-button"><span class="section-number">6.3</span> The <code>Knit</code> button</h2>
<p>If you use the RStudio IDE, the <code>Knit</code> button can render R Markdown to a
<strong>litedown</strong> output format specified in YAML (e.g., <code>html</code> or <code>latex</code>). Please
also remember to add a top-level setting <code>knit: litedown:::knit</code> in YAML,
otherwise RStudio will either throw an error if you use the output format <code>html</code>
or <code>latex</code>, or use <code>rmarkdown::render()</code> instead of <code>litedown::fuse()</code> to render
the document.</p>
<pre><code class="language-yaml">---
output: html
knit: litedown:::knit
---
</code></pre>
<div class="chapter-after side side-right">
</div>
</div>
<div class="chapter body" data-source="docs/07-site.Rmd">
<div class="chapter-before side side-right">
<p><a href="https://github.com/yihui/litedown/edit/main/docs/07-site.Rmd">Edit this chapter</a> on GitHub</p>
</div>
<h1 id="chp:sites"><span class="section-number main-number">7</span> Books and Websites</h1>
<div class="epigraph">
<blockquote>
<p>I can at least listen without indignation to the critic who is of the opinion
that when one surveys the aims of cultural endeavour and the means it employs,
one is bound to come to the conclusion that the whole effort is not worth the
trouble, and that the outcome of it can only be a state of affairs which the
individual will be unable to tolerate.</p>
<p>—Sigmund Freud, <em>Civilization and Its Discontents</em></p>
</blockquote>
</div>
<p>Books and websites are usually based on multiple input files under a directory.
For a directory to be recognized as a book or website project, it needs to
contain a configuration file named <code>_litedown.yml</code>.</p>
<p>If you want to customize the output formats for books or websites, you should do
it in <code>_litedown.yml</code>, e.g.,</p>
<pre><code class="language-yaml">output:
  html:
    options:
      toc:
        depth: 4
  latex:
    meta:
      documentclass: &quot;book&quot;
</code></pre>
<h2 id="sec:books"><span class="section-number">7.1</span> Books</h2>
<p>The <code>_litedown.yml</code> file should contain a top-level field named <code>book</code>, which
currently supports these options:</p>
<pre><code class="language-yaml">book:
  new_session: false
  subdir: false
  pattern: &quot;[.]R?md$&quot;
  chapter_before: &quot;Information before a chapter.&quot;
  chapter_after: &quot;This chapter was generated from `$input$`.&quot;
</code></pre>
<p>You can choose whether to render each input file in a new R session, whether to
search subdirectories for input files, the types of input files (e.g., you can
use <code>.md</code> or <code>.R</code> files if you want), and additional information to be included
before/after each chapter, in which you can use some variables such as
<code>$input$</code>, which is the path of each input file.</p>
<h3 id="sec:previewing-a-single-chapter"><span class="section-number">7.1.1</span> Previewing a single chapter</h3>
<p>Rendering a whole book may be time-consuming<sup class="footnote-ref"><a href="#fn-07-site-1" id="fnref-07-site-1" data-footnote-ref>10</a></sup> and unnecessary when
you work on a book. It may be easier to only preview the single chapter that you
currently work on. The preview can be done with <code>litedown::roam()</code>:</p>
<ul>
<li>
<p>If you run the index file (e.g., <code>index.Rmd</code>), the whole book will be
previewed.</p>
</li>
<li>
<p>If you run other chapter files, only the specific chapter is previewed.</p>
</li>
</ul>
<p>When a chapter contains dependencies on certain elements in other chapters
(e.g., a chapter includes cross-references to other chapters), we recommend that
you run the index file to preview the whole book at least once before you
preview individual chapters, to make <strong>litedown</strong> know the book elements fully.</p>
<p>Similarly, if you use the configuration <code>new_session: false</code> to render all
chapters in the same R session, and a later chapter uses computed results from a
previous chapter, you will need to preview the full book at least once to make
sure the results are computed and exist in the R session.</p>
<p>You may also choose to run the index file to preview the whole book but then
work on an individual chapter. In this case, <code>roam()</code> will try to detect changes
in chapter files. When a certain chapter file has been updated, its output on
the full book page will be updated. That is, the full book page is <em>partially</em>
updated without being reloaded. This method lets you preview changes in one
chapter while presenting the whole book. However, please note that certain JS
libraries may not work well in this preview mode. When in doubt, refresh the
page.</p>
<h2 id="sec:websites"><span class="section-number">7.2</span> Websites</h2>
<p>The <code>_litedown.yml</code> file should contain a top-level field named <code>site</code>, and you
are likely to customize the <code>meta</code> variables <code>css</code>, <code>include_before</code>, and
<code>include_after</code> for the <code>html</code> format, e.g.,</p>
<pre><code class="language-yaml">site:
  rebuild: &quot;outdated&quot;
  pattern: &quot;[.]R?md$&quot;

output:
  html:
    meta:
      css: [&quot;@default&quot;]
      include_before: &quot;[Home](/) [About](/about.html)&quot;
      include_after: &quot;&amp;copy; 2024 | [Edit]($input$)&quot;
</code></pre>
<p>Basically, <code>include_before</code> can take a file or text input that will be used as
the header of each web page, and <code>include_after</code> will be the footer.</p>
<h2 id="sec:pkg-site"><span class="section-number">7.3</span> R package documentation</h2>
<p>R package developers can build the full package documentation as either a book
or a website.</p>
<h3 id="sec:the-pkg-helper-functions"><span class="section-number">7.3.1</span> The <code>pkg_*()</code> helper functions</h3>
<p>A series of helper functions have been provided in <strong>litedown</strong> to get various
information about the package, such as the package description (<code>pkg_desc()</code>),
news (<code>pkg_news()</code>), citation (<code>pkg_citation()</code>), source code (<code>pkg_code()</code>),
and all manual pages (<code>pkg_manual()</code>). You can call these functions in code
chunks to print out the desired information.</p>
<p>For example, you may call them in the appendix (<a class="cross-ref-sec" href="#sec:appendices">3.3.6</a>) of a book:</p>
<pre><code class="language-md"># Appendix {.appendix}

# Package Metadata

```{r, echo = FALSE}
litedown::pkg_desc()
```

To cite the package:

```{r, echo = FALSE}
litedown::pkg_citation()
```

# News

```{r, echo = FALSE}
litedown::pkg_news(recent = 0)  # show full news
```

# Manual pages

```{r, echo = FALSE}
litedown::pkg_manual()
```

# Source code

```{r, echo = FALSE}
litedown::pkg_code()
```
</code></pre>
<p>Alternatively, you can build a package website by calling these functions in
separate <code>.Rmd</code> files, e.g., <code>pkg_desc()</code> in <code>index.Rmd</code>, <code>pkg_news()</code> in
<code>news.Rmd</code>, and so on.</p>
<h3 id="sec:package-sites-via-github-action"><span class="section-number">7.3.2</span> Package sites via GitHub Action</h3>
<p>You may use GitHub Actions to automatically build and deploy package websites.
The key is to call <code>litedown::fuse_site()</code>. I have provided <a href="https://github.com/yihui/litedown/blob/main/site/action.yml">a simple GitHub
action</a> in the
<strong>litedown</strong> repository, and you can add a step <code>uses: yihui/litedown/site@HEAD</code>
to your GitHub workflow to use it. Below is <a href="https://github.com/yihui/litedown/blob/main/.github/workflows/github-pages.yml">the full
workflow</a>
for building and publishing <strong>litedown</strong>’s site to GitHub Pages:</p>
<pre><code class="language-yaml" data-file="github-pages.yml" data-source="1">name: Build and deploy package site

on:
  push:
    branches: [&quot;main&quot;]

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/configure-pages@v5
      - uses: r-lib/actions/setup-r@HEAD
        with:
          use-public-rspm: true
      - uses: r-lib/actions/setup-r-dependencies@HEAD
      - uses: yihui/litedown/site@HEAD
        with:
          site-dir: 'site'
      - uses: actions/upload-pages-artifact@v3
        with:
          path: 'site'
      - id: deployment
        uses: actions/deploy-pages@v4
</code></pre>
<p>You can copy it to the <code>.github/workflows/</code> directory of the R package’s Git
repository and commit/push it via Git. Within a few minutes, the package site
should be ready at <code>https://user.github.io/pkg/</code>, where <code>user</code> is your GitHub
username, and <code>pkg</code> is the repository name, e.g.,
<a href="https://yihui.github.io/litedown/">https://yihui.github.io/litedown/</a>.</p>
<p>The action <code>yihui/litedown/site</code> supports a few options that you can configure
under the <code>with</code> field. In the above example workflow, we used the option
<code>site-dir</code>. Below are the options currently supported:</p>
<ul>
<li>
<p><code>site-dir</code>: Directory of the site source (default: <code>site</code>).</p>
</li>
<li>
<p><code>pkg-root</code>: Root directory of the R package in the repository (default: <code>.</code>).</p>
</li>
<li>
<p><code>exclude</code>: Pages to be excluded (filenames separated by spaces) (default: <code>code.Rmd</code>).</p>
</li>
<li>
<p><code>cleanup</code>: Command to clean up the site directory before publishing, e.g., you can delete the <code>.Rmd</code> source files (default: <code>rm -f *.Rmd *.yml _*</code>).</p>
</li>
</ul>
<p>By default, the site is built under the <code>site/</code> directory of the package. If you
change this path, please remember to adjust the <code>path</code> option for the
<code>actions/upload-pages-artifact</code> action accordingly.</p>
<p>If the site source directory in your package does not exist or is empty, the
action will copy <a href="https://github.com/yihui/litedown/tree/main/site">the site
template</a> from <strong>litedown</strong>,
which contains the following <code>.Rmd</code> files (explained in <a class="cross-ref-tab" href="#tab:pkg-site">3</a>):</p>
<pre><code class="language-r">list.files('../site/', '[.]Rmd$')
</code></pre>
<pre><code>#&gt; [1] &quot;_footer.Rmd&quot;  &quot;articles.Rmd&quot; &quot;code.Rmd&quot;     &quot;index.Rmd&quot;    &quot;manual.Rmd&quot;  
#&gt; [6] &quot;news.Rmd&quot;    
</code></pre>
<div class="table box">
<div class="caption">
<p><span class="ref-number-tab">3</span> Explanations of site source files.</p>
</div>
<table>
<thead>
<tr>
<th>source</th>
<th>description</th>
<th>content</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>index</code></td>
<td>home page</td>
<td><code>pkg_desc()</code>, <code>pkg_citation()</code>, and <code>README.md</code></td>
</tr>
<tr>
<td><code>articles</code></td>
<td>package vignettes</td>
<td>the <code>doc/</code> folder of the installed package</td>
</tr>
<tr>
<td><code>code</code></td>
<td>source code (R, C, C++, etc.)</td>
<td><code>pkg_code()</code></td>
</tr>
<tr>
<td><code>manual</code></td>
<td>help pages</td>
<td><code>pkg_manual()</code></td>
</tr>
<tr>
<td><code>news</code></td>
<td>news</td>
<td><code>pkg_news()</code></td>
</tr>
<tr>
<td><code>_footer</code></td>
<td>page footer</td>
<td>package authors</td>
</tr>
</tbody>
</table>
</div>
<p>You can freely customize this template according to your own needs (e.g.,
modify, add, or delete files), and add the folder to your repository. Then the
action will use your custom template to build the site.</p>
<p>The <code>exclude</code> option allows you to exclude certain pages from the site. By
default, <code>code.Rmd</code> is excluded. You can exclude more pages. For example, if
your package does not have vignettes, you can specify
<code>exclude: 'code.Rmd articles.Rmd'</code> (if you do not want <code>code.Rmd</code>, either).</p>
<p>The <code>cleanup</code> option allows you to run a command before publishing the site,
e.g., you can delete the <code>.Rmd</code> source and <code>.yml</code> config files.</p>
<div class="chapter-after side side-right">
</div>
</div>
<div class="chapter body" data-source="docs/A-rmarkdown.Rmd">
<div class="chapter-before side side-right">
<p><a href="https://github.com/yihui/litedown/edit/main/docs/A-rmarkdown.Rmd">Edit this chapter</a> on GitHub</p>
</div>
<h1 id="chp:appendix" class="appendix">Appendix</h1>
<h1 id="chp:rmarkdown"><span class="section-number main-number">A</span> For rmarkdown Users</h1>
<p>The <strong>litedown</strong> package can partially recognize the output format names
<code>html_document</code>, <code>html_vignette</code>, and <code>pdf_document</code> from <strong>rmarkdown</strong>: Some
options of these output formats are mapped to <strong>litedown</strong>’s options internally.</p>
<p>For example, for an R Markdown document with the following output format:</p>
<pre><code class="language-yaml">output:
  html_document:
    toc: true
    number_sections: true
    anchor_sections: true
    self_contained: false
</code></pre>
<p>It will be transformed to:</p>
<pre><code class="language-yaml">output:
  html:
    options:
      toc: true
      number_sections: true
      embed_resources: false
    meta:
      css: [&quot;default&quot;, &quot;@heading-anchor&quot;]
      js: [&quot;@heading-anchor&quot;]
</code></pre>
<p>Note that not all <strong>rmarkdown</strong> options are supported, and not even all
supported options have exactly the same effects in <strong>litedown</strong>. The supported
options include:
<code>toc</code>, <code>toc_depth</code>, <code>number_sections</code>, <code>anchor_sections</code>, <code>code_folding</code>, <code>self_contained</code>, <code>math_method</code>, <code>css</code>, and <code>includes</code>.</p>
<div class="chapter-after side side-right">
</div>
</div>
<div class="chapter body" data-source="docs/B-vignettes.Rmd">
<div class="chapter-before side side-right">
<p><a href="https://github.com/yihui/litedown/edit/main/docs/B-vignettes.Rmd">Edit this chapter</a> on GitHub</p>
</div>
<h1 id="chp:vignettes"><span class="section-number main-number">B</span> Package vignettes</h1>
<p>To build package vignettes with <strong>litedown</strong>, first add this to the package
<code>DESCRIPTION</code> file:</p>
<pre><code class="language-yaml">VignetteBuilder: litedown
</code></pre>
<p>Then use the vignette engine <code>litedown::vignette</code> in the YAML metadata of a
<code>.Rmd</code> or <code>.md</code> vignette file:</p>
<pre><code class="language-yaml">vignette: &gt;
  %\VignetteEngine{litedown::vignette}
  %\VignetteIndexEntry{Your vignette title}
  %\VignetteEncoding{UTF-8}
</code></pre>
<p>The output format of a vignette can be specified in the <code>output</code> field of the
YAML metadata, e.g., <code>html</code> (for HTML vignettes) or <code>latex</code> (for PDF vignettes).
If no output format is specified, the default is HTML.</p>
<p>The vignette file can be either <code>.Rmd</code> or <code>.md</code>. The former is processed by
<code>litedown::fuse()</code>, and the latter is converted by <code>litedown::mark()</code>. Please
avoid using the same base filename for two <code>.Rmd</code> and <code>.md</code> files, otherwise
their output files will overwrite each other.</p>
<div class="chapter-after side side-right">
</div>
</div>
<div class="chapter body" data-source="docs/C-notes.Rmd">
<div class="chapter-before side side-right">
<p><a href="https://github.com/yihui/litedown/edit/main/docs/C-notes.Rmd">Edit this chapter</a> on GitHub</p>
</div>
<h1 id="chp:notes"><span class="section-number main-number">C</span> Technical Notes</h1>
<h2 id="sec:embedding-resources"><span class="section-number">C.1</span> Embedding resources</h2>
<p>When <code>https</code> resources needs to be embedded (via the <code>embed_resources</code> option),
only these elements are considered:</p>
<pre><code class="language-html">&lt;img src=&quot;...&quot; /&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;...&quot;&gt;
&lt;script src=&quot;...&quot;&gt;&lt;/script&gt;
</code></pre>
<p>Background images set in the attribute <code>style=&quot;background-image: url(...)&quot;</code> are
also considered. If an external CSS file contains <code>url()</code> resources, these
resources will also be downloaded and embedded.</p>
<h2 id="sec:css-for-margin-content"><span class="section-number">C.2</span> CSS for margin content</h2>
<p>It’s quite simple to move an element into the margin using CSS. For example, the
<code>.side-right</code> class in this article is roughly defined as:</p>
<pre><code class="language-css">.side-right {
  width: 200px;
  float: right;
  margin-right: -200px
}
</code></pre>
<p>That basically means the width of the element is 200px and it floats to the
right. Now its right side will touch the right margin of its parent element (the
article body). What we need to do next is move it further to the right by 200px
(i.e., its width), which is done by the <code>-200px</code> right margin. Remember, a
positive right margin in CSS moves an element to the left, and a negative right
margin moves it to the right.</p>
<div class="chapter-after side side-right">
</div>
</div>
<section class="footnotes" data-footnotes>
<ol>
<li id="fn-1">
<p>At one night, as I was thinking about Pandoc Lua filters, an obvious fact
suddenly came to my mind: suppose all I care about is HTML output, then the
good old JavaScript can actually play a perfect role of Lua filters, because
you can manipulate the DOM arbitrarily with JavaScript. <a href="#fnref-1" class="footnote-backref" data-footnote-backref data-footnote-backref-idx="1" aria-label="Back to reference 1">↩</a></p>
</li>
<li id="fn-2">
<p>In fact, <code>xml,</code> <code>man</code>, <code>text</code>, and <code>commonmark</code> output formats are
supported (thanks to the <strong>commonmark</strong> package), but perhaps they are not
very useful to average users. <a href="#fnref-2" class="footnote-backref" data-footnote-backref data-footnote-backref-idx="2" aria-label="Back to reference 2">↩</a></p>
</li>
<li id="fn-02-fuse-1">
<p>Cosmetic changes such as adding/deleting spaces and blank lines or
modifying comments do not matter. The code is considered unchanged if it
still parses to the same expressions via <code>parse()</code>. For example,
<code>parse(text = '1+1')</code> and <code>parse(text = '1 + 1')</code> generate the same result. <a href="#fnref-02-fuse-1" class="footnote-backref" data-footnote-backref data-footnote-backref-idx="3" aria-label="Back to reference 3">↩</a></p>
</li>
<li id="fn-02-fuse-2">
<p>Lazy-loading means that the value of a variable will not be read
from the cache until the variable is actually used somewhere. This can save
the read time, especially if a large variable is not actually used later in
the document. <a href="#fnref-02-fuse-2" class="footnote-backref" data-footnote-backref data-footnote-backref-idx="4" aria-label="Back to reference 4">↩</a></p>
</li>
<li id="fn-02-fuse-3">
<p>Perhaps Paul Murrell is the only person in the world who uses the
<code>.Rhtml</code> format. I wonder if anyone uses any of the rest of formats, except
for <code>.Rnw</code> and <code>.Rmd</code>. <a href="#fnref-02-fuse-3" class="footnote-backref" data-footnote-backref data-footnote-backref-idx="5" aria-label="Back to reference 5">↩</a></p>
</li>
<li id="fn-03-syntax-1">
<p>At least <a href="https://news.ycombinator.com/item?id=36745212">it was not quite friendly to
Norwegian</a> until YAML 1.2. <a href="#fnref-03-syntax-1" class="footnote-backref" data-footnote-backref data-footnote-backref-idx="6" aria-label="Back to reference 6">↩</a></p>
</li>
<li id="fn-03-syntax-2">
<p>TRACY is a good friend of Norwegian. <a href="#fnref-03-syntax-2" class="footnote-backref" data-footnote-backref data-footnote-backref-idx="7" aria-label="Back to reference 7">↩</a></p>
</li>
<li id="fn-03-syntax-3">
<p>Most people may want to use 2 or 4 spaces. Avoid 8, because that
has been reserved for a VIP in the R club, <a href="https://simplystatistics.org/posts/2018-07-27-why-i-indent-my-code-8-spaces/">Roger
Peng</a>.
You may also choose to use tabs. If you <em>really</em> want to, you can mix tabs
with spaces (then \(n\) is the total number of them). If people tell you that
you are crazy by mixing up things, don’t listen and never follow. TRACY is
human-friendly and respects the space right of all human beings. Guess what
happens if you indent one line by 2 spaces and the next line by 3 spaces
when you meant to use 4 spaces? <a href="#fnref-03-syntax-3" class="footnote-backref" data-footnote-backref data-footnote-backref-idx="8" aria-label="Back to reference 8">↩</a></p>
</li>
<li id="fn-03-syntax-4">
<p>The specific number doesn’t matter, as long as it’s a unique
footnote number in the document. For example, the first footnote can be
<code>[^100]</code> and the second can be <code>[^64]</code>. Eventually they will appear as <code>[1]</code>
and <code>[2]</code>. If you use the RStudio visual editor to edit Markdown documents,
the footnote numbers will be automatically generated and updated when new
footnotes are inserted before existing footnotes. <a href="#fnref-03-syntax-4" class="footnote-backref" data-footnote-backref data-footnote-backref-idx="9" aria-label="Back to reference 9">↩</a></p>
</li>
<li id="fn-07-site-1">
<p>Remember that you can cache time-consuming code chunks to make the
rendering faster. <a href="#fnref-07-site-1" class="footnote-backref" data-footnote-backref data-footnote-backref-idx="10" aria-label="Back to reference 10">↩</a></p>
</li>
</ol>
</section>
</div>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/combine/npm/katex@0.16.15/dist/katex.min.js,npm/katex@0.16.15/dist/contrib/auto-render.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/@xiee/utils@1.13.53/js/render-katex.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/mermaid@11.4.1/dist/mermaid.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/@xiee/utils@1.13.53/js/sidenotes.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/@xiee/utils@1.13.53/js/appendix.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/@xiee/utils@1.13.53/js/toc-highlight.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/@xiee/utils@1.13.53/js/chapter-toc.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/@xiee/utils@1.13.53/js/copy-button.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/@xiee/utils@1.13.53/js/external-link.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/@xiee/utils@1.13.53/js/heading-anchor.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/@xiee/utils@1.13.53/js/right-quote.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/@xiee/utils@1.13.53/js/key-buttons.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/@xiee/utils@1.13.53/js/callout.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/@xiee/utils@1.13.53/js/pages.min.js" defer></script>
</body>
</html>
